/*! akashic-engine-standalone@3.21.2 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).AE=e()}(this,function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if("function"==typeof e){var r=function t(){var r=!1;try{r=this instanceof t}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}),r}var r={},n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},o.apply(this,arguments)};function s(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}function a(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function u(t,e){return function(r,n){e(r,n,t)}}function c(t,e,r,n,i,o){function s(t){if(void 0!==t&&"function"!=typeof t)throw new TypeError("Function expected");return t}for(var a,u=n.kind,c="getter"===u?"get":"setter"===u?"set":"value",h=!e&&t?n.static?t:t.prototype:null,l=e||(h?Object.getOwnPropertyDescriptor(h,n.name):{}),d=!1,p=r.length-1;p>=0;p--){var f={};for(var _ in n)f[_]="access"===_?{}:n[_];for(var _ in n.access)f.access[_]=n.access[_];f.addInitializer=function(t){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(t||null))};var y=(0,r[p])("accessor"===u?{get:l.get,set:l.set}:l[c],f);if("accessor"===u){if(void 0===y)continue;if(null===y||"object"!=typeof y)throw new TypeError("Object expected");(a=s(y.get))&&(l.get=a),(a=s(y.set))&&(l.set=a),(a=s(y.init))&&i.unshift(a)}else(a=s(y))&&("field"===u?i.unshift(a):l[c]=a)}h&&Object.defineProperty(h,n.name,l),d=!0}function h(t,e,r){for(var n=arguments.length>2,i=0;i<e.length;i++)r=n?e[i].call(t,r):e[i].call(t);return n?r:void 0}function l(t){return"symbol"==typeof t?t:"".concat(t)}function d(t,e,r){return"symbol"==typeof e&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:r?"".concat(r," ",e):e})}function p(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function f(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})}function _(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}var y=Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]};function v(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||y(e,t,r)}function g(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function w(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(m(arguments[e]));return t}function b(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}function A(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function x(t){return this instanceof x?(this.v=t,this):new x(t)}function S(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(t){return function(e){return Promise.resolve(e).then(t,c)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(t,e){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||a(t,e)})},e&&(n[t]=e(n[t])))}function a(t,e){try{(r=i[t](e)).value instanceof x?Promise.resolve(r.value.v).then(u,c):h(o[0][2],r)}catch(t){h(o[0][3],t)}var r}function u(t){a("next",t)}function c(t){a("throw",t)}function h(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function P(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:x(t[n](e)),done:!1}:i?i(e):e}:i}}function E(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=g(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,i,(e=t[r](e)).done,e.value)})}}}function O(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var T=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},M=function(t){return M=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},M(t)};function C(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=M(t),n=0;n<r.length;n++)"default"!==r[n]&&y(e,t,r[n]);return T(e,t),e}function L(t){return t&&t.__esModule?t:{default:t}}function R(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)}function I(t,e,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,r):i?i.value=r:e.set(t,r),r}function F(t,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof t?e===t:t.has(e)}function j(t,e,r){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var n,i;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],r&&(i=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");i&&(n=function(){try{i.call(this)}catch(t){return Promise.reject(t)}}),t.stack.push({value:e,dispose:n,async:r})}else r&&t.stack.push({async:!0});return e}var D="function"==typeof SuppressedError?SuppressedError:function(t,e,r){var n=new Error(r);return n.name="SuppressedError",n.error=t,n.suppressed=e,n};function k(t){function e(e){t.error=t.hasError?new D(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,n=0;return function i(){for(;r=t.stack.pop();)try{if(!r.async&&1===n)return n=0,t.stack.push(r),Promise.resolve().then(i);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(i,function(t){return e(t),i()})}else n|=1}catch(t){e(t)}if(1===n)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}function U(t,e){return"string"==typeof t&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,n,i,o){return r?e?".jsx":".js":!n||i&&o?n+i+"."+o.toLowerCase()+"js":t}):t}var G,B={__extends:i,__assign:o,__rest:s,__decorate:a,__param:u,__esDecorate:c,__runInitializers:h,__propKey:l,__setFunctionName:d,__metadata:p,__awaiter:f,__generator:_,__createBinding:y,__exportStar:v,__values:g,__read:m,__spread:w,__spreadArrays:b,__spreadArray:A,__await:x,__asyncGenerator:S,__asyncDelegator:P,__asyncValues:E,__makeTemplateObject:O,__importStar:C,__importDefault:L,__classPrivateFieldGet:R,__classPrivateFieldSet:I,__classPrivateFieldIn:F,__addDisposableResource:j,__disposeResources:k,__rewriteRelativeImportExtension:U},H=e(Object.freeze({__proto__:null,__addDisposableResource:j,get __assign(){return o},__asyncDelegator:P,__asyncGenerator:S,__asyncValues:E,__await:x,__awaiter:f,__classPrivateFieldGet:R,__classPrivateFieldIn:F,__classPrivateFieldSet:I,__createBinding:y,__decorate:a,__disposeResources:k,__esDecorate:c,__exportStar:v,__extends:i,__generator:_,__importDefault:L,__importStar:C,__makeTemplateObject:O,__metadata:p,__param:u,__propKey:l,__read:m,__rest:s,__rewriteRelativeImportExtension:U,__runInitializers:h,__setFunctionName:d,__spread:w,__spreadArray:A,__spreadArrays:b,__values:g,default:B})),V={},W={},N={},z={};var X,q={};var Y,K={};var $,J,Z={};function Q(){return J||(J=1,function(t){var e=N&&N.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=N&&N.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),r((G||(G=1,Object.defineProperty(z,"__esModule",{value:!0})),z),t),r((X||(X=1,Object.defineProperty(q,"__esModule",{value:!0})),q),t),r((Y||(Y=1,Object.defineProperty(K,"__esModule",{value:!0})),K),t),r(($||($=1,Object.defineProperty(Z,"__esModule",{value:!0})),Z),t)}(N)),N}var tt,et={},rt={};var nt,it={};var ot,st,at={},ut={};function ct(){if(st)return at;st=1,Object.defineProperty(at,"__esModule",{value:!0}),at.Trigger=void 0;const t=(ot||(ot=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.isPromise=void 0,ut.isPromise=function(t){return null!=t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}),ut);return at.Trigger=class{constructor(){this._handlers=[],this.length=0}add(t,e){if("function"==typeof t)this._addHandler({func:t,owner:e,once:!1,name:void 0,filter:void 0});else{const e=t,r="number"==typeof e.index?e.index:void 0;this._addHandler({func:e.func,owner:e.owner,once:!1,name:e.name,filter:e.filter},r)}this.length=this._handlers.length}addOnce(t,e){if("function"==typeof t)this._addHandler({func:t,owner:e,once:!0,name:void 0,filter:void 0});else{const e=t,r="number"==typeof e.index?e.index:void 0;this._addHandler({func:e.func,owner:e.owner,once:!0,name:e.name,filter:e.filter},r)}this.length=this._handlers.length}handle(t,e,r){this.add(e?{owner:t,func:e,name:r}:{func:t})}fire(e){if(!this._handlers||!this._handlers.length)return;const r=this._handlers.concat();for(let n=0;n<r.length;n++){const i=r[n];if(i.filter&&!i.filter(i))continue;const o=i.func.call(i.owner,e);if(!(0,t.isPromise)(o)&&!!o||i.once){if(!this._handlers)continue;const t=this._handlers.indexOf(i);-1!==t&&this._handlers.splice(t,1)}}null!=this._handlers&&(this.length=this._handlers.length)}contains(t,e){const r="function"==typeof t?{func:t,owner:e}:t;for(let t=0;t<this._handlers.length;t++)if(this._comparePartial(r,this._handlers[t]))return!0;return!1}remove(t,e){const r="function"==typeof t?{func:t,owner:e}:t;for(let t=0;t<this._handlers.length;t++){const e=this._handlers[t];if(r.func===e.func&&r.owner===e.owner&&r.name===e.name&&r.filter===e.filter)return this._handlers.splice(t,1),void--this.length}}removeAll(t){const e=[];if(t)for(let r=0;r<this._handlers.length;r++){const n=this._handlers[r];this._comparePartial(t,n)||e.push(n)}this._handlers=e,this.length=this._handlers.length}destroy(){this._handlers=null,this.length=null}destroyed(){return null===this._handlers}_addHandler(t,e){null==e?this._handlers.push({func:t.func,owner:t.owner,once:t.once,name:t.name,filter:t.filter}):this._handlers.splice(e,0,{func:t.func,owner:t.owner,once:t.once,name:t.name,filter:t.filter})}_comparePartial(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&((void 0===t.name||t.name===e.name)&&(void 0===t.filter||t.filter===e.filter)))}},at}var ht,lt,dt={};function pt(){return lt||(lt=1,function(t){var e=et&&et.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=et&&et.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),r((tt||(tt=1,Object.defineProperty(rt,"__esModule",{value:!0})),rt),t),r((nt||(nt=1,Object.defineProperty(it,"__esModule",{value:!0})),it),t),r(ct(),t),r(function(){if(ht)return dt;ht=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.ChainTrigger=void 0;const t=ct();let e=class extends t.Trigger{constructor(t,e,r){super(),this.chain=t,this.filter=null!=e?e:null,this.filterOwner=r,this._isActivated=!1}add(t,e){super.add(t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)}addOnce(t,e){super.addOnce(t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)}remove(t,e){super.remove(t,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)}removeAll(t){super.removeAll(t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)}destroy(){super.destroy(),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1}_onChainTriggerFired(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)}};return dt.ChainTrigger=e,dt}(),t)}(et)),et}var ft,_t={},yt={};var vt,gt={};var mt,wt={};var bt,At={};var xt,St={};var Pt,Et={};var Ot,Tt={};var Mt,Ct={};var Lt,Rt={};var It,Ft={};var jt,Dt={};var kt,Ut={};var Gt,Bt={};var Ht,Vt={};var Wt,Nt={};var zt,Xt={};var qt,Yt={};var Kt,$t={};var Jt,Zt={};var Qt,te={};var ee,re={};var ne,ie={};var oe,se={};var ae,ue={};var ce,he={};var le,de={};var pe,fe={};var _e,ye={};var ve,ge={};var me,we={};var be,Ae={};var xe,Se={};var Pe,Ee={};var Oe,Te={};var Me,Ce={};var Le,Re={};var Ie,Fe={};var je,De={};var ke,Ue={};var Ge,Be={};var He,Ve,We={};function Ne(){return Ve||(Ve=1,function(t){var e,r,n,i,o=_t&&_t.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),s=_t&&_t.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||o(e,t,r)};Object.defineProperty(t,"__esModule",{value:!0}),s((ft||(ft=1,Object.defineProperty(yt,"__esModule",{value:!0})),yt),t),s((vt||(vt=1,Object.defineProperty(gt,"__esModule",{value:!0})),gt),t),s((mt||(mt=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.CompositeOperation=void 0,function(t){t[t.SourceOver=0]="SourceOver",t[t.SourceAtop=1]="SourceAtop",t[t.Lighter=2]="Lighter",t[t.Copy=3]="Copy",t[t.ExperimentalSourceIn=4]="ExperimentalSourceIn",t[t.ExperimentalSourceOut=5]="ExperimentalSourceOut",t[t.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",t[t.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",t[t.DestinationOut=8]="DestinationOut",t[t.DestinationOver=9]="DestinationOver",t[t.Xor=10]="Xor",t[t.Difference=11]="Difference",t[t.Saturation=12]="Saturation"}(e||(wt.CompositeOperation=e={}))),wt),t),s((bt||(bt=1,Object.defineProperty(At,"__esModule",{value:!0})),At),t),s((xt||(xt=1,Object.defineProperty(St,"__esModule",{value:!0})),St),t),s((Pt||(Pt=1,Object.defineProperty(Et,"__esModule",{value:!0})),Et),t),s((Ot||(Ot=1,Object.defineProperty(Tt,"__esModule",{value:!0})),Tt),t),s((Mt||(Mt=1,Object.defineProperty(Ct,"__esModule",{value:!0})),Ct),t),s((Lt||(Lt=1,Object.defineProperty(Rt,"__esModule",{value:!0})),Rt),t),s((It||(It=1,Object.defineProperty(Ft,"__esModule",{value:!0})),Ft),t),s((jt||(jt=1,Object.defineProperty(Dt,"__esModule",{value:!0})),Dt),t),s((kt||(kt=1,Object.defineProperty(Ut,"__esModule",{value:!0})),Ut),t),s((Gt||(Gt=1,Object.defineProperty(Bt,"__esModule",{value:!0})),Bt),t),s((Ht||(Ht=1,Object.defineProperty(Vt,"__esModule",{value:!0})),Vt),t),s((Wt||(Wt=1,Object.defineProperty(Nt,"__esModule",{value:!0})),Nt),t),s((zt||(zt=1,Object.defineProperty(Xt,"__esModule",{value:!0})),Xt),t),s((qt||(qt=1,Object.defineProperty(Yt,"__esModule",{value:!0})),Yt),t),s((Kt||(Kt=1,Object.defineProperty($t,"__esModule",{value:!0})),$t),t),s((Jt||(Jt=1,Object.defineProperty(Zt,"__esModule",{value:!0})),Zt),t),s((Qt||(Qt=1,Object.defineProperty(te,"__esModule",{value:!0})),te),t),s((ee||(ee=1,Object.defineProperty(re,"__esModule",{value:!0})),re),t),s((ne||(ne=1,Object.defineProperty(ie,"__esModule",{value:!0})),ie),t),s((oe||(oe=1,Object.defineProperty(se,"__esModule",{value:!0})),se),t),s((ae||(ae=1,Object.defineProperty(ue,"__esModule",{value:!0})),ue),t),s((ce||(ce=1,Object.defineProperty(he,"__esModule",{value:!0})),he),t),s((le||(le=1,Object.defineProperty(de,"__esModule",{value:!0})),de),t),s((pe||(pe=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.AssetLoadErrorType=void 0,function(t){t[t.Unspecified=0]="Unspecified",t[t.RetryLimitExceeded=1]="RetryLimitExceeded",t[t.NetworkError=2]="NetworkError",t[t.ClientError=3]="ClientError",t[t.ServerError=4]="ServerError"}(r||(fe.AssetLoadErrorType=r={}))),fe),t),s((_e||(_e=1,Object.defineProperty(ye,"__esModule",{value:!0})),ye),t),s((ve||(ve=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.FontWeight=void 0,function(t){t[t.Normal=0]="Normal",t[t.Bold=1]="Bold"}(n||(ge.FontWeight=n={}))),ge),t),s((me||(me=1,Object.defineProperty(we,"__esModule",{value:!0}),we.FontFamily=void 0,function(t){t[t.SansSerif=0]="SansSerif",t[t.Serif=1]="Serif",t[t.Monospace=2]="Monospace"}(i||(we.FontFamily=i={}))),we),t),s((be||(be=1,Object.defineProperty(Ae,"__esModule",{value:!0})),Ae),t),s((xe||(xe=1,Object.defineProperty(Se,"__esModule",{value:!0})),Se),t),s((Pe||(Pe=1,Object.defineProperty(Ee,"__esModule",{value:!0})),Ee),t),s((Oe||(Oe=1,Object.defineProperty(Te,"__esModule",{value:!0})),Te),t),s((Me||(Me=1,Object.defineProperty(Ce,"__esModule",{value:!0})),Ce),t),s((Le||(Le=1,Object.defineProperty(Re,"__esModule",{value:!0})),Re),t),s((Ie||(Ie=1,Object.defineProperty(Fe,"__esModule",{value:!0})),Fe),t),s((je||(je=1,Object.defineProperty(De,"__esModule",{value:!0})),De),t),s((ke||(ke=1,Object.defineProperty(Ue,"__esModule",{value:!0})),Ue),t),s((Ge||(Ge=1,Object.defineProperty(Be,"__esModule",{value:!0})),Be),t),s((He||(He=1,Object.defineProperty(We,"__esModule",{value:!0})),We),t)}(_t)),_t}var ze,Xe={},qe={};function Ye(){if(ze)return qe;ze=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.AudioPlayContext=void 0;var t=pt(),e=function(){function e(e){var r;this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.asset=e.asset,this._system=e.system,this._resourceFactory=e.resourceFactory,this._volume=null!==(r=e.volume)&&void 0!==r?r:1,this._id=e.id,this._systemId=e.systemId,this._player=this._createAudioPlayer(),this.asset.onDestroyed.addOnce(this.stop,this)}return Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},enumerable:!1,configurable:!0}),e.prototype.play=function(){this._player.play(this.asset)},e.prototype.stop=function(){this._player.stop()},e.prototype.changeVolume=function(t){this._volume=t,this._player.changeVolume(t)},e.prototype._startSuppress=function(){"music"!==this._systemId?this.stop():this._player.changeVolume(0)},e.prototype._endSuppress=function(){"music"!==this._systemId||this._player.changeVolume(this._volume)},e.prototype._createAudioPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this._system);return t.changeVolume(this._volume),t.onPlay.add(this.onPlay.fire,this.onPlay),t.onStop.add(this.onStop.fire,this.onStop),t},e}();return qe.AudioPlayContext=e,qe}var Ke,$e={};function Je(){return Ke||(Ke=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.ExceptionFactory=void 0,function(t){t.createAssertionError=function(t,e){var r=new Error(t);return r.name="AssertionError",r.cause=e,r},t.createTypeMismatchError=function(t,e,r,n){var i="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var o=void 0;i+=", actual type is "+((o=r&&r.constructor&&r.constructor.name?r.constructor.name:typeof r).length>40?o.substr(0,40):o)}catch(t){}i+=".";var s=new Error(i);return s.name="TypeMismatchError",s.cause=n,s.expected=e,s.actual=r,s},t.createAssetLoadError=function(t,e,r,n){void 0===e&&(e=!0);var i=new Error(t);return i.name="AssetLoadError",i.cause=n,i.retriable=e,i},t.createRequestAssetLoadError=function(t,e,r){var n=new Error(t);return n.name="RequestAssetLoadError",n.detail=e,n.cause=r,n}}(t||($e.ExceptionFactory=t={}))),$e;var t}var Ze,Qe,tr={};function er(){if(Ze)return tr;Ze=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.WeakRefKVS=void 0;var t=function(){function t(t){this._target=t}return t.prototype.deref=function(){return this._target},t}(),e=function(){function e(){this._weakRefClass="undefined"!=typeof WeakRef?WeakRef:t,this._refMap=Object.create(null)}return e.prototype.set=function(t,e){this._refMap[t]&&this.delete(t),this._refMap[t]=new this._weakRefClass(e)},e.prototype.get=function(t){var e=this._refMap[t];if(e)return e.deref()},e.prototype.has=function(t){return t in this._refMap},e.prototype.delete=function(t){delete this._refMap[t]},e.prototype.keys=function(){return Object.keys(this._refMap)},e.prototype.clear=function(){this._refMap=Object.create(null)},e.prototype.clean=function(){for(var t=0,e=Object.entries(this._refMap);t<e.length;t++){var r=e[t],n=r[0];void 0===r[1].deref()&&this.delete(n)}},e}();return tr.WeakRefKVS=e,tr}function rr(){if(Qe)return Xe;Qe=1;var t=Xe&&Xe.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.SoundAudioSystem=Xe.MusicAudioSystem=Xe.AudioSystem=void 0;var e=Ye(),r=Je(),n=er(),i=function(){function t(t){this.id=t.id,this._volume=t.volume||1,this._destroyRequestedAssets={},this._explicitMuted=t.muted||!1,this._suppressed=!1,this._muted=!1,this._contextMap=new n.WeakRefKVS,this._contextCount=0,this._resourceFactory=t.resourceFactory,this._updateMuted()}return Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||t>1||isNaN(t)||"number"!=typeof t)throw r.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!1,configurable:!0}),t.prototype.play=function(t){var e=this.create(t);return e.play(),e},t.prototype.create=function(t){var r=new e.AudioPlayContext({id:this._generateAudioPlayContextId(),resourceFactory:this._resourceFactory,asset:t,system:this,systemId:this.id,volume:1});return this._contextCount%this._contentMapCleaningFrequency===0&&this._contextMap.clean(),this._contextMap.set(r._id,r),r},t.prototype.stopAll=function(){for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],n=this._contextMap.get(r);null==n||n.stop()}this._contextMap.clean()},t.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},t.prototype.cancelRequestDestroy=function(t){delete this._destroyRequestedAssets[t.id]},t.prototype.getDestroyRequestedAsset=function(t){return this._destroyRequestedAssets.hasOwnProperty(t)?this._destroyRequestedAssets[t]:null},t.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=!1,this._suppressed=!1,this._explicitMuted=!1},t.prototype._setMuted=function(t){var e=this._explicitMuted;this._explicitMuted=!!t,this._explicitMuted!==e&&(this._updateMuted(),this._onMutedChanged())},t.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw r.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);this._suppressed=1!==t,this._updateMuted(),this._onPlaybackRateChanged()},t.prototype._updateMuted=function(){this._muted=this._explicitMuted||this._suppressed},t.prototype._generateAudioPlayContextId=function(){return"".concat(this.id,"-").concat(this._contextCount++)},t.prototype._startSuppress=function(){this._setPlaybackRate(100);for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],n=this._contextMap.get(r);null==n||n._startSuppress()}},t.prototype._endSuppress=function(){this._setPlaybackRate(1);for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],n=this._contextMap.get(r);null==n||n._endSuppress()}},t.prototype._onVolumeChanged=function(){for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],n=this._contextMap.get(r);null==n||n.changeVolume(this.volume)}},t}();Xe.AudioSystem=i;var o=function(e){function n(t){var r=e.call(this,t)||this;return r._contentMapCleaningFrequency=5,r._player=void 0,r}return t(n,e),Object.defineProperty(n.prototype,"player",{get:function(){return this._player||(this._player=this._resourceFactory.createAudioPlayer(this),this._player.onPlay.add(this._handlePlay,this),this._player.onStop.add(this._handleStop,this)),this._player},set:function(t){this._player=t},enumerable:!1,configurable:!0}),n.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},n.prototype.createPlayer=function(){return this.player},n.prototype.stopAll=function(){e.prototype.stopAll.call(this),this._player&&this._player.stop()},n.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.onPlay.remove(this._handlePlay,this),this._player.onStop.remove(this._handleStop,this)),this._player=void 0},n.prototype._onVolumeChanged=function(){e.prototype._onVolumeChanged.call(this),this.player._notifyVolumeChanged()},n.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},n.prototype._onPlaybackRateChanged=function(){this.player._changeMuted(this._muted)},n.prototype._handlePlay=function(t){if(t.player!==this._player)throw r.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player")},n.prototype._handleStop=function(t){this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},n}(i);Xe.MusicAudioSystem=o;var s=function(e){function r(t){var r=e.call(this,t)||this;return r._contentMapCleaningFrequency=50,r.players=[],r}return t(r,e),r.prototype.createPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.onPlay.add(this._handlePlay,this),t.onStop.add(this._handleStop,this),t},r.prototype.findPlayers=function(t){for(var e=[],r=0;r<this.players.length;++r){var n=this.players[r].currentAudio;n&&n.id===t.id&&e.push(this.players[r])}return e},r.prototype.stopAll=function(){e.prototype.stopAll.call(this);for(var t=this.players.concat(),r=0;r<t.length;++r)t[r].stop()},r.prototype._reset=function(){e.prototype._reset.call(this);for(var t=0;t<this.players.length;++t){var r=this.players[t];r.onPlay.remove(this._handlePlay,this),r.onStop.remove(this._handleStop,this)}this.players=[]},r.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.players;if(this._suppressed)for(var e=0;e<t.length;++e)t[e]._changeMuted(!0)},r.prototype._handlePlay=function(t){},r.prototype._handleStop=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.onStop.remove(this._handleStop,this),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},r.prototype._onVolumeChanged=function(){e.prototype._onVolumeChanged.call(this);for(var t=0;t<this.players.length;++t)this.players[t]._notifyVolumeChanged()},r}(i);return Xe.SoundAudioSystem=s,Xe}var nr,ir,or={},sr={};function ar(){return nr||(nr=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.PathUtil=void 0,function(t){t.resolvePath=function(e,r){function n(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===r)return e;for(var i=t.splitPath(e),o=n(i.path).concat(n(r)),s=[],a=0;a<o.length;++a){var u=o[a];switch(u){case"..":var c=s.pop();if(void 0===c||""===c||"."===c)throw new Error("PathUtil.resolvePath: invalid arguments");break;case".":0===s.length&&s.push(".");break;case"":s=[""];break;default:s.push(u)}}return i.host+s.join("/")},t.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},t.resolveExtname=function(t){for(var e=t.length-1;e>=0;--e){var r=t.charAt(e);if("."===r)return t.substr(e);if("/"===r)return""}return""},t.makeNodeModulePaths=function(e){var r=t.splitPath(e),n=r.host;"/"===(e=r.path)[e.length-1]&&(e=e.slice(0,e.length-1));for(var i=e.split("/"),o=i.indexOf("node_modules"),s=o>0?o-1:0,a=[],u=i.length-1;u>=s;--u)if("node_modules"!==i[u]){var c=i.slice(0,u+1);c.push("node_modules");var h=c.join("/");a.push(n+h)}return a},t.splitPath=function(t){var e="",r=t.indexOf("//");if(r>=0){var n=t.indexOf("/",r+2);n>=0?(e=t.slice(0,n),t=t.slice(n)):(e=t,t="/")}else e="";return{host:e,path:t}}}(t||(sr.PathUtil=t={}))),sr;var t}function ur(){if(ir)return or;ir=1,Object.defineProperty(or,"__esModule",{value:!0}),or.Module=void 0;var t=ar(),e=function(e){var r=this,n=e.path,i=t.PathUtil.resolveDirname(n),o=e.virtualPath,s=o?t.PathUtil.resolveDirname(o):void 0,a=e.requireFunc,u=e.resolveFunc;this._runtimeValue=Object.create(e.runtimeValueBase,{filename:{value:n,enumerable:!0},dirname:{value:i,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}}),this.id=e.id,this.filename=e.path,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=s?t.PathUtil.makeNodeModulePaths(s):[],this._dirname=i,this._virtualDirname=s;var c=function(t){return a(t,r)};c.resolve=function(t){return u(t,r)},this.require=c};return or.Module=e,or}var cr,hr={};function lr(){if(cr)return hr;cr=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.ShaderProgram=void 0;var t=function(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms};return hr.ShaderProgram=t,hr}var dr,pr={};function fr(){if(dr)return pr;dr=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.VideoSystem=void 0;var t=function(){};return pr.VideoSystem=t,pr}var _r,yr={},vr={},gr={};function mr(){if(_r)return gr;_r=1;var t=gr&&gr.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(gr,"__esModule",{value:!0}),gr.SeedEvent=gr.PlayerInfoEvent=gr.TimestampEvent=gr.LeaveEvent=gr.JoinEvent=gr.OperationEvent=gr.MessageEvent=gr.PointMoveEventBase=gr.PointUpEventBase=gr.PointDownEventBase=gr.PointEventBase=void 0;var e=function(t,e,r,n,i,o,s){this.eventFlags=o,this.local=!!i,this.player=n,this.pointerId=t,this.target=e,this.point=r,this.button=null!=s?s:0};gr.PointEventBase=e;var r=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="point-down",t}return t(r,e),r}(e);gr.PointDownEventBase=r;var n=function(e){function r(t,r,n,i,o,s,a,u,c){var h=e.call(this,t,r,n,s,a,u,c)||this;return h.type="point-up",h.prevDelta=i,h.startDelta=o,h}return t(r,e),r}(e);gr.PointUpEventBase=n;var i=function(e){function r(t,r,n,i,o,s,a,u,c){var h=e.call(this,t,r,n,s,a,u,c)||this;return h.type="point-move",h.prevDelta=i,h.startDelta=o,h}return t(r,e),r}(e);gr.PointMoveEventBase=i;var o=function(t,e,r,n){this.type="message",this.eventFlags=n,this.local=!!r,this.player=e,this.data=t};gr.MessageEvent=o;var s=function(t,e,r,n,i){this.type="operation",this.eventFlags=i,this.local=!!n,this.player=r,this.code=t,this.data=e};gr.OperationEvent=s;var a=function(t,e){this.type="join",this.eventFlags=e,this.player=t};gr.JoinEvent=a;var u=function(t,e){this.type="leave",this.eventFlags=e,this.player=t};gr.LeaveEvent=u;var c=function(t,e,r){this.type="timestamp",this.eventFlags=r,this.player=e,this.timestamp=t};gr.TimestampEvent=c;var h=function(t,e){this.type="player-info",this.eventFlags=e,this.player=t};gr.PlayerInfoEvent=h;var l=function(t,e){this.type="seed",this.eventFlags=e,this.generator=t};return gr.SeedEvent=l,gr}var wr,br={};function Ar(){if(wr)return br;wr=1,Object.defineProperty(br,"__esModule",{value:!0}),br.PlainMatrix=void 0;var t=function(){function t(t,e,r,n,i,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,r,n,i,0,0,o,s)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,r,n,i,o,s,a,u){if(null!=a&&null!=u){var c=i*Math.PI/180,h=Math.cos(c),l=Math.sin(c),d=h*r,p=l*r,f=l*n,_=h*n,y=a*t,v=u*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*y+f*v+o,this._matrix[5]=-p*y-_*v+s}else this._updateWithoutAnchor(t,e,r,n,i,o,s)},t.prototype._updateWithoutAnchor=function(t,e,r,n,i,o,s){var a=i*Math.PI/180,u=Math.cos(a),c=Math.sin(a),h=u*r,l=c*r,d=c*n,p=u*n,f=t/2,_=e/2;this._matrix[0]=h,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-h*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateByInverse=function(t,e,r,n,i,o,s,a,u){if(null!=a&&null!=u){var c=i*Math.PI/180,h=Math.cos(c),l=Math.sin(c),d=h/r,p=l/n,f=l/r,_=h/n,y=a*t,v=u*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+y,this._matrix[5]=p*o-_*s+v}else this._updateByInverseWithoutAnchor(t,e,r,n,i,o,s)},t.prototype._updateByInverseWithoutAnchor=function(t,e,r,n,i,o,s){var a=i*Math.PI/180,u=Math.cos(a),c=Math.sin(a),h=u/r,l=c/n,d=c/r,p=u/n,f=t/2,_=e/2;this._matrix[0]=h,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-h*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.multiply=function(t){var e=this._matrix,r=t._matrix,n=e[0],i=e[1],o=e[2],s=e[3];e[0]=n*r[0]+o*r[1],e[1]=i*r[0]+s*r[1],e[2]=n*r[2]+o*r[3],e[3]=i*r[2]+s*r[3],e[4]=n*r[4]+o*r[5]+e[4],e[5]=i*r[4]+s*r[5]+e[5]},t.prototype.multiplyLeft=function(t){var e=t._matrix,r=this._matrix,n=r[0],i=r[2],o=r[4];r[0]=e[0]*n+e[2]*r[1],r[1]=e[1]*n+e[3]*r[1],r[2]=e[0]*i+e[2]*r[3],r[3]=e[1]*i+e[3]*r[3],r[4]=e[0]*o+e[2]*r[5]+e[4],r[5]=e[1]*o+e[3]*r[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,r=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*r*t.x+-e[2]*r*t.y+(e[5]*e[2]-e[4]*e[3])*r,y:e[0]*r*t.y+-e[1]*r*t.x+(-e[5]*e[0]+e[4]*e[1])*r}},t.prototype.scale=function(t,e){var r=this._matrix;r[0]*=t,r[1]*=e,r[2]*=t,r[3]*=e,r[4]*=t,r[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();return br.PlainMatrix=t,br}var xr,Sr={};function Pr(){if(xr)return Sr;xr=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.Object2D=void 0;var t=Je(),e=Ar(),r=function(){function r(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=null!=t.opacity?t.opacity:1,this.scaleX=null!=t.scaleX?t.scaleX:1,this.scaleY=null!=t.scaleY?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=void 0===t.anchorX?0:t.anchorX,this.anchorY=void 0===t.anchorY?0:t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=0,this.anchorY=0,this._matrix=void 0)}return r.prototype.moveTo=function(e,r){if("number"==typeof e&&"number"!=typeof r)throw t.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof e?(this.x=e,this.y=r):(this.x=e.x,this.y=e.y)},r.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},r.prototype.resizeTo=function(e,r){if("number"==typeof e&&"number"!=typeof r)throw t.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof e?(this.width=e,this.height=r):(this.width=e.width,this.height=e.height)},r.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},r.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},r.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},r.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=new e.PlainMatrix;return this._updateMatrix(),this._matrix._modified=!1,this._matrix},r.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(this.x,this.y)},r}();return Sr.Object2D=r,Sr}var Er,Or,Tr,Mr={};function Cr(){if(Er)return Mr;Er=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.Util=void 0;var t,e=Ne();return function(t){var r;t.distance=function(t,e,r,n){return Math.sqrt(Math.pow(t-r,2)+Math.pow(e-n,2))},t.distanceBetweenOffsets=function(e,r){return t.distance(e.x,e.y,r.x,r.y)},t.distanceBetweenAreas=function(e,r){return t.distance(e.x+e.width/2,e.y+e.height/2,r.x+r.width/2,r.y+r.height/2)},t.charCodeAt=function(t,e){var r=t.charCodeAt(e);return 55296<=r&&r<=56319?r<<16|t.charCodeAt(e+1):56320<=r&&r<=57343?null:r},t.enumToSnakeCase=function(t,e){var r=t[e];return r[0].toLowerCase()+r.slice(1).replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})},t.clamp=function(t,e,r){return Math.min(Math.max(t,e),r)},t.compositeOperationStringTable=((r={})[e.CompositeOperation.SourceOver]="source-over",r[e.CompositeOperation.SourceAtop]="source-atop",r[e.CompositeOperation.Lighter]="lighter",r[e.CompositeOperation.Copy]="copy",r[e.CompositeOperation.ExperimentalSourceIn]="experimental-source-in",r[e.CompositeOperation.ExperimentalSourceOut]="experimental-source-out",r[e.CompositeOperation.ExperimentalDestinationAtop]="experimental-destination-atop",r[e.CompositeOperation.ExperimentalDestinationIn]="experimental-destination-in",r[e.CompositeOperation.DestinationOut]="destination-out",r[e.CompositeOperation.DestinationOver]="destination-over",r[e.CompositeOperation.Xor]="xor",r[e.CompositeOperation.Difference]="difference",r[e.CompositeOperation.Saturation]="saturation",r)}(t||(Mr.Util=t={})),Mr}function Lr(){if(Or)return vr;Or=1;var t=vr&&vr.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(vr,"__esModule",{value:!0}),vr.E=vr.PointMoveEvent=vr.PointUpEvent=vr.PointDownEvent=void 0;var e=pt(),r=mr(),n=Je(),i=Ar(),o=Pr(),s=Cr(),a=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r}(r.PointDownEventBase);vr.PointDownEvent=a;var u=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r}(r.PointUpEventBase);vr.PointUpEvent=u;var c=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r}(r.PointMoveEventBase);vr.PointMoveEvent=c;var h=function(o){function a(t){var e=o.call(this,t)||this;if(e.children=void 0,e.parent=void 0,e._touchable=!1,e.state=0,e._hasTouchableChildren=!1,e._onUpdate=void 0,e._onMessage=void 0,e._onPointDown=void 0,e._onPointMove=void 0,e._onPointUp=void 0,e.tag=t.tag,e.shaderProgram=t.shaderProgram,e.local="non-local"!==t.scene.local||!!t.local,t.children)for(var r=0;r<t.children.length;++r)e.append(t.children[r]);return t.parent&&t.parent.append(e),null!=t.touchable&&(e.touchable=t.touchable),t.hidden&&e.hide(),e.id=t.id,t.scene.register(e),e}return t(a,o),Object.defineProperty(a.prototype,"onUpdate",{get:function(){return this._onUpdate||(this._onUpdate=new e.ChainTrigger(this.scene.onUpdate)),this._onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onMessage",{get:function(){return this._onMessage||(this._onMessage=new e.ChainTrigger(this.scene.onMessage)),this._onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onPointDown",{get:function(){return this._onPointDown||(this._onPointDown=new e.ChainTrigger(this.scene.onPointDownCapture,this._isTargetOperation,this)),this._onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onPointUp",{get:function(){return this._onPointUp||(this._onPointUp=new e.ChainTrigger(this.scene.onPointUpCapture,this._isTargetOperation,this)),this._onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onPointMove",{get:function(){return this._onPointMove||(this._onPointMove=new e.ChainTrigger(this.scene.onPointMoveCapture,this._isTargetOperation,this)),this._onPointMove},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"update",{get:function(){return this.onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"message",{get:function(){return this.onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pointDown",{get:function(){return this.onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pointUp",{get:function(){return this.onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pointMove",{get:function(){return this.onPointMove},enumerable:!1,configurable:!0}),a.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var r=(o=this.children).length,n=0;n<r;++n)o[n].render(t,e);t.translate(-this.x,-this.y)}else{t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity);var i=this.compositeOperation;if(void 0!==i&&t.setCompositeOperation("string"==typeof i?i:s.Util.compositeOperationStringTable[i]),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children){var o=this.children;for(n=0;n<o.length;++n)o[n].render(t,e)}t.restore()}},a.prototype.renderSelf=function(t,e){return!0},a.prototype.game=function(){return this.scene.game},a.prototype.append=function(t){this.insertBefore(t,void 0)},a.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var r=-1;void 0!==e&&(r=this.children.indexOf(e))>-1?this.children.splice(r,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},a.prototype.remove=function(t){if(void 0!==t){var e=this.children?this.children.indexOf(t):-1;if(e<0)throw n.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),(t._touchable||t._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)}else this.parent.remove(this)},a.prototype.destroy=function(){if(!this.destroyed()){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;t>=0;--t)this.children[t].destroy();if(0!==this.children.length)throw n.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._onUpdate&&(this._onUpdate.destroy(),this._onUpdate=void 0),this._onMessage&&(this._onMessage.destroy(),this._onMessage=void 0),this._onPointDown&&(this._onPointDown.destroy(),this._onPointDown=void 0),this._onPointMove&&(this._onPointMove.destroy(),this._onPointMove=void 0),this._onPointUp&&(this._onPointUp.destroy(),this._onPointUp=void 0),this.scene.unregister(this)}},a.prototype.destroyed=function(){return void 0===this.scene},a.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},a.prototype.shouldFindChildrenByPoint=function(t){return!0},a.prototype.findPointSourceByPoint=function(t,e,r){if(!(1&this.state)){var n=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if(this._hasTouchableChildren||r&&this.children&&this.children.length){var i=this.children;if(this.shouldFindChildrenByPoint(n))for(var o=i.length-1;o>=0;--o){var s=i[o];if(r||s._touchable||s._hasTouchableChildren){var a=s.findPointSourceByPoint(t,e,r);if(a)return a}}}if(r||this._touchable)return 0<=n.x&&this.width>n.x&&0<=n.y&&this.height>n.y?{target:this,point:n}:void 0}},a.prototype.visible=function(){return!!(1&~this.state)},a.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},a.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},a.prototype.calculateBoundingRect=function(){return this._calculateBoundingRect(void 0)},a.prototype.localToGlobal=function(t){for(var e=t,r=this;r instanceof a;r=r.parent)e=r.getMatrix().multiplyPoint(e);return e},a.prototype.globalToLocal=function(t){for(var e=new i.PlainMatrix,r=this;r instanceof a;r=r.parent)e.multiplyLeft(r.getMatrix());return e.multiplyInverseForPoint(t)},a.prototype._calculateMatrixTo=function(t){for(var e=new i.PlainMatrix,r=this;r instanceof a&&r!==t;r=r.parent)e.multiplyLeft(r.getMatrix());return e},a.prototype._findLowestCommonAncestorWith=function(t){for(var e={},r=this;r instanceof a;r=r.parent)e[r.id]=!0;for(var n=t;n instanceof a&&!e.hasOwnProperty(n.id);n=n.parent);return n},a.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],i=e.multiplyPoint(n[0]),o={left:i.x,right:i.x,top:i.y,bottom:i.y},s=1;s<n.length;++s)i=e.multiplyPoint(n[s]),o.left>i.x&&(o.left=i.x),o.right<i.x&&(o.right=i.x),o.top>i.y&&(o.top=i.y),o.bottom<i.y&&(o.bottom=i.y);if(void 0!==this.children)for(s=0;s<this.children.length;++s){var a=this.children[s]._calculateBoundingRect(e);a&&(o.left>a.left&&(o.left=a.left),o.right<a.right&&(o.right=a.right),o.top>a.top&&(o.top=a.top),o.bottom<a.bottom&&(o.bottom=a.bottom))}return o}},a.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof a&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},a.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof a&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},a.prototype._isTargetOperation=function(t){return!(1&this.state)&&(t instanceof r.PointEventBase&&(this._touchable&&t.target===this))},a.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var r=this._findTouchableChildren(t.children[e]);if(r)return r}},a}(o.Object2D);return vr.E=h,vr}function Rr(){if(Tr)return yr;Tr=1;var t=yr&&yr.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(yr,"__esModule",{value:!0}),yr.CacheableE=void 0;var e=function(e){function r(t){var r=e.call(this,t)||this;return r._shouldRenderChildren=!0,r._cache=void 0,r._renderer=void 0,r._renderedCamera=void 0,r}return t(r,e),r.prototype.invalidate=function(){this.state&=-3,this.modified()},r.prototype.renderSelf=function(t,e){if(this._renderedCamera!==e&&(this.state&=-3,this._renderedCamera=e),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var r=Math.ceil(this._cacheSize.width),n=Math.ceil(this._cacheSize.height),i=!this._cache||this._cache.width<r||this._cache.height<n;i&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(r,n),this._renderer=this._cache.renderer());var o=this._renderer;o.begin(),i||o.clear(),o.save(),this.renderCache(o,e),o.restore(),this.state|=2,o.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&this.renderSelfFromCache(t),this._shouldRenderChildren},r.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width,this._cacheSize.height,0,0)},r.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,e.prototype.destroy.call(this)},r.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},r}(Lr().E);return yr.CacheableE=e,yr}var Ir,Fr={};function jr(){if(Ir)return Fr;Ir=1;var t=Fr&&Fr.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.FilledRect=void 0;var e=Je(),r=function(r){function n(t){var n=r.call(this,t)||this;if("string"!=typeof t.cssColor)throw e.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",t.cssColor);return n.cssColor=t.cssColor,n}return t(n,r),n.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},n}(Lr().E);return Fr.FilledRect=r,Fr}var Dr,kr,Ur,Gr={},Br={},Hr={};function Vr(){if(Dr)return Hr;Dr=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.SurfaceUtil=void 0;var t,e=Je();return function(t){function r(t,e,r,n,i){var o;void 0===i&&(i=4);for(var s=(o="number"==typeof i?{top:i,bottom:i,left:i,right:i}:i).left,a=n.width-o.right,u=o.top,c=n.height-o.bottom,h=o.left,l=e-o.right,d=o.top,p=r-o.bottom,f=[{x:0,y:0,width:o.left,height:o.top},{x:a,y:0,width:o.right,height:o.top},{x:0,y:c,width:o.left,height:o.bottom},{x:a,y:c,width:o.right,height:o.bottom}],_=[{x:0,y:0},{x:l,y:0},{x:0,y:p},{x:l,y:p}],y=0;y<f.length;++y){var v=f[y];t.save(),t.translate(_[y].x,_[y].y),t.drawImage(n,v.x,v.y,v.width,v.height,0,0),t.restore()}var g=[{x:s,y:0,width:a-s,height:o.top},{x:0,y:u,width:o.left,height:c-u},{x:a,y:u,width:o.right,height:c-u},{x:s,y:c,width:a-s,height:o.bottom}],m=[{x:h,y:0,width:l-h,height:o.top},{x:0,y:d,width:o.left,height:p-d},{x:l,y:d,width:o.right,height:p-d},{x:h,y:p,width:l-h,height:o.bottom}];for(y=0;y<g.length;++y){var w=g[y],b=m[y];t.save(),t.translate(b.x,b.y),t.transform([b.width/w.width,0,0,b.height/w.height,0,0]),t.drawImage(n,w.x,w.y,w.width,w.height,0,0),t.restore()}var A=a-s,x=c-u,S=l-h,P=p-d;t.save(),t.translate(h,d),t.transform([S/A,0,0,P/x,0,0]),t.drawImage(n,s,u,A,x,0,0),t.restore()}t.asSurface=function(t){if(t){if("type"in t&&"image"===t.type)return t.asSurface();if("_drawable"in t)return t;throw e.ExceptionFactory.createTypeMismatchError("SurfaceUtil#asSurface","ImageAsset|Surface",t)}},t.setupAnimatingHandler=function(t,e){e.isPlaying()&&t._handleAnimationStart()},t.migrateAnimatingHandler=function(t,e,r){t._handleAnimationStop(),r.isPlaying()&&t._handleAnimationStart()},t.drawNinePatch=function(t,e,n){void 0===n&&(n=4);var i=t.renderer();i.begin(),i.clear(),r(i,t.width,t.height,e,n),i.end()},t.renderNinePatch=r}(t||(Hr.SurfaceUtil=t={})),Hr}function Wr(){if(kr)return Br;kr=1;var t=Br&&Br.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Br,"__esModule",{value:!0}),Br.Sprite=void 0;var e=Ar(),r=Vr(),n=function(n){function i(t){var e=n.call(this,t)||this;return e.src=t.src,"_drawable"in t.src?e._surface=t.src:e._surface=r.SurfaceUtil.asSurface(t.src),null==t.width&&(e.width=e._surface.width),null==t.height&&(e.height=e._surface.height),e.srcWidth=null!=t.srcWidth?t.srcWidth:e.width,e.srcHeight=null!=t.srcHeight?t.srcHeight:e.height,e.srcX=t.srcX||0,e.srcY=t.srcY||0,e._stretchMatrix=void 0,e._beforeSrc=e.src,e._beforeSurface=e._surface,r.SurfaceUtil.setupAnimatingHandler(e,e._surface),e._invalidateSelf(),e}return t(i,n),i.prototype._handleUpdate=function(){this.modified()},i.prototype._handleAnimationStart=function(){this.onUpdate.contains(this._handleUpdate,this)||this.onUpdate.add(this._handleUpdate,this)},i.prototype._handleAnimationStop=function(){this.destroyed()||this.onUpdate.remove(this._handleUpdate,this)},i.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this._surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},i.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},i.prototype.destroy=function(t){this._surface&&!this._surface.destroyed()&&t&&this._surface.destroy(),this.src=void 0,this._beforeSrc=void 0,this._surface=void 0,n.prototype.destroy.call(this)},i.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=new e.PlainMatrix,this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.src!==this._beforeSrc&&(this._beforeSrc=this.src,"_drawable"in this.src?this._surface=this.src:this._surface=r.SurfaceUtil.asSurface(this.src)),this._surface!==this._beforeSurface&&(r.SurfaceUtil.migrateAnimatingHandler(this,this._beforeSurface,this._surface),this._beforeSurface=this._surface)},i}(Lr().E);return Br.Sprite=n,Br}var Nr,zr,Xr={},qr={};function Yr(){return Nr||(Nr=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.TextAlign=void 0,function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(t||(qr.TextAlign=t={}))),qr;var t}var Kr,$r={};var Jr,Zr={};var Qr,tn={};function en(){if(Qr)return tn;Qr=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.AssetAccessor=void 0;var t=function(){function t(t){this._assetManager=t}return t.prototype.getImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"image")},t.prototype.getAudio=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"audio")},t.prototype.getScript=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"script")},t.prototype.getText=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"text")},t.prototype.getTextContent=function(t){return this.getText(t).data},t.prototype.getJSONContent=function(t){return JSON.parse(this.getTextContent(t))},t.prototype.getVectorImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"vector-image")},t.prototype.getBinary=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"binary")},t.prototype.getBinaryData=function(t){return this.getBinary(t).data},t.prototype.getAllImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","image")},t.prototype.getAllAudios=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","audio")},t.prototype.getAllScripts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","script")},t.prototype.getAllTexts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","text")},t.prototype.getAllVectorImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","vector-image")},t.prototype.getAllBinaries=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","binary")},t.prototype.getImageById=function(t){return this._assetManager.peekLiveAssetById(t,"image")},t.prototype.getAudioById=function(t){return this._assetManager.peekLiveAssetById(t,"audio")},t.prototype.getScriptById=function(t){return this._assetManager.peekLiveAssetById(t,"script")},t.prototype.getTextById=function(t){return this._assetManager.peekLiveAssetById(t,"text")},t.prototype.getTextContentById=function(t){return this.getTextById(t).data},t.prototype.getJSONContentById=function(t){return JSON.parse(this.getTextById(t).data)},t.prototype.getVectorImageById=function(t){return this._assetManager.peekLiveAssetById(t,"vector-image")},t.prototype.getBinaryById=function(t){return this._assetManager.peekLiveAssetById(t,"binary")},t.prototype.getBinaryDataById=function(t){return this.getBinaryById(t).data},t.prototype.pathOf=function(t){return this._assetManager.resolveAccessorPath(t)},t}();return tn.AssetAccessor=t,tn}var rn,nn={};var on,sn={};function an(){if(on)return sn;on=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.AssetHolder=void 0;var t=Je(),e=function(){function e(t){var e=t.assetManager,r=t.assetIds?t.assetIds.concat():[];r.push.apply(r,e.resolvePatternsToAssetIds(t.assetPaths||[])),this.waitingAssetsCount=r.length,this.userData=t.userData,this._assetManager=e,this._assetIds=r,this._assets=[],this._handlerSet=t.handlerSet,this._requested=!1,this._alwaysNotifyFinish=!!t.alwaysNotifyFinish,this._failureAssetIds=[]}return e.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this.userData=void 0,this._handlerSet=void 0,this._assetIds=void 0,this._failureAssetIds=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._handlerSet},e.prototype._onAssetError=function(t,e){var r=this._handlerSet;if(!this.destroyed()&&!r.owner.destroyed()){var n={asset:t,error:e,cancelRetry:!1};if(r.handleLoadFailure.call(r.owner,n),e.retriable&&!n.cancelRetry)this._assetManager.retryLoad(t);else if(this._assetManager.configuration[t.id])r.handleFinish.call(r.owner,this,!1);else if(this._alwaysNotifyFinish){var i=this._peekAssetConfFromAssetId(t.id);this._failureAssetIds.push(i),this._decrementWaitingAssetCount()}}},e.prototype._onAssetLoad=function(t){var e=this._handlerSet;this.destroyed()||e.owner.destroyed()||(e.handleLoad.call(e.owner,t),this._assets.push(t),this._decrementWaitingAssetCount())},e.prototype._decrementWaitingAssetCount=function(){if(--this.waitingAssetsCount,!(this.waitingAssetsCount>0)){if(this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError("AssetHolder#_onAssetLoad: broken waitingAssetsCount");var e=this._handlerSet;e.handleFinish.call(e.owner,this,!0)}},e.prototype._getFailureAssetIds=function(){return this._failureAssetIds},e.prototype._peekAssetConfFromAssetId=function(e){for(var r=0,n=this._assetIds;r<n.length;r++){var i=n[r];if(e===("string"==typeof i?i:i.id))return i}throw t.ExceptionFactory.createAssertionError("AssetHolder#_peekAssetConfFromAssetId: could not peek the asset: ".concat(e))},e}();return sn.AssetHolder=e,sn}var un,cn={};var hn,ln={},dn={};var pn,fn={};var _n,yn={};var vn,gn,mn={},wn={};function bn(){if(vn)return wn;vn=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.EmptyVectorImageAsset=void 0;var t=pt(),e=function(){function e(e,r,n,i,o){this.type="vector-image",this.width=0,this.height=0,this.onDestroyed=new t.Trigger,this.id=e,this.path=r,this.originalPath=r,this.width=n,this.height=i,this.hint=o}return e.prototype.createSurface=function(t,e,r,n,i,o){return null},e.prototype.inUse=function(){return!1},e.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0)},e.prototype.destroyed=function(){return!this.onDestroyed},e.prototype._load=function(t){t._onAssetLoad(this)},e.prototype._assetPathFilter=function(t){return t},e}();return wn.EmptyVectorImageAsset=e,wn}var An,xn,Sn={};function Pn(){if(xn)return ln;xn=1;var t=ln&&ln.__assign||function(){return t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)};Object.defineProperty(ln,"__esModule",{value:!0}),ln.AssetManager=void 0;var e=function(){if(hn)return dn;hn=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.BundledScriptAsset=void 0;var t=pt(),e=function(){function e(e){this.type="script",this.id=e.id,this.script="",this.path=e.path,this.originalPath=e.path,this.onDestroyed=new t.Trigger,this.execute=e.execute.bind(this)}return e.prototype.inUse=function(){return!0},e.prototype.destroy=function(){this.onDestroyed.destroyed()||this.onDestroyed.destroy(),this.execute=void 0},e.prototype.destroyed=function(){return!this.execute},e.prototype._load=function(t){t._onAssetLoad(this)},e.prototype._assetPathFilter=function(t){return t},e}();return dn.BundledScriptAsset=e,dn}(),r=function(){if(pn)return fn;pn=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.BundledTextAsset=void 0;var t=pt(),e=function(){function e(e){this.type="text",this.id=e.id,this.data=e.data,this.path=e.path,this.originalPath=e.path,this.onDestroyed=new t.Trigger}return e.prototype.inUse=function(){return!0},e.prototype.destroy=function(){this.onDestroyed.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0),this.data=void 0},e.prototype.destroyed=function(){return!this.onDestroyed},e.prototype._load=function(t){t._onAssetLoad(this)},e.prototype._assetPathFilter=function(t){return t},e}();return fn.BundledTextAsset=e,fn}(),n=function(){if(_n)return yn;_n=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.EmptyBinaryAsset=void 0;var t=pt(),e=function(){function e(e,r){this.type="binary",this.onDestroyed=new t.Trigger,this.id=e,this.path=r,this.originalPath=r,this.data=new ArrayBuffer(0)}return e.prototype.inUse=function(){return!1},e.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0)},e.prototype.destroyed=function(){return!this.onDestroyed},e.prototype._load=function(t){t._onAssetLoad(this)},e.prototype._assetPathFilter=function(t){return t},e}();return yn.EmptyBinaryAsset=e,yn}(),i=function(){if(gn)return mn;gn=1;var t=mn&&mn.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(mn,"__esModule",{value:!0}),mn.EmptyGeneratedVectorImageAsset=void 0;var e=function(e){function r(t,r,n){var i=e.call(this,t,r,0,0)||this;return i.data=n,i}return t(r,e),r}(bn().EmptyVectorImageAsset);return mn.EmptyGeneratedVectorImageAsset=e,mn}(),o=bn(),s=function(){if(An)return Sn;An=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.PartialImageAsset=void 0;var t=pt(),e=function(){function e(e,r,n,i,o,s){this.type="image",this.hint=void 0,this.onDestroyed=new t.Trigger,this._surface=null,this._loadHandler=null,this.id=r,this.path=n,this.originalPath=n,this.width=s.width,this.height=s.height,this._slice=s,this._resourceFactory=e;var a="".concat(r,"/<internal>");this._src=e.createImageAsset(a,n,i,o)}return e.prototype.initialize=function(t){this.hint=t,this._src.initialize(t)},e.prototype.inUse=function(){return!1},e.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.fire(this),this._src.destroy(),this._src=null,this._slice=null,this._resourceFactory=null,this._surface=null,this._loadHandler=null,this.onDestroyed.destroy(),this.onDestroyed=void 0)},e.prototype.destroyed=function(){return!this._src},e.prototype.asSurface=function(){if(this._surface)return this._surface;var t=this._slice,e=t.x,r=t.y,n=t.width,i=t.height,o=this._resourceFactory.createSurface(n,i),s=o.renderer();return s.begin(),s.drawImage(this._src.asSurface(),e,r,n,i,0,0),s.end(),this._surface=o,o},e.prototype._load=function(t){this._loadHandler=t,this._src._load(this)},e.prototype._onAssetLoad=function(t){this._loadHandler._onAssetLoad(this)},e.prototype._onAssetError=function(t,e){this._loadHandler._onAssetError(this,e)},e.prototype._assetPathFilter=function(t){return t},e}();return Sn.PartialImageAsset=e,Sn}(),a=Je(),u=fr(),c=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1};function h(t){var e=/([^\*\\\?]*)(\\\*|\\\?|\?|\*(?!\*)|\*\*\/|$)/g,r={"":"","\\*":"\\*","\\?":"\\?","*":"[^/]*","?":"[^/]","**/":"(?:^/)?(?:[^/]+/)*"},n=/[\\^$.*+?()[\]{}|]/g;function i(t){return t.replace(n,"\\$&")}for(var o="",s=e.exec(t);s&&""!==s[0];s=e.exec(t))o+=i(s[1])+r[s[2]];var a=new RegExp("^"+o+"$");return function(t){return a.test(t)}}var l=function(){function l(t,e,r,n,i){this._resourceFactory=t.resourceFactory,this._audioSystemManager=t.audio,this._defaultAudioSystemId=t.defaultAudioSystemId,this._audioSystemConfMap=function(t){void 0===t&&(t={});var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var r in e)r in t||(t[r]=e[r]);return t}(r),this.configuration=this._normalize(e||{}),this._assets={},this._virtualPathToIdTable={},this._liveAssetVirtualPathTable={},this._liveAssetPathTable={},this._moduleMainScripts=n||{},this._moduleMainPaths=null!=i?i:null,this._refCounts={},this._loadings={},this._generatedAssetCount=0,this._assetBundle=null;for(var o=Object.keys(this.configuration),s=0;s<o.length;++s){var a=o[s],u=this.configuration[a];this._virtualPathToIdTable[u.virtualPath]=a}}return l.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAssetPathTable=void 0,this._refCounts=void 0,this._loadings=void 0,this._assetBundle=void 0},l.prototype.destroyed=function(){return void 0===this._assets},l.prototype.retryLoad=function(t){if(!this._loadings.hasOwnProperty(t.id))throw a.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var e=this._loadings[t.id];if(e.errorCount>l.MAX_ERROR_COUNT){if(!this.configuration[t.id])return;throw a.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}e.loading||(e.loading=!0,t._load(this))},l.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var r in e)e.hasOwnProperty(r)&&e[r].global&&t.push(r);return t},l.prototype.preloadScriptAssetPaths=function(){var t=[];return this._assetBundle&&t.push.apply(t,Object.values(this._assetBundle.assets).filter(function(t){return"script"===t.type&&t.preload}).map(function(t){return t.path})),t.push.apply(t,Object.values(this.configuration).filter(function(t){return"script"===t.type&&t.global&&t.preload}).map(function(t){return t.virtualPath})),t=t.map(function(t){return t.startsWith("./")?t:"./".concat(t)})},l.prototype.resolvePatternsToAssetIds=function(t){if(0===t.length)return[];for(var e=Object.keys(this._virtualPathToIdTable),r=[],n=0;n<t.length;++n)for(var i=t[n],o="string"==typeof i?h(this._replaceModulePathToAbsolute(i)):i,s=0;s<e.length;++s){var a=e[s];o("/"+a)&&r.push(this._virtualPathToIdTable[a])}return r},l.prototype.requestAsset=function(t,e){var r;"string"==typeof t?r=t:"uri"in t?(r=t.id,t=this._normalizeAssetBaseDeclaration(r,Object.create(t))):r=t.id;var n,i=!1;if(this._assets.hasOwnProperty(r))++this._refCounts[r],e._onAssetLoad(this._assets[r]);else if(this._loadings.hasOwnProperty(r))(n=this._loadings[r]).handlers.push(e),++this._refCounts[r],i=!0;else{var o=this._getAudioSystem(t),s=null==o?void 0:o.getDestroyRequestedAsset(r);if(o&&s)o.cancelRequestDestroy(s),this._addAssetToTables(s),this._refCounts[r]=1,e._onAssetLoad(s);else{var a=this._createAssetFor(t);n=new c(a,e),this._loadings[r]=n,this._refCounts[r]=1,i=!0,n.loading=!0,a._load(this)}}return i},l.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},l.prototype.requestAssets=function(t,e){for(var r=0,n=0,i=t.length;n<i;++n)this.requestAsset(t[n],e)&&++r;return r},l.prototype.unrefAssets=function(t){for(var e=0,r=t.length;e<r;++e)this.unrefAsset(t[e])},l.prototype.peekLiveAssetByAccessorPath=function(t,e){if("/"!==(t=this._replaceModulePathToAbsolute(t))[0])throw a.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): accessorPath must start with '/'");var r=t.slice(1),n=this._liveAssetVirtualPathTable[r];if(!n||e!==n.type)throw a.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): No ".concat(e," asset for ").concat(t));return n},l.prototype.peekLiveAssetById=function(t,e){var r=this._assets[t];if(!r||e!==r.type)throw a.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetById(): No ".concat(e," asset for id ").concat(t));return r},l.prototype.peekAllLiveAssetsByPattern=function(t,e){for(var r=Object.keys(this._liveAssetVirtualPathTable),n="string"==typeof t?h(this._replaceModulePathToAbsolute(t)):t,i=[],o=0;o<r.length;++o){var s=r[o],a=this._liveAssetVirtualPathTable[s];if(!e||a.type===e)n("/"+s)&&i.push(a)}return i},l.prototype.resolveAccessorPath=function(t){var e=this._assets[t];if(!e)return null;var r=this._liveAssetPathTable[e.path];return r?"/"+r:null},l.prototype.setAssetBundle=function(t){this._assetBundle=t},l.prototype._normalize=function(t){var e={};if(!(t instanceof Object))throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var r in t)if(t.hasOwnProperty(r)){var n=this._normalizeAssetBaseDeclaration(r,Object.create(t[r]));if(!n.path)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+r);if(!n.virtualPath)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+r);n.global||(n.global=!1),e[r]=n}return e},l.prototype._normalizeAssetBaseDeclaration=function(t,e){if(!e.type)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+t);if("image"===e.type){if("number"!=typeof e.width)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+t);if("number"!=typeof e.height)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+t);e.slice=e.slice?(r=e.slice,Array.isArray(r)?{x:r[0],y:r[1],width:r[2],height:r[3]}:r):void 0}var r;if("audio"===e.type){void 0===e.duration&&(e.duration=0);var n=this._audioSystemConfMap[e.systemId];if(void 0===e.loop&&(e.loop=!!n&&!!n.loop),void 0===e.hint&&(e.hint=n?n.hint:{}),"music"!==e.systemId&&"sound"!==e.systemId)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong systemId given for the audio asset: "+t)}if("video"===e.type&&!e.useRealSize){if("number"!=typeof e.width)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+t);if("number"!=typeof e.height)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+t);e.useRealSize=!1}if("vector-image"===e.type){if("number"!=typeof e.width)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the vector-image asset: "+t);if("number"!=typeof e.height)throw a.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the vector-image asset: "+t)}return e},l.prototype._createAssetFor=function(i){var c,h,l,d;if(this._assetBundle&&"string"==typeof i){var p=i,f=this._assetBundle.assets[p];switch(null==f?void 0:f.type){case"script":return new e.BundledScriptAsset(t({id:p},f));case"text":return new r.BundledTextAsset(t({id:p},f))}}if("string"==typeof i)h=i,d=this.configuration[h],l=this.configuration[h].path;else{if(!("uri"in i))return this._createGeneratedAssetFor(i);h=i.id,d=i,l=i.uri}var _=this._resourceFactory;if(!d)throw a.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+h);var y=d.type;switch(y){case"image":if(Array.isArray(d.slice))throw new Error("AssetManager#_createAssetFor: array type of configuration.slice is not yet supported");var v=d.slice?new s.PartialImageAsset(_,h,l,d.width,d.height,d.slice):_.createImageAsset(h,l,d.width,d.height);return v.initialize(d.hint),v;case"audio":var g=d.systemId?this._audioSystemManager[d.systemId]:this._audioSystemManager[this._defaultAudioSystemId];return _.createAudioAsset(h,l,d.duration,g,!!d.loop,null!==(c=d.hint)&&void 0!==c?c:{},d.offset);case"text":return _.createTextAsset(h,l);case"script":return _.createScriptAsset(h,l,d.exports);case"video":var m=new u.VideoSystem;return _.createVideoAsset(h,l,d.width,d.height,m,!!d.loop,!!d.useRealSize);case"vector-image":return _.createVectorImageAsset?_.createVectorImageAsset(h,l,d.width,d.height,d.hint):new o.EmptyVectorImageAsset(h,l,d.width,d.height,d.hint);case"binary":return _.createBinaryAsset?_.createBinaryAsset(h,l):new n.EmptyBinaryAsset(h,l);default:throw a.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+y+" for asset ID: "+h)}},l.prototype._createGeneratedAssetFor=function(t){var e=this._resourceFactory,r="%akashic%/generated-asset-".concat(this._generatedAssetCount++);if("vector-image"===t.type)return e.createVectorImageAssetFromString?e.createVectorImageAssetFromString(t.id,r,t.data):new i.EmptyGeneratedVectorImageAsset(t.id,r,t.data);throw a.ExceptionFactory.createAssertionError("AssertionError#_createFromAssetGenerationFor: unsupported asset type ".concat(t.type," for asset ID: ").concat(t.id))},l.prototype._releaseAsset=function(t){var e=this._assets[t]||this._loadings[t]&&this._loadings[t].asset,r=null;if(e)if(r=e.path,e.inUse())if("audio"===e.type)e._system.requestDestroy(e);else{if("video"!==e.type)throw a.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+e.id);e.destroy()}else e.destroy();if(delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]){var n=this.configuration[t].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],r&&this._liveAssetPathTable.hasOwnProperty(r)&&delete this._liveAssetPathTable[r]}},l.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},l.prototype._onAssetError=function(t,e){if(!this.destroyed()&&!t.destroyed()){var r=this._loadings[t.id],n=r.handlers;r.loading=!1,++r.errorCount,r.errorCount>l.MAX_ERROR_COUNT&&e.retriable&&(e=a.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,null,e)),e.retriable||delete this._loadings[t.id];for(var i=0;i<n.length;++i)n[i]._onAssetError(t,e,this.retryLoad.bind(this))}},l.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed()){var e=this._loadings[t.id];e.loading=!1,delete this._loadings[t.id],this._addAssetToTables(t);for(var r=e.handlers,n=0;n<r.length;++n)r[n]._onAssetLoad(t)}},l.prototype._replaceModulePathToAbsolute=function(t){if("/"===t[0]||"*"===t[0])return t;for(var e in this._moduleMainScripts)if(this._moduleMainScripts.hasOwnProperty(e)&&0===t.lastIndexOf(e,0))return"/node_modules/"+t;return t},l.prototype._getAudioSystem=function(t){var e=null;if("string"==typeof t)e=this.configuration[t];else if("uri"in t){e=t}return e?"audio"!==e.type?null:e.systemId?this._audioSystemManager[e.systemId]:this._audioSystemManager[this._defaultAudioSystemId]:null},l.prototype._addAssetToTables=function(t){var e;if(this._assets[t.id]=t,this.configuration[t.id]?e=this.configuration[t.id].virtualPath:this._assetBundle&&this._assetBundle.assets[t.id]&&(e=this._assetBundle.assets[t.id].path),e){if(this._liveAssetVirtualPathTable.hasOwnProperty(e)){if(this._liveAssetVirtualPathTable[e].path!==t.path)throw a.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[e]=t;this._liveAssetPathTable.hasOwnProperty(t.path)||(this._liveAssetPathTable[t.path]=e)}},l.MAX_ERROR_COUNT=3,l}();return ln.AssetManager=l,ln}var En,On={};var Tn,Mn={};function Cn(){if(Tn)return Mn;Tn=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.AudioSystemManager=void 0;var t=rr(),e=Je(),r=function(){function r(e){this._muted=!1,this._resourceFactory=e,this.music=new t.MusicAudioSystem({id:"music",muted:this._muted,resourceFactory:e}),this.sound=new t.SoundAudioSystem({id:"sound",muted:this._muted,resourceFactory:e})}return r.prototype.create=function(t){if("music"===t._system.id)return this.music.create(t);if("sound"===t._system.id)return this.sound.create(t);throw e.ExceptionFactory.createAssertionError('AudioSystemManager#create(): unknown systemId "'.concat(t._system.id,'" for asset ID "').concat(t.id,'"'))},r.prototype.play=function(t){if("music"===t._system.id)return this.music.play(t);if("sound"===t._system.id)return this.sound.play(t);throw e.ExceptionFactory.createAssertionError('AudioSystemManager#play(): unknown systemId "'.concat(t._system.id,'" for asset ID "').concat(t.id,'"'))},r.prototype._reset=function(){this._muted=!1,this.music._reset(),this.sound._reset()},r.prototype._setMuted=function(t){this._muted!==t&&(this._muted=t,this.music._setMuted(t),this.sound._setMuted(t))},r.prototype._setPlaybackRate=function(t){this.music._setPlaybackRate(t),this.sound._setPlaybackRate(t)},r.prototype._startSuppress=function(){this.music._startSuppress(),this.sound._startSuppress()},r.prototype._endSuppress=function(){this.music._endSuppress(),this.sound._endSuppress()},r.prototype.stopAll=function(){this.music.stopAll(),this.sound.stopAll()},r}();return Mn.AudioSystemManager=r,Mn}var Ln,Rn={};var In,Fn,jn={},Dn={};function kn(){if(In)return Dn;In=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.Font=void 0;var t=Cr(),e=function(){function e(){}return e.prototype.measureText=function(e){for(var r=0,n=0,i=0,o=null,s=0;s<e.length;s++){var a=t.Util.charCodeAt(e,s);if(a){var u=this.glyphForCharacter(a);!u||u.x<0||u.y<0||u.width<0||u.height<0||(0===s&&(n=-u.offsetX),o=u,r+=u.advanceWidth)}}return o&&(i=r+o.offsetX+o.width-o.advanceWidth),{width:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:i}},e}();return Dn.Font=e,Dn}function Un(){if(Fn)return jn;Fn=1;var t=jn&&jn.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(jn,"__esModule",{value:!0}),jn.BitmapFont=void 0;var e=kn(),r=Vr(),n=function(e){function n(t){var n=e.call(this)||this;return n.surface=r.SurfaceUtil.asSurface(t.src),t.glyphInfo?(n.map=t.glyphInfo.map,n.defaultGlyphWidth=t.glyphInfo.width,n.defaultGlyphHeight=t.glyphInfo.height,n.missingGlyph=t.glyphInfo.missingGlyph,n.size=t.glyphInfo.height):(n.map=t.map||{},n.defaultGlyphWidth=t.defaultGlyphWidth||0,n.defaultGlyphHeight=t.defaultGlyphHeight||0,n.missingGlyph=t.missingGlyph,n.size=t.defaultGlyphHeight||0),n}return t(n,e),n.prototype.glyphForCharacter=function(t){var e=this.map[t]||this.missingGlyph;if(!e)return null;var r=void 0===e.width?this.defaultGlyphWidth:e.width,n=void 0===e.height?this.defaultGlyphHeight:e.height,i=e.offsetX||0,o=e.offsetY||0,s=void 0===e.advanceWidth?r:e.advanceWidth,a=0===r||0===n?void 0:this.surface;return{code:t,x:e.x,y:e.y,width:r,height:n,surface:a,offsetX:i,offsetY:o,advanceWidth:s,isSurfaceValid:!0,_atlas:null}},n.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},n.prototype.destroyed=function(){return!this.map},n}(e.Font);return jn.BitmapFont=n,jn}var Gn,Bn={};var Hn,Vn={};function Wn(){if(Hn)return Vn;Hn=1;var t=Vn&&Vn.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.Camera2D=void 0;var e=function(e){function r(t){var r=e.call(this,t)||this;return r.local=!!t.local,r.name=t.name,r._modifiedCount=0,r}return t(r,e),r.deserialize=function(t){return new r(t.param)},r.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0)},r.prototype.serialize=function(){return{param:{local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,anchorX:this.anchorX,anchorY:this.anchorY,compositeOperation:this.compositeOperation}}},r.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},r.prototype._updateMatrix=function(){this._matrix&&(this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(-this.x,-this.y))},r}(Pr().Object2D);return Vn.Camera2D=e,Vn}var Nn,zn={};var Xn,qn={},Yn={};function Kn(){if(Xn)return Yn;Xn=1;var t=Yn&&Yn.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.CameraCancellingE=void 0;var e=Wn(),r=Pr(),n=function(n){function i(t){var e=n.call(this,t)||this;return e._canceller=new r.Object2D,e}return t(i,n),i.prototype.renderSelf=function(t,r){if(!this.children)return!1;if(r&&r instanceof e.Camera2D){var n=r,i=this._canceller;n.x===i.x&&n.y===i.y&&n.angle===i.angle&&n.scaleX===i.scaleX&&n.scaleY===i.scaleY||(i.x=n.x,i.y=n.y,i.angle=n.angle,i.scaleX=n.scaleX,i.scaleY=n.scaleY,i._matrix&&(i._matrix._modified=!0)),t.save(),t.transform(i.getMatrix()._matrix)}for(var o=this.children,s=0;s<o.length;++s)o[s].render(t,r);return r&&t.restore(),!1},i}(Lr().E);return Yn.CameraCancellingE=n,Yn}var $n,Jn,Zn,Qn,ti,ei={},ri={},ni={},ii={};function oi(){if($n)return ii;$n=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.Timer=void 0;var t=pt(),e=function(){function e(e,r){this.interval=e,this._scaledInterval=Math.round(e*r),this.onElapse=new t.Trigger,this.elapsed=this.onElapse,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.onElapse;)this.onElapse.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.onElapse||0===this.onElapse.length},e.prototype.destroy=function(){this.interval=void 0,this.onElapse.destroy(),this.onElapse=void 0,this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.onElapse},e}();return ii.Timer=e,ii}function si(){if(Jn)return ni;Jn=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.TimerManager=ni.TimerIdentifier=void 0;var t=Je(),e=oi(),r=function(){function t(t,e,r,n,i){this._timer=t,this._handler=e,this._handlerOwner=r,this._fired=n,this._firedOwner=i,this._timer.onElapse.add(this._handleElapse,this)}return t.prototype.destroy=function(){this._timer.onElapse.remove(this._handleElapse,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._handleElapse=function(){this.destroyed()||(this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this))},t}();ni.TimerIdentifier=r;var n=function(){function n(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return n.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},n.prototype.destroyed=function(){return void 0===this._timers},n.prototype.createTimer=function(r){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),r<0)throw t.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");r<1&&(r=1);for(var n=Math.min(1e3,r*this._fps),i=0;i<this._timers.length;++i)if(this._timers[i].interval===r&&this._timers[i]._scaledElapsed<n)return this._timers[i];var o=new e.Timer(r,this._fps);return this._timers.push(o),o},n.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(!(e<0||(this._timers.splice(e,1),t.destroy(),this._timers.length))){if(!this._registered)return;this._trigger.remove(this._tick,this),this._registered=!1}}},n.prototype.setTimeout=function(t,e,n){var i=this.createTimer(e),o=new r(i,t,n,this._onTimeoutFired,this);return this._identifiers.push(o),o},n.prototype.clearTimeout=function(t){this._clear(t)},n.prototype.setInterval=function(t,e,n){var i=this.createTimer(e),o=new r(i,t,n);return this._identifiers.push(o),o},n.prototype.clearInterval=function(t){this._clear(t)},n.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},n.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(!(e<0)){this._identifiers.splice(e,1);var r=t._timer;t.destroy(),this.deleteTimer(r)}},n.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(!(e<0||t.destroyed())){this._identifiers.splice(e,1);var r=t._timer;t.destroy(),this.deleteTimer(r)}},n}();return ni.TimerManager=n,ni}function ai(){if(Zn)return ri;Zn=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.Scene=void 0;var t=pt(),e=an(),r=Wn(),n=Je(),i=si(),o=function(){function o(r){var n=r.game,o=void 0===r.local||!1===r.local?"non-local":!0===r.local?"full-local":r.local,s=void 0!==r.tickGenerationMode?r.tickGenerationMode:"by-clock";this.name=r.name,this.game=n,this.local=o,this.tickGenerationMode=s,this.onLoad=new t.Trigger,this.loaded=this.onLoad,this._onReady=new t.Trigger,this._ready=this._onReady,this.assets={},this.asset=n.asset,this.vars={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState="initial",this.onUpdate=new t.Trigger,this.update=this.onUpdate,this._timer=new i.TimerManager(this.onUpdate,this.game.fps),this.onAssetLoad=new t.Trigger,this.onAssetLoadFailure=new t.Trigger,this.onAssetLoadComplete=new t.Trigger,this.assetLoaded=this.onAssetLoad,this.assetLoadFailed=this.onAssetLoadFailure,this.assetLoadCompleted=this.onAssetLoadComplete,this.onMessage=new t.Trigger,this.onPointDownCapture=new t.Trigger,this.onPointMoveCapture=new t.Trigger,this.onPointUpCapture=new t.Trigger,this.onOperation=new t.Trigger,this.message=this.onMessage,this.pointDownCapture=this.onPointDownCapture,this.pointMoveCapture=this.onPointMoveCapture,this.pointUpCapture=this.onPointUpCapture,this.operation=this.onOperation,this.children=[],this.state="standby",this.onStateChange=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e.AssetHolder({assetManager:this.game._assetManager,assetIds:r.assetIds,assetPaths:r.assetPaths,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:null}),this.seethrough=null!=r.seethrough&&r.seethrough}return o.prototype.modified=function(t){this.game.modified()},o.prototype.destroy=function(){this.state="before-destroyed",this.onStateChange.fire(this.state);for(var t=0,e=[this.game.db,this.game._localDb];t<e.length;t++)for(var r=e[t],n=0,i=r.keys();n<i.length;n++){var o=i[n],s=r.get(o);(null==s?void 0:s.scene)===this&&s.destroy()}this._timer.destroy(),this.onUpdate.destroy(),this.onMessage.destroy(),this.onPointDownCapture.destroy(),this.onPointMoveCapture.destroy(),this.onPointUpCapture.destroy(),this.onOperation.destroy(),this.onLoad.destroy(),this.onAssetLoad.destroy(),this.onAssetLoadFailure.destroy(),this.onAssetLoadComplete.destroy(),this.assets={},this.vars={};for(var a=0;a<this._assetHolders.length;++a)this._assetHolders[a].destroy();this._sceneAssetHolder.destroy(),this.game=void 0,this._waitingPrepare=void 0,this.state="destroyed",this.onStateChange.fire(this.state),this.onStateChange.destroy()},o.prototype.destroyed=function(){return void 0===this.game},o.prototype.createTimer=function(t){return this._timer.createTimer(t)},o.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},o.prototype.setInterval=function(t,e,r){return this._timer.setInterval(t,e,r)},o.prototype.clearInterval=function(t){this._timer.clearInterval(t)},o.prototype.setTimeout=function(t,e,r){return this._timer.setTimeout(t,e,r)},o.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},o.prototype.isCurrentScene=function(){return this.game.scene()===this},o.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw n.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},o.prototype.end=function(){if(!this.isCurrentScene())throw n.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},o.prototype.register=function(t){this.game.register(t),t.scene=this},o.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},o.prototype.append=function(t){this.insertBefore(t,void 0)},o.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var r=-1;void 0!==e&&(r=this.children.indexOf(e))>-1?this.children.splice(r,0,t):this.children.push(t),this.modified(!0)},o.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},o.prototype.findPointSourceByPoint=function(t,e,n){for(var i="non-local"!==this.local,o=this.children,s=n&&n instanceof r.Camera2D?n.getMatrix():void 0,a=o.length-1;a>=0;--a){var u=o[a].findPointSourceByPoint(t,s,e);if(u)return u.local=u.target&&u.target.local||i,u}return{target:void 0,point:void 0,local:i}},o.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},o.prototype.requestAssets=function(t,r){var i,o,s=this;if("ready-fired"!==this._loadingState&&"loaded-fired"!==this._loadingState)throw n.ExceptionFactory.createAssertionError("Scene#requestAssets(): can be called after loaded.");Array.isArray(t)?(i=t,o=!1):(i=t.assetIds,o=!!t.notifyErrorOnCallback);var a=new e.AssetHolder({assetManager:this.game._assetManager,assetIds:i,alwaysNotifyFinish:o,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:function(){if(!s.destroyed()){var t=a._getFailureAssetIds();if(t.length){var e=n.ExceptionFactory.createRequestAssetLoadError("Scene#requestAssets(): failed to load the asset. refer to the 'detail' property for more information.",{failureAssetIds:t});r(e)}else r()}}});this._assetHolders.push(a),a.request()},o.prototype._activate=function(){this.state="active",this.onStateChange.fire(this.state)},o.prototype._deactivate=function(){this.state="deactive",this.onStateChange.fire(this.state)},o.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||!!this._waitingPrepare},o.prototype._load=function(){this._loaded||(this._loaded=!0,this._sceneAssetHolder.request()||this._notifySceneReady())},o.prototype._handleSceneAssetLoad=function(t){this.assets[t.id]=t,this.onAssetLoad.fire(t),this.onAssetLoadComplete.fire(t)},o.prototype._handleSceneAssetLoadFailure=function(t){this.onAssetLoadFailure.fire(t),this.onAssetLoadComplete.fire(t.asset)},o.prototype._handleSceneAssetLoadFinish=function(t,e){e?t.userData?this.game._pushPostTickTask(t.userData,null):this._loaded&&this._notifySceneReady():this.game.terminateGame()},o.prototype._notifySceneReady=function(){this._loadingState="ready",this.game._pushPostTickTask(this._fireReady,this)},o.prototype._fireReady=function(){this.destroyed()||(this._onReady.fire(this),this._loadingState="ready-fired")},o.prototype._fireLoaded=function(){this.destroyed()||"loaded-fired"!==this._loadingState&&(this.onLoad.fire(this),this._loadingState="loaded-fired")},o}();return ri.Scene=o,ri}function ui(){if(Qn)return ei;Qn=1;var t=ei&&ei.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ei,"__esModule",{value:!0}),ei.LoadingScene=void 0;var e=pt(),r=Je(),n=function(n){function i(t){var r=this;return t.local=!0,(r=n.call(this,t)||this).onTargetReset=new e.Trigger,r.onTargetReady=new e.Trigger,r.onTargetAssetLoad=new e.Trigger,r.targetReset=r.onTargetReset,r.targetReady=r.onTargetReady,r.targetAssetLoaded=r.onTargetAssetLoad,r._explicitEnd=!!t.explicitEnd,r._targetScene=void 0,r}return t(i,n),i.prototype.destroy=function(){this._clearTargetScene(),n.prototype.destroy.call(this)},i.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,"loaded-fired"!==this._loadingState?this.onLoad.addOnce(this._doReset,this):this._doReset()},i.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},i.prototype.end=function(){if(!this._targetScene||"initial"===this._targetScene._loadingState){var t="LoadingScene#end(): the target scene is in invalid state: "+(this._targetScene?this._targetScene._loadingState:"(no scene)");throw r.ExceptionFactory.createAssertionError(t)}this.game._popSceneRaw(!0),this.game._pushPostTickTask(this._targetScene._fireLoaded,this._targetScene),this._clearTargetScene()},i.prototype._clearTargetScene=function(){this._targetScene&&(this.onLoad.removeAll({owner:this,func:this._doReset}),this._targetScene._onReady.removeAll({owner:this}),this._targetScene.onAssetLoad.removeAll({owner:this}),this._targetScene=void 0)},i.prototype._doReset=function(){this.onTargetReset.fire(this._targetScene),"initial"===this._targetScene._loadingState||"ready"===this._targetScene._loadingState?(this._targetScene._onReady.add(this._handleReady,this),this._targetScene.onAssetLoad.add(this._handleAssetLoad,this),this._targetScene._load()):this._handleReady(this._targetScene)},i.prototype._handleAssetLoad=function(t){this.onTargetAssetLoad.fire(t)},i.prototype._handleReady=function(t){this.onTargetReady.fire(t),this._explicitEnd||this.end()},i}(ai().Scene);return ei.LoadingScene=n,ei}function ci(){if(ti)return qn;ti=1;var t=qn&&qn.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(qn,"__esModule",{value:!0}),qn.DefaultLoadingScene=void 0;var e=Kn(),r=jr(),n=function(n){function i(t){var e=n.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return"compact"===t.style?(e._barWidth=e.game.width/4,e._barHeight=5,e._style="compact"):(e._barWidth=Math.min(e.game.width,Math.max(100,e.game.width/2)),e._barHeight=5,e._style="default"),e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.onLoad.add(e._handleLoad,e),e.onTargetReset.add(e._handleTargetReset,e),e.onTargetAssetLoad.add(e._handleTargetAssetLoad,e),e}return t(i,n),i.prototype._handleLoad=function(){var t,n,i,o;if("compact"===this._style){var s=.05*Math.min(this.game.width,this.game.height);t=this.game.width-s-this._barWidth,n=this.game.height-s-this._barHeight,i="transparent"}else t=(this.game.width-this._barWidth)/2,n=(this.game.height-this._barHeight)/2,i="rgba(0, 0, 0, 0.8)";return this.append(new e.CameraCancellingE({scene:this,children:[new r.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:i,children:[new r.FilledRect({scene:this,x:t,y:n,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[o=new r.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),o.onUpdate.add(this._handleUpdate,this),this._gauge=o,!0},i.prototype._handleUpdate=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},i.prototype._handleTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},i.prototype._handleTargetAssetLoad=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},i}(ui().LoadingScene);return qn.DefaultLoadingScene=n,qn}var hi,li={};function di(){if(hi)return li;hi=1;var t=li&&li.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(li,"__esModule",{value:!0}),li.DefaultSkippingScene=void 0;var e=Kn(),r=jr(),n=ai();function i(t,e,r,n){var i=.15*n;return 0<t&&t<i?function(t,e,r,n){return(t/=n/2)<1?r/2*t*t+e:-r/2*(--t*(t-2)-1)+e}(t,e,r,i):e+r}var o=function(e){function r(t){var r=e.call(this,t)||this;return r.age=0,r.offsetDurationFrame=t.offsetDurationFrame,r.easingDurationFrame=t.easingDurationFrame,r.valueFrom=t.valueFrom,r.valueTo=t.valueTo,r.easing=t.easing,r.onUpdate.add(r._incrementAge,r),r.onUpdate.add(r._updateColor,r),r}return t(r,e),r.prototype._incrementAge=function(){this.age++},r.prototype._updateColor=function(){var t=this._calculateCSSColor();this.cssColor!==t&&(this.cssColor=t,this.modified())},r.prototype._calculateCSSColor=function(){var t=this,e=t.age,r=t.offsetDurationFrame,n=t.easingDurationFrame,i=t.valueFrom,o=t.valueTo,s=(0,t.easing)(Math.max(e-r,0)%n,i,o-i,n);return"rgb(".concat(s,", ").concat(s,", ").concat(s,")")},r}(r.FilledRect),s=function(r){function n(t){var e=r.call(this,{game:t.game,local:"full-local",name:"akashic:default-skipping-scene"})||this;return"indicator"===t.style&&e.onLoad.addOnce(e._handleLoadForIndicator,e),e}return t(n,r),n.prototype._handleLoadForIndicator=function(){var t=this,r=this.game,n=.03*Math.min(r.width,r.height)|0,s=.03*Math.min(r.width,r.height)|0,a=.05*Math.min(r.width,r.height)|0,u=.05*Math.min(r.width,r.height)|0,c=400/(1e3/r.fps),h=2500/(1e3/r.fps),l=255,d=i;this.append(new e.CameraCancellingE({scene:this,children:[3,2,1,0].map(function(e,i){return new o({scene:t,cssColor:"rgb(".concat(l,", ").concat(l,", ").concat(l,")"),width:n,height:n,x:r.width-i*(n+s)-a,y:r.height-u,anchorX:1,anchorY:1,offsetDurationFrame:c*e,easingDurationFrame:h,valueFrom:205,valueTo:l,easing:d})})}))},n}(n.Scene);return li.DefaultSkippingScene=s,li}var pi,fi={};var _i,yi,vi,gi,mi={},wi={},bi={},Ai={};function xi(){if(_i)return Ai;_i=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.SurfaceAtlasSlot=void 0;var t=function(t,e,r,n){this.x=t,this.y=e,this.width=r,this.height=n,this.prev=null,this.next=null};return Ai.SurfaceAtlasSlot=t,Ai}function Si(){if(yi)return bi;yi=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.SurfaceAtlas=void 0;var t=xi();var e=function(){function e(e){this._surface=e,this._emptySurfaceAtlasSlotHead=new t.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return e.prototype.reset=function(){var e=this._surface.renderer();e.begin(),e.clear(),e.end(),this._emptySurfaceAtlasSlotHead=new t.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize.width=0,this._usedRectangleAreaSize.height=0},e.prototype._acquireSurfaceAtlasSlot=function(e,r){e+=1,r+=1;var n=function(t,e,r){for(;t;){if(t.width>=e&&t.height>=r)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,e,r);if(!n)return null;var i,o,s=n.width-e,a=n.height-r;s<=a?(i=new t.SurfaceAtlasSlot(n.x+e,n.y,s,r),o=new t.SurfaceAtlasSlot(n.x,n.y+r,n.width,a)):(i=new t.SurfaceAtlasSlot(n.x,n.y+r,e,a),o=new t.SurfaceAtlasSlot(n.x+e,n.y,s,n.height)),i.prev=n.prev,i.next=o,null===i.prev?this._emptySurfaceAtlasSlotHead=i:i.prev.next=i,o.prev=i,o.next=n.next,o.next&&(o.next.prev=o);var u=new t.SurfaceAtlasSlot(n.x,n.y,e,r);return this._updateUsedRectangleAreaSize(u),u},e.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,r=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),r>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=r)},e.prototype.addSurface=function(t,e,r,n,i){var o=this._acquireSurfaceAtlasSlot(n,i);if(!o)return null;var s=this._surface.renderer();return s.begin(),s.drawImage(t,e,r,n,i,o.x,o.y),s.end(),o},e.prototype.destroy=function(){this._surface.destroy()},e.prototype.destroyed=function(){return this._surface.destroyed()},e.prototype.getAtlasUsedSize=function(){return this._usedRectangleAreaSize},e.prototype.getAccessScore=function(){return this._accessScore},e}();return bi.SurfaceAtlas=e,bi}function Pi(){if(vi)return wi;vi=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.SurfaceAtlasSet=void 0;var t=Si();var e=function(){function e(t){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=t.resourceFactory,this._currentAtlasIndex=0;var r=t.hint?t.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:e.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=function(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}(r)}return e.prototype._deleteAtlas=function(t){for(var e=0;e<t;++e){var r=this._spliceLeastFrequentlyUsedAtlas();if(!r)return;r.destroy()}},e.prototype._findLeastFrequentlyUsedAtlasIndex=function(){for(var t=Number.MAX_VALUE,e=-1,r=0;r<this._surfaceAtlases.length;++r)this._surfaceAtlases[r]._accessScore<=t&&(t=this._surfaceAtlases[r]._accessScore,e=r);return e},e.prototype._spliceLeastFrequentlyUsedAtlas=function(){var t=this._findLeastFrequentlyUsedAtlasIndex();if(-1===t)return null;this._currentAtlasIndex>=t&&--this._currentAtlasIndex;for(var e=this._surfaceAtlases.splice(t,1)[0],r=this._atlasGlyphsTable.splice(t,1)[0],n=0;n<r.length;n++){var i=r[n];i.surface=void 0,i.isSurfaceValid=!1,i._atlas=null}return e},e.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var r=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,n=this._surfaceAtlases[r],i=n.addSurface(t.surface,t.x,t.y,t.width,t.height);if(i)return this._currentAtlasIndex=r,t.surface&&t.surface.destroy(),t.surface=n._surface,t.x=i.x,t.y=i.y,t._atlas=n,this._atlasGlyphsTable[r].push(t),!0}return!1},e.prototype._reallocateAtlas=function(){var e=null;this._surfaceAtlases.length>=this._maxAtlasNum?(e=this._spliceLeastFrequentlyUsedAtlas()).reset():e=new t.SurfaceAtlas(this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height)),this._surfaceAtlases.push(e),this._atlasGlyphsTable.push([]),this._currentAtlasIndex=this._surfaceAtlases.length-1},e.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},e.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},e.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},e.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},e.prototype.getAtlasUsedSize=function(){return this._atlasSize},e.prototype.addGlyph=function(t){return!(t.width>this._atlasSize.width||t.height>this._atlasSize.height)&&(!!this._moveGlyphSurface(t)||(this._reallocateAtlas(),this._moveGlyphSurface(t)))},e.prototype.touchGlyph=function(t){t._atlas&&(t._atlas._accessScore+=1);for(var e=0;e<this._surfaceAtlases.length;e++){this._surfaceAtlases[e]._accessScore/=2}},e.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},e.prototype.destroyed=function(){return void 0===this._surfaceAtlases},e.INITIAL_MAX_SURFACEATLAS_NUM=10,e}();return wi.SurfaceAtlasSet=e,wi}var Ei,Oi={};var Ti,Mi={};function Ci(){if(Ti)return Mi;Ti=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.EventConverter=void 0;var t=Lr(),e=mr(),r=Je(),n=function(){function n(t){var e;this._game=t.game,this._playerId=null!==(e=t.playerId)&&void 0!==e?e:null,this._playerTable={}}return n.prototype.toGameEvent=function(n){var i,o,s,a,u,c,h,l,d,p=n[0],f=n[1],_=n[2],y=this._playerTable[_]||{id:_};switch(p){case 0:return y={id:_,name:n[3]},this._playerTable[_]&&null!=this._playerTable[_].userData&&(y.userData=this._playerTable[_].userData),this._playerTable[_]=y,new e.JoinEvent(y,f);case 1:return delete this._playerTable[y.id],new e.LeaveEvent(y,f);case 2:return l=n[3],new e.TimestampEvent(l,y,f);case 3:return y={id:_,name:n[3],userData:n[4]},this._playerTable[_]=y,new e.PlayerInfoEvent(y,f);case 32:return h=n[4],new e.MessageEvent(n[3],y,h,f);case 33:return h=n[8],i=n[3],s=null==(o=n[6])?void 0:o>=0?this._game.db.get(o):this._game._localDb.get(o),a={x:n[4],y:n[5]},d=n[7],new t.PointDownEvent(i,s,a,y,h,f,d);case 34:return h=n[12],i=n[3],s=null==(o=n[10])?void 0:o>=0?this._game.db.get(o):this._game._localDb.get(o),a={x:n[4],y:n[5]},u={x:n[6],y:n[7]},c={x:n[8],y:n[9]},d=n[11],new t.PointMoveEvent(i,s,a,c,u,y,h,f,d);case 35:return h=n[12],i=n[3],s=null==(o=n[10])?void 0:o>=0?this._game.db.get(o):this._game._localDb.get(o),a={x:n[4],y:n[5]},u={x:n[6],y:n[7]},c={x:n[8],y:n[9]},d=n[11],new t.PointUpEvent(i,s,a,c,u,y,h,f,d);case 64:h=n[5];var v=n[3],g=n[4],m=this._game._decodeOperationPluginOperation(v,g);return new e.OperationEvent(v,m,y,h,f);default:throw r.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},n.prototype.toPlaylogEvent=function(t,e){var n,i,o,s,a,u,c,h,l;switch(t.type){case"join":case"leave":throw r.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+t.type);case"timestamp":var d=t;return l=e?null!==(n=d.player.id)&&void 0!==n?n:null:this._playerId,[2,d.eventFlags,l,d.timestamp];case"player-info":var p=t;return l=e?null!==(i=p.player.id)&&void 0!==i?i:null:this._playerId,[3,p.eventFlags,l,p.player.name,p.player.userData];case"point-down":var f=t;return h=f.target?f.target.id:null,l=e&&f.player?null!==(o=f.player.id)&&void 0!==o?o:null:this._playerId,[33,f.eventFlags,l,f.pointerId,f.point.x,f.point.y,h,f.button,!!f.local];case"point-move":var _=t;return h=_.target?_.target.id:null,l=e&&_.player?null!==(s=_.player.id)&&void 0!==s?s:null:this._playerId,[34,_.eventFlags,l,_.pointerId,_.point.x,_.point.y,_.startDelta.x,_.startDelta.y,_.prevDelta.x,_.prevDelta.y,h,_.button,!!_.local];case"point-up":var y=t;return h=y.target?y.target.id:null,l=e&&y.player?null!==(a=y.player.id)&&void 0!==a?a:null:this._playerId,[35,y.eventFlags,l,y.pointerId,y.point.x,y.point.y,y.startDelta.x,y.startDelta.y,y.prevDelta.x,y.prevDelta.y,h,y.button,!!y.local];case"message":var v=t;return l=e&&v.player?null!==(u=v.player.id)&&void 0!==u?u:null:this._playerId,[32,v.eventFlags,l,v.data,!!v.local];case"operation":var g=t;return l=e&&g.player?null!==(c=g.player.id)&&void 0!==c?c:null:this._playerId,[64,g.eventFlags,l,g.code,g.data,!!g.local];default:throw r.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},n.prototype.makePlaylogOperationEvent=function(t){var e=this._playerId;return[64,null!=t.priority?3&t.priority:0,e,t._code,t.data,!!t.local]},n}();return Mi.EventConverter=n,Mi}var Li,Ri={};var Ii,Fi={};var ji,Di={};var ki,Ui={};var Gi,Bi={};var Hi,Vi={};function Wi(){if(Hi)return Vi;Hi=1;var t=Vi&&Vi.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.InitialScene=void 0;var e=pt(),r=function(r){function n(t){var n=r.call(this,t)||this;return n.onAllAssetsLoad=new e.Trigger,n.onLoad.add(n._handleLoad,n),n}return t(n,r),n.prototype.destroy=function(){r.prototype.destroy.call(this),this.onAllAssetsLoad.destroyed()||this.onAllAssetsLoad.destroy(),this.onAllAssetsLoad=void 0},n.prototype._handleLoad=function(){if(this.game._configuration.assetBundle){var t=this.game._moduleManager._internalRequire(this.game._configuration.assetBundle);this.game._assetManager.setAssetBundle(t);var e=Object.keys(t.assets);this.requestAssets(e,this._handleRequestAssets.bind(this))}else this.onAllAssetsLoad.fire()},n.prototype._handleRequestAssets=function(){this.onAllAssetsLoad.fire()},n}(ai().Scene);return Vi.InitialScene=r,Vi}var Ni,zi={};var Xi,qi={};var Yi,Ki={};function $i(){if(Yi)return Ki;Yi=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.Math=void 0;var t,e=Je();return function(t){var r=globalThis.Math.PI,n=2*r,i=1e7,o="undefined"!=typeof Float32Array?Float32Array:Array;function s(t,e){for(var r=-t*t,n=1,i=0,o=1,s=1;s<=2*e;s++)n+=o=o*r/((i+=2)*(i+1));return n*=t}t.initialize=function(e){var a,u,c,h=null!==(a=null==e?void 0:e.tableSize)&&void 0!==a?a:16384,l=null===(u=null==e?void 0:e.wholePeriod)||void 0===u||u,d=null!==(c=null==e?void 0:e.iterationNum)&&void 0!==c?c:5,p=l?2*r:r/2,f=(h-1)/p,_=function(t,e,r){for(var n=t.length,i=e/(n-1),o=0;o<n;o++){var a=i*o;t[o]=s(a,r)}return t}(new o(h),p,d),y=l?r:r/2,v=(h-1)/y,g=function(t,e,n){for(var o=t.length,a=e/(o-1),u=0;u<o;u++){var c=a*u,h=s(c,n),l=s(c+r/2,n);t[u]=globalThis.Math.abs(l)<1e-7?l>=0?i:-i:h/l}return t}(new o(h),y,d);t.sin=function(t){var e=f;if((t%=n)<0&&(t+=n),l)return _[t*e|0];var i=1;t>r&&(t-=r,i=-1);var o=t*e|0;return o>_.length-1&&(o=2*(_.length-1)-o),i*_[o]},t.cos=function(e){return t.sin(e+r/2)},t.tan=function(t){var e=v;if((t%=r)<0&&(t+=r),l)return g[t*e|0];var n=1;t>r/2&&(t=r-t,n=-1);var i=t*e|0;return i>g.length-1&&(i=2*(g.length-1)-i),n*g[i]}},t.sin=function(t){throw e.ExceptionFactory.createAssertionError("Math.sin: module not initialized. Call g.Math.initialize() before calling this function.")},t.cos=function(t){throw e.ExceptionFactory.createAssertionError("Math.cos: module not initialized. Call g.Math.initialize() before calling this function.")},t.tan=function(t){throw e.ExceptionFactory.createAssertionError("Math.tan: module not initialized. Call g.Math.initialize() before calling this function.")}}(t||(Ki.Math=t={})),Ki}var Ji,Zi={},Qi={};function to(){if(Ji)return Qi;Ji=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.RequireCachedValue=void 0;var t=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();return Qi.RequireCachedValue=t,Qi}var eo,ro,no={};function io(){if(eo)return no;eo=1,Object.defineProperty(no,"__esModule",{value:!0}),no.ScriptAssetContext=void 0;var t=Je(),e=function(){function e(t,e){this._asset=t,this._module=e,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},e.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._module._runtimeValue),this._module.loaded=!0),this._module.exports},e}();return no.ScriptAssetContext=e,no}function oo(){if(ro)return Zi;ro=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.ModuleManager=void 0;var t=ar(),e=Je(),r=ur(),n=to(),i=io(),o=function(){function o(t,e){this._assetManager=e,this._runtimeValueBase=t,this._scriptCaches={}}return o.prototype._internalRequire=function(t,e){var r=this._require(t,e);return r.__esModule?r.default:r},o.prototype._require=function(o,s){var a,u,c=this,h=this._assetManager._liveAssetVirtualPathTable,l=this._assetManager._moduleMainScripts;if(-1===o.indexOf("/")&&this._assetManager._assets.hasOwnProperty(o)&&(a=this._assetManager._assets[o],u=this._assetManager._liveAssetPathTable[a.path]),u||(u=this._resolvePath(o,s),/^\//.test(u)&&(u=u.slice(1))),this._scriptCaches.hasOwnProperty(u))return this._scriptCaches[u]._cachedValue();if(a=l[o]?h[u]:this._findAssetByPathAsFile(u,h)){if(this._scriptCaches.hasOwnProperty(u))return this._scriptCaches[u]._cachedValue();if("script"===a.type){var d=new r.Module({runtimeValueBase:this._runtimeValueBase,id:a.id,path:a.path,virtualPath:this._assetManager._liveAssetPathTable[a.path],requireFunc:function(t,e){return c._require(t,e)},resolveFunc:function(t,e){return c._resolvePath(t,e)}}),p=new i.ScriptAssetContext(a,d);return this._scriptCaches[u]=p,p._executeScript(s)}if("text"===a.type&&a&&".json"===t.PathUtil.resolveExtname(o))return(this._scriptCaches[u]=new n.RequireCachedValue(JSON.parse(a.data)))._cachedValue()}throw e.ExceptionFactory.createAssertionError("g._require: can not find module: "+o)},o.prototype._resolvePath=function(r,n){var i=null,o=this._assetManager._liveAssetVirtualPathTable,s=this._assetManager._moduleMainScripts;if(/^\.\/|^\.\.\/|^\//.test(r)){if(n){if(!n._virtualDirname)throw e.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the module path without virtualPath");i=t.PathUtil.resolvePath(n._virtualDirname,r)}else if(/^\.\//.test(r))i=r.substring(2);else{if(!/^\//.test(r))throw e.ExceptionFactory.createAssertionError("g._require.resolve: entry point path must start with './'");i=r.substring(1)}if(h=this._resolveAbsolutePathAsFile(i,o))return h;if(h=this._resolveAbsolutePathAsDirectory(i,o))return h}else{if(s[r])return s[r];var a=n?n.paths.concat():[];a.push("node_modules");for(var u=0;u<a.length;++u){var c=a[u],h=t.PathUtil.resolvePath(c,r);if(i=this._resolveAbsolutePathAsFile(h,o))return i;if(i=this._resolveAbsolutePathAsDirectory(h,o))return i}}throw e.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the path: "+r)},o.prototype._findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},o.prototype._resolveAbsolutePathAsFile=function(t,e){return e.hasOwnProperty(t)?"/"+t:e.hasOwnProperty(t+".js")?"/"+t+".js":null},o.prototype._resolveAbsolutePathAsDirectory=function(e,r){var n=e+"/package.json",i=r[n],o=this._assetManager._moduleMainPaths;if(o&&o[n])return o[n];if(r.hasOwnProperty(n)&&"text"===i.type){var s=JSON.parse(i.data);if(s&&"string"==typeof s.main){var a=this._resolveAbsolutePathAsFile(t.PathUtil.resolvePath(e,s.main),r);if(a)return a}}return n=e+"/index.js",r.hasOwnProperty(n)?"/"+n:null},o}();return Zi.ModuleManager=o,Zi}var so,ao={};var uo,co={};var ho,lo={};function po(){if(ho)return lo;ho=1;var t=lo&&lo.__assign||function(){return t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)};Object.defineProperty(lo,"__esModule",{value:!0}),lo.OperationPluginManager=void 0;var e=pt(),r=function(){function e(t,e,r){this._code=t,this._handler=r,this._handlerOwner=e}return e.prototype.onOperation=function(e){var r;r=Array.isArray(e)?{_code:this._code,data:e}:t({_code:this._code},e),this._handler.call(this._handlerOwner,r)},e}(),n=function(){function t(t,r){this.onOperate=new e.Trigger,this.operated=this.onOperate,this.plugins={},this._game=t,this._viewInfo=r}return t.prototype.register=function(t,e,r){return this._instantiateOperationPlugin(t,e,r)},t.prototype.start=function(t){var e=this.plugins[t];e&&e.start()},t.prototype.stop=function(t){var e=this.plugins[t];e&&e.stop()},t.prototype.destroy=function(){this.stopAll(),this.onOperate.destroy(),this.onOperate=void 0,this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0},t.prototype.reset=function(){this.stopAll(),this.onOperate.removeAll(),this.plugins={}},t.prototype.stopAll=function(){for(var t in this.plugins)if(this.plugins.hasOwnProperty(t)){var e=this.plugins[t];e&&e.stop()}},t.prototype._instantiateOperationPlugin=function(t,e,n){if(t.isSupported()){if(this.plugins[e])throw new Error("Plugin#code conflicted for code: ".concat(e));var i=new t(this._game,this._viewInfo,n);this.plugins[e]=i;var o=new r(e,this.onOperate,this.onOperate.fire);return i.operationTrigger.add(o.onOperation,o),i}},t}();return lo.OperationPluginManager=n,lo}var fo,_o={};var yo,vo={};var go,mo={};var wo,bo={};function Ao(){if(wo)return bo;wo=1,Object.defineProperty(bo,"__esModule",{value:!0}),bo.PointEventResolver=void 0;var t=function(){function t(t){var e;this._currentPoints=0,this._pointEventMap={},this._sourceResolver=t.sourceResolver,this._playerId=t.playerId,this._maxPoints=null!==(e=t.maxPoints)&&void 0!==e?e:null}return t.prototype.pointDown=function(t){if(null!=this._maxPoints&&this._currentPoints>=this._maxPoints)return null;var e=this._sourceResolver.findPointSource(t.offset),r=e.point?e.point:t.offset,n=e.target?e.target.id:void 0,i=e.local;this._pointEventMap[t.identifier]={targetId:n,local:i,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}},this._currentPoints++;var o=[33,2,this._playerId,t.identifier,r.x,r.y,n,t.button];return e&&e.local&&o.push(e.local),o},t.prototype.pointMove=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(e,t.offset,r,n);var i=[34,2,this._playerId,t.identifier,e.point.x,e.point.y,n.x,n.y,r.x,r.y,e.targetId,t.button];return e.local&&i.push(e.local),i},t.prototype.pointUp=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(e,t.offset,r,n),delete this._pointEventMap[t.identifier],this._currentPoints--;var i=[35,2,this._playerId,t.identifier,e.point.x,e.point.y,n.x,n.y,r.x,r.y,e.targetId,t.button];return e.local&&i.push(e.local),i},t.prototype._pointMoveAndUp=function(t,e,r,n){n.x=e.x-t.start.x,n.y=e.y-t.start.y,r.x=e.x-t.prev.x,r.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();return bo.PointEventResolver=t,bo}var xo,So={};function Po(){if(xo)return So;xo=1,Object.defineProperty(So,"__esModule",{value:!0}),So.RandomGenerator=void 0;var t=function(t){this.seed=t};return So.RandomGenerator=t,So}var Eo,Oo={};var To,Mo={};var Co,Lo={};var Ro,Io={};var Fo,jo={};var Do,ko={};var Uo,Go={};var Bo,Ho={};var Vo,Wo={};function No(){if(Vo)return Wo;Vo=1,Object.defineProperty(Wo,"__esModule",{value:!0}),Wo.Xorshift=void 0;var t=function(){function t(t){var e=Array.isArray(t)?t:this.generateSeeds(t);this._state0U=0|e[0],this._state0L=0|e[1],this._state1U=0|e[2],this._state1L=0|e[3]}return t.deserialize=function(e){return new t([e._state0U,e._state0L,e._state1U,e._state1L])},t.prototype.initState=function(t){var e=this.generateSeeds(t);this._state0L=0|e[0],this._state0U=0|e[1],this._state1L=0|e[2],this._state1U=0|e[3]},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,r=this._state1U,n=this._state1L,i=(n>>>0)+(e>>>0),o=r+t+(i/2>>>31)>>>0,s=i>>>0;this._state0U=r,this._state0L=n;var a=0,u=0;a=(t^=a=t<<23|(-512&e)>>>9)^r,u=(e^=u=e<<23)^n;a^=t>>>18,u^=e>>>18|(262143&t)<<14;return a^=r>>>5,u^=n>>>5|(31&r)<<27,this._state1U=a,this._state1L=u,[o,s]},t.prototype.random=function(){var t=this.randomInt();return 2.3283064365386963e-10*t[0]+2220446049250313e-31*(t[1]>>>12)},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t.prototype.generateSeeds=function(t){var e=1812433253;return[t=e*(t^t>>30)+1,t=e*(t^t>>30)+2,t=e*(t^t>>30)+3,t=e*(t^t>>30)+4]},t}();return Wo.Xorshift=t,Wo}var zo,Xo={};function qo(){if(zo)return Xo;zo=1;var t=Xo&&Xo.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Xo,"__esModule",{value:!0}),Xo.XorshiftRandomGenerator=void 0;var e=Je(),r=Po(),n=No(),i=function(r){function i(t,i){var o=this;if(void 0===t)throw e.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(o=r.call(this,t)||this)._xorshift=i?n.Xorshift.deserialize(i):new n.Xorshift(t),o}return t(i,r),i.deserialize=function(t){return new i(t._seed,t._xorshift)},i.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},i.prototype.generate=function(){return this._xorshift.random()},i.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},i}(r.RandomGenerator);return Xo.XorshiftRandomGenerator=i,Xo}var Yo,Ko,$o={};function Jo(){return Ko||(Ko=1,function(t){var e=W&&W.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=W&&W.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.PathUtil=t.VideoSystem=t.ShaderProgram=t.Module=t.AudioSystem=void 0,r(Q(),t),r(pt(),t),r(Ne(),t);var n=rr();Object.defineProperty(t,"AudioSystem",{enumerable:!0,get:function(){return n.AudioSystem}});var i=ur();Object.defineProperty(t,"Module",{enumerable:!0,get:function(){return i.Module}});var o=lr();Object.defineProperty(t,"ShaderProgram",{enumerable:!0,get:function(){return o.ShaderProgram}});var s=fr();Object.defineProperty(t,"VideoSystem",{enumerable:!0,get:function(){return s.VideoSystem}});var a=ar();Object.defineProperty(t,"PathUtil",{enumerable:!0,get:function(){return a.PathUtil}}),r(Rr(),t),r(Lr(),t),r(jr(),t),r(function(){if(Ur)return Gr;Ur=1;var t=Gr&&Gr.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.FrameSprite=void 0;var e=pt(),r=function(r){function n(t){var n=r.call(this,t)||this;return n._lastUsedIndex=0,n.frameNumber=t.frameNumber||0,n.frames=null!=t.frames?t.frames:[0],n.interval=t.interval,n._timer=void 0,n.loop=null==t.loop||t.loop,n.onFinish=new e.Trigger,n.finished=n.onFinish,n._modifiedSelf(),n}return t(n,r),n.createBySprite=function(t,e,r){var i=new n({scene:t.scene,src:t.src,width:void 0===e?t.width:e,height:void 0===r?t.height:r});return i.srcHeight=void 0===r?t.srcHeight:r,i.srcWidth=void 0===e?t.srcWidth:e,i},n.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.onElapse.add(this._handleElapse,this)},n.prototype.destroy=function(t){this.stop(),r.prototype.destroy.call(this,t)},n.prototype.stop=function(){this._timer&&this._free()},n.prototype.modified=function(t){this._modifiedSelf(t),r.prototype.modified.call(this,t)},n.prototype._handleElapse=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.onFinish.fire()):this.frameNumber++,this.modified()},n.prototype._free=function(){this._timer&&(this._timer.onElapse.remove(this._handleElapse,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},n.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this._surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},n.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},n}(Wr().Sprite);return Gr.FrameSprite=r,Gr}(),t),r(function(){if(zr)return Xr;zr=1;var t=Xr&&Xr.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.Label=void 0;var e=Yr(),r=Cr(),n=function(n){function i(t){var r=n.call(this,t)||this;return r.text=t.text,r.font=t.font,r.textAlign=null!=t.textAlign?t.textAlign:e.TextAlign.Left,r.glyphs=new Array(t.text.length),r.fontSize=null!=t.fontSize?t.fontSize:t.font.size,r.maxWidth=t.maxWidth,r.widthAutoAdjust=null==t.widthAutoAdjust||t.widthAutoAdjust,r.textColor=t.textColor,r._realTextAlign="left",r._textWidth=0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return t(i,n),i.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},i.prototype.invalidate=function(){this._invalidateSelf(),n.prototype.invalidate.call(this)},i.prototype.renderSelfFromCache=function(t){var e;switch(this._realTextAlign){case"center":e=this.widthAutoAdjust?this._overhangLeft:0;break;case"right":e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width,this._cacheSize.height,e,0)},i.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=this.maxWidth&&this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this._realTextAlign){case"center":r=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case"right":r=this.width-(this._textWidth+this._overhangLeft)*e;break;default:r-=this._overhangLeft*e}t.translate(Math.round(r),0),1!==e&&t.transform([e,0,0,1,0,0]),t.save();for(var n=this.fontSize/this.font.size,i=0,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,u=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(u))?(s.surface&&(t.save(),t.translate(Math.round(i),0),t.transform([n,0,0,n,0,0]),t.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),t.restore()),i+=a):this._outputOfWarnLogWithNoGlyph(u,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation("source-atop"),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},i.prototype.destroy=function(){n.prototype.destroy.call(this)},i.prototype._invalidateSelf=function(){this.glyphs.length=0,this._textWidth=0;var t=this.textAlign;if(this._realTextAlign="string"==typeof t?t:r.Util.enumToSnakeCase(e.TextAlign,t),this.fontSize){for(var n=this.text.length-1,i=this.text.length-1;i>=0;--i)if((a=r.Util.charCodeAt(this.text,i))&&(u=this.font.glyphForCharacter(a))&&0!==u.width&&0!==u.advanceWidth){n=i;break}var o=0,s=this.font.size>0?this.fontSize/this.font.size:0;for(i=0;i<=n;++i){var a,u;if(a=r.Util.charCodeAt(this.text,i))if(u=this.font.glyphForCharacter(a)){if(!(u.width<0||u.height<0||u.x<0||u.y<0)){this.glyphs.push(u);var c=0;0===i&&(this._overhangLeft=Math.min(u.offsetX,0),c=-this._overhangLeft),i===n&&(this._overhangRight=Math.max(u.width+u.offsetX-u.advanceWidth,0),c+=this._overhangRight),this._textWidth+=(u.advanceWidth+c)*s;var h=u.offsetY+u.height;o<h&&(o=h)}}else this._outputOfWarnLogWithNoGlyph(a,"_invalidateSelf()")}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s}else this.height=0},i.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var r=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);console.warn("Label#"+e+": failed to get a glyph for '"+r+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},i}(Rr().CacheableE);return Xr.Label=n,Xr}(),t),r(function(){if(Kr)return $r;Kr=1;var t=$r&&$r.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty($r,"__esModule",{value:!0}),$r.Pane=void 0;var e=Vr(),r=function(r){function n(t){var n=r.call(this,t)||this;return n._oldWidth=t.width,n._oldHeight=t.height,n.backgroundImage=t.backgroundImage,n._beforeBackgroundImage=t.backgroundImage,n._backgroundImageSurface=e.SurfaceUtil.asSurface(t.backgroundImage),n.backgroundEffector=t.backgroundEffector,n._shouldRenderChildren=!1,n._padding=t.padding||0,n._initialize(),n._paddingChanged=!1,n}return t(n,r),Object.defineProperty(n.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!1,configurable:!0}),n.prototype.modified=function(t){t&&(this.state&=-3),r.prototype.modified.call(this)},n.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},n.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this._backgroundImageSurface&&t.drawImage(this._backgroundImageSurface,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},n.prototype.destroy=function(t){t&&this._backgroundImageSurface&&!this._backgroundImageSurface.destroyed()&&this._backgroundImageSurface.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._backgroundImageSurface=void 0,this._beforeBackgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,r.prototype.destroy.call(this)},n.prototype._renderBackground=function(){if(this.backgroundImage!==this._beforeBackgroundImage&&(this._backgroundImageSurface=e.SurfaceUtil.asSurface(this.backgroundImage),this._beforeBackgroundImage=this.backgroundImage),this._backgroundImageSurface&&this.backgroundEffector){var t=this.backgroundEffector.render(this._backgroundImageSurface,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},n.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var r=this.children,n=0;n<r.length;++n)r[n].render(this._childrenRenderer,t);this._childrenRenderer.end()},n.prototype._initialize=function(){var t,e=this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var r=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=r.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},n.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],i=e.multiplyPoint(n[0]),o={left:i.x,right:i.x,top:i.y,bottom:i.y},s=1;s<n.length;++s)i=e.multiplyPoint(n[s]),o.left>i.x&&(o.left=i.x),o.right<i.x&&(o.right=i.x),o.top>i.y&&(o.top=i.y),o.bottom<i.y&&(o.bottom=i.y);return o}},n}(Rr().CacheableE);return $r.Pane=r,$r}(),t),r(Wr(),t),r((Jr||(Jr=1,Object.defineProperty(Zr,"__esModule",{value:!0})),Zr),t),r(en(),t),r((rn||(rn=1,Object.defineProperty(nn,"__esModule",{value:!0})),nn),t),r(an(),t),r((un||(un=1,Object.defineProperty(cn,"__esModule",{value:!0})),cn),t),r(Pn(),t),r((En||(En=1,Object.defineProperty(On,"__esModule",{value:!0})),On),t),r(Ye(),t),r(rr(),t),r(Cn(),t),r(function(){if(Ln)return Rn;Ln=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.AudioUtil=void 0;var t,e=Cr(),r=function(t,e,r,n){return r*t/n+e};return function(t){function n(t,e,n,i,s){void 0===i&&(i=1),void 0===s&&(s=r),e.changeVolume(0),e.play();var a=o(t,e,n,i,s),u=a.complete,c=a.cancel;return{complete:function(){u()},cancel:function(t){void 0===t&&(t=!1),c(t),t&&e.stop()}}}function i(t,e,n,i){void 0===i&&(i=r);var s=o(t,e,n,0,i),a=s.complete,u=s.cancel;return{complete:function(){a(),e.stop()},cancel:function(t){void 0===t&&(t=!1),u(t)}}}function o(t,n,i,o,s){void 0===s&&(s=r);var a=1e3/t.fps,u=n.volume,c=0;n.changeVolume(e.Util.clamp(u,0,1));var h=function(){if((c+=a)<=i){var t=s(c,u,o-u,i);return n.changeVolume(e.Util.clamp(t,0,1)),!1}return n.changeVolume(o),!0},l=function(){t.onUpdate.contains(h)&&t.onUpdate.remove(h)};return t.onUpdate.add(h),{complete:function(){l(),n.changeVolume(o)},cancel:function(t){l(),t&&n.changeVolume(u)}}}t.fadeIn=n,t.fadeOut=i,t.crossFade=function(t,e,o,s,a,u){void 0===a&&(a=1),void 0===u&&(u=r);var c=n(t,e,s,a,u),h=i(t,o,s,u);return{complete:function(){c.complete(),h.complete()},cancel:function(t){void 0===t&&(t=!1),c.cancel(t),h.cancel(t)}}},t.transitionVolume=o}(t||(Rn.AudioUtil=t={})),Rn}(),t),r(Un(),t),r((Gn||(Gn=1,Object.defineProperty(Bn,"__esModule",{value:!0})),Bn),t),r(Wn(),t),r(function(){if(Nn)return zn;Nn=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.Collision=void 0;var t,e=Cr();function r(t,e){return t.x*e.y-t.y*e.x}function n(t,e){return{x:t.x-e.x,y:t.y-e.y}}return function(t){t.intersectEntities=function(e,i,o,s){var a=e._findLowestCommonAncestorWith(i);if(!a)return!1;var u=o?{left:o.x,top:o.y,right:o.x+o.width,bottom:o.y+o.height}:{left:0,top:0,right:e.width,bottom:e.height},c=s?{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height}:{left:0,top:0,right:i.width,bottom:i.height},h=e._calculateMatrixTo(a),l=i._calculateMatrixTo(a),d=h.multiplyPoint({x:u.left,y:u.top}),p=h.multiplyPoint({x:u.right,y:u.top}),f=h.multiplyPoint({x:u.left,y:u.bottom}),_=h.multiplyPoint({x:u.right,y:u.bottom}),y=l.multiplyPoint({x:c.left,y:c.top}),v=l.multiplyPoint({x:c.right,y:c.top}),g=l.multiplyPoint({x:c.left,y:c.bottom}),m=l.multiplyPoint({x:c.right,y:c.bottom}),w=Math.min(d.x,p.x,f.x,_.x),b=Math.max(d.x,p.x,f.x,_.x),A=Math.min(y.x,v.x,g.x,m.x),x=Math.max(y.x,v.x,g.x,m.x);if(b<A||x<w)return!1;var S=Math.min(d.y,p.y,f.y,_.y),P=Math.max(d.y,p.y,f.y,_.y),E=Math.min(y.y,v.y,g.y,m.y),O=Math.max(y.y,v.y,g.y,m.y);if(P<E||O<S)return!1;if(t.intersectLineSegments(d,p,y,v)||t.intersectLineSegments(d,p,v,m)||t.intersectLineSegments(d,p,m,g)||t.intersectLineSegments(d,p,g,y)||t.intersectLineSegments(p,_,y,v)||t.intersectLineSegments(p,_,v,m)||t.intersectLineSegments(p,_,m,g)||t.intersectLineSegments(p,_,g,y)||t.intersectLineSegments(_,f,y,v)||t.intersectLineSegments(_,f,v,m)||t.intersectLineSegments(_,f,m,g)||t.intersectLineSegments(_,f,g,y)||t.intersectLineSegments(f,d,y,v)||t.intersectLineSegments(f,d,v,m)||t.intersectLineSegments(f,d,m,g)||t.intersectLineSegments(f,d,g,y))return!0;var T=r(n(d,p),n(y,p));if(T*r(n(f,d),n(y,d))>=0&&T*r(n(_,f),n(y,f))>=0&&T*r(n(p,_),n(y,_))>=0)return!0;var M=r(n(y,v),n(d,v));return M*r(n(g,y),n(d,y))>=0&&M*r(n(m,g),n(d,g))>=0&&M*r(n(v,m),n(d,m))>=0},t.intersectLineSegments=function(t,e,i,o){var s=n(e,t),a=n(o,i);return r(n(i,t),s)*r(n(o,t),s)<=0&&r(n(t,i),a)*r(n(e,i),a)<=0},t.intersect=function(t,e,r,n,i,o,s,a){return t<=i+s&&i<=t+r&&e<=o+a&&o<=e+n},t.intersectAreas=function(e,r){return t.intersect(e.x,e.y,e.width,e.height,r.x,r.y,r.width,r.height)},t.within=function(t,r,n,i,o){return void 0===o&&(o=1),o>=e.Util.distance(t,r,n,i)},t.withinAreas=function(t,r,n){return void 0===n&&(n=1),n>=e.Util.distanceBetweenAreas(t,r)}}(t||(zn.Collision=t={})),zn}(),t),r(ci(),t),r(di(),t),r((pi||(pi=1,Object.defineProperty(fi,"__esModule",{value:!0})),fi),t),r(function(){if(gi)return mi;gi=1;var t=mi&&mi.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(mi,"__esModule",{value:!0}),mi.DynamicFont=void 0;var e=Ne(),r=Un(),n=kn(),i=Pi(),o=Cr(),s=function(n){function s(t){var r=n.call(this)||this;r.fontFamily=t.fontFamily,r.size=t.size,r.hint=null!=t.hint?t.hint:{},r.fontColor=null!=t.fontColor?t.fontColor:"black",r.fontWeight=null!=t.fontWeight?t.fontWeight:e.FontWeight.Normal,r.strokeWidth=null!=t.strokeWidth?t.strokeWidth:0,r.strokeColor=null!=t.strokeColor?t.strokeColor:"black",r.strokeOnly=null!=t.strokeOnly&&t.strokeOnly;var s=t.game;r._resourceFactory=s.resourceFactory;var a,u=r.fontFamily;if("string"==typeof u)a=u;else if(Array.isArray(u)){for(var c=[],h=0;h<u.length;++h){var l=u[h];c.push("string"==typeof l?l:o.Util.enumToSnakeCase(e.FontFamily,l))}a=c}else(c=[]).push("string"==typeof u?u:o.Util.enumToSnakeCase(e.FontFamily,u)),a=c;var d=r.fontWeight,p="string"==typeof d?d:o.Util.enumToSnakeCase(e.FontWeight,d);if(r._glyphFactory=r._resourceFactory.createGlyphFactory(a,r.size,r.hint.baselineHeight,r.fontColor,r.strokeWidth,r.strokeColor,r.strokeOnly,p),r._glyphs={},r._destroyed=!1,r._isSurfaceAtlasSetOwner=!1,t.surfaceAtlasSet?r._atlasSet=t.surfaceAtlasSet:t.hint?(r._isSurfaceAtlasSetOwner=!0,r._atlasSet=new i.SurfaceAtlasSet({resourceFactory:s.resourceFactory,hint:r.hint})):r._atlasSet=s.surfaceAtlasSet,r.hint.presetChars){h=0;for(var f=r.hint.presetChars.length;h<f;h++){var _=o.Util.charCodeAt(r.hint.presetChars,h);_&&r.glyphForCharacter(_)}}return r}return t(s,n),s.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface&&!this._atlasSet.addGlyph(e))return null;this._glyphs[t]=e}return this._atlasSet.touchGlyph(e),e},s.prototype.asBitmapFont=function(t){var e=this;if(1!==this._atlasSet.getAtlasNum())return null;var n=null;t&&(n=o.Util.charCodeAt(t,0),this.glyphForCharacter(n));var i={};Object.keys(this._glyphs).forEach(function(t){var r=Number(t),n=e._glyphs[r],o={x:n.x,y:n.y,width:n.width,height:n.height,offsetX:n.offsetX,offsetY:n.offsetY,advanceWidth:n.advanceWidth};i[r]=o});var s=i[n],a=this._atlasSet.getAtlas(0),u=a.getAtlasUsedSize(),c=this._resourceFactory.createSurface(u.width,u.height),h=c.renderer();return h.begin(),h.drawImage(a._surface,0,0,u.width,u.height,0,0),h.end(),new r.BitmapFont({src:c,map:i,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:s})},s.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=void 0,this._glyphFactory=void 0,this._destroyed=!0},s.prototype.destroyed=function(){return this._destroyed},s}(n.Font);return mi.DynamicFont=s,mi}(),t),r((Ei||(Ei=1,Object.defineProperty(Oi,"__esModule",{value:!0})),Oi),t),r(mr(),t),r(Ci(),t),r((Li||(Li=1,Object.defineProperty(Ri,"__esModule",{value:!0})),Ri),t),r((Ii||(Ii=1,Object.defineProperty(Fi,"__esModule",{value:!0})),Fi),t),r((ji||(ji=1,Object.defineProperty(Di,"__esModule",{value:!0})),Di),t),r((ki||(ki=1,Object.defineProperty(Ui,"__esModule",{value:!0})),Ui),t),r(Je(),t),r(kn(),t),r((Gi||(Gi=1,Object.defineProperty(Bi,"__esModule",{value:!0})),Bi),t),r(Wi(),t),r((Ni||(Ni=1,Object.defineProperty(zi,"__esModule",{value:!0})),zi),t),r(ui(),t),r((Xi||(Xi=1,Object.defineProperty(qi,"__esModule",{value:!0})),qi),t),r($i(),t),r(Ar(),t),r(ur(),t),r(oo(),t),r(function(){if(so)return ao;so=1,Object.defineProperty(ao,"__esModule",{value:!0}),ao.NinePatchSurfaceEffector=void 0;var t=Vr(),e=function(){function e(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return e.prototype.render=function(e,r,n){return this._surface&&this._surface.width===r&&this._surface.height===n&&this._beforeSrcSurface===e||(this._surface=this.game.resourceFactory.createSurface(Math.ceil(r),Math.ceil(n)),this._beforeSrcSurface=e),t.SurfaceUtil.drawNinePatch(this._surface,e,this.borderWidth),this._surface},e}();return ao.NinePatchSurfaceEffector=e,ao}(),t),r(Pr(),t),r((uo||(uo=1,Object.defineProperty(co,"__esModule",{value:!0})),co),t),r(po(),t),r((fo||(fo=1,Object.defineProperty(_o,"__esModule",{value:!0})),_o),t),r((yo||(yo=1,Object.defineProperty(vo,"__esModule",{value:!0})),vo),t),r((go||(go=1,Object.defineProperty(mo,"__esModule",{value:!0})),mo),t),r(Ao(),t),r(Po(),t),r((Eo||(Eo=1,Object.defineProperty(Oo,"__esModule",{value:!0})),Oo),t),r((To||(To=1,Object.defineProperty(Mo,"__esModule",{value:!0})),Mo),t),r(to(),t),r(io(),t),r(lr(),t),r((Co||(Co=1,Object.defineProperty(Lo,"__esModule",{value:!0})),Lo),t),r(function(){if(Ro)return Io;Ro=1,Object.defineProperty(Io,"__esModule",{value:!0}),Io.SpriteFactory=void 0;var t=Wr(),e=Je(),r=function(){function r(){}return r.createSpriteFromE=function(r,n,i){var o=n.x,s=n.y,a=0,u=0,c=n.width,h=n.height,l=n.calculateBoundingRect();if(!l)throw e.ExceptionFactory.createAssertionError("SpriteFactory.createSpriteFromE: camera must look e");c=l.right-l.left,h=l.bottom-l.top,l.left<n.x&&(a=n.x-l.left),l.top<n.y&&(u=n.y-l.top),n.moveTo(a,u),n._matrix&&(n._matrix._modified=!0);var d=r.game.resourceFactory.createSurface(Math.ceil(c),Math.ceil(h)),p=d.renderer();p.begin(),n.render(p,i),p.end();var f=new t.Sprite({scene:r,src:d,width:c,height:h});return f.moveTo(l.left,l.top),n.moveTo(o,s),n._matrix&&(n._matrix._modified=!0),f},r.createSpriteFromScene=function(e,r,n){var i=e.game.resourceFactory.createSurface(Math.ceil(r.game.width),Math.ceil(r.game.height)),o=i.renderer();o.begin();for(var s=r.children,a=0;a<s.length;++a)s[a].render(o,n);return o.end(),new t.Sprite({scene:e,src:i,width:r.game.width,height:r.game.height})},r}();return Io.SpriteFactory=r,Io}(),t),r(Si(),t),r(Pi(),t),r(xi(),t),r((Fo||(Fo=1,Object.defineProperty(jo,"__esModule",{value:!0})),jo),t),r(Vr(),t),r(Yr(),t),r((Do||(Do=1,Object.defineProperty(ko,"__esModule",{value:!0})),ko),t),r((Uo||(Uo=1,Object.defineProperty(Go,"__esModule",{value:!0})),Go),t),r((Bo||(Bo=1,Object.defineProperty(Ho,"__esModule",{value:!0})),Ho),t),r(oi(),t),r(si(),t),r(Cr(),t),r(fr(),t),r(er(),t),r(No(),t),r(qo(),t),r(ai(),t),r(function(){if(Yo)return $o;Yo=1,Object.defineProperty($o,"__esModule",{value:!0}),$o.Game=void 0;var t=pt(),e=en(),r=Pn(),n=Cn(),i=ci(),o=di(),s=Ci(),a=Je(),u=Wi(),c=ui(),h=oo(),l=po(),d=Ao(),p=Pi(),f=er(),_=qo(),y=function(){function y(i){var o=this._normalizeConfiguration(i.configuration);if(this.fps=o.fps,this.width=o.width,this.height=o.height,this.renderers=[],this.scenes=[],this.age=0,this.assetBase=i.assetBase||"",this.resourceFactory=i.resourceFactory,this.handlerSet=i.handlerSet,this.selfId=i.selfId,this.db=void 0,this.loadingScene=void 0,this.operationPlugins=void 0,this.random=void 0,this.localRandom=void 0,this._defaultLoadingScene=void 0,this._defaultSkippingScene=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this._idx=void 0,this._localDb=void 0,this._localIdx=void 0,this._cameraIdx=void 0,this._isTerminated=void 0,this._modified=void 0,this._postTickTasks=void 0,this._toBeDestroyedScenes=[],this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this.audio=new n.AudioSystemManager(this.resourceFactory),this.defaultAudioSystemId="sound",this.assets={},this.surfaceAtlasSet=new p.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this.onJoin=new t.Trigger,this.onLeave=new t.Trigger,this.onPlayerInfo=new t.Trigger,this.onSeed=new t.Trigger,this.join=this.onJoin,this.leave=this.onLeave,this.playerInfo=this.onPlayerInfo,this.seed=this.onSeed,this._eventTriggerMap={unknown:void 0,timestamp:void 0,join:this.onJoin,leave:this.onLeave,"player-info":this.onPlayerInfo,seed:this.onSeed,message:void 0,"point-down":void 0,"point-move":void 0,"point-up":void 0,operation:void 0},this.onResized=new t.Trigger,this.onSkipChange=new t.Trigger,this.resized=this.onResized,this.skippingChanged=this.onSkipChange,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this._onLoad=new t.Trigger,this._onStart=new t.Trigger,this._loaded=this._onLoad,this._started=this._onStart,this.isLoaded=!1,this.onSnapshotRequest=new t.Trigger,this.snapshotRequest=this.onSnapshotRequest,this.external={},this._runtimeValueBase=Object.create(i.engineModule,{game:{value:this,enumerable:!0}}),this._main=o.main,this._mainFunc=i.mainFunc,this._mainParameter=void 0,this._configuration=o,Array.isArray(o.assets))throw new Error("Game#constructor: array type of configuration.assets is not yet supported");this._assetManager=new r.AssetManager(this,o.assets,o.audio,o.moduleMainScripts,o.moduleMainPaths),this._moduleManager=void 0,this.asset=new e.AssetAccessor(this._assetManager),this.operationPluginManager=new l.OperationPluginManager(this,i.operationPluginViewInfo||null),this._onOperationPluginOperated=new t.Trigger,this._operationPluginOperated=this._onOperationPluginOperated,this._onOperationPluginOperated.add(this._handleOperationPluginOperated,this),this.onSceneChange=new t.Trigger,this._onSceneChange=new t.Trigger,this._onSceneChange.add(this._handleSceneChanged,this),this._sceneChanged=this._onSceneChange,this.onUpdate=new t.Trigger,this._initialScene=new u.InitialScene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.onAllAssetsLoad.add(this._handleInitialSceneLoad,this),this._reset({age:0})}return Object.defineProperty(y.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this._modified&&this.render(),this._focusingCamera=t)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"skippingScene",{get:function(){return this._skippingScene},set:function(t){if(t!==this._skippingScene){if(t){if("full-local"!==t.local)throw a.ExceptionFactory.createAssertionError("Game#skippingScene: only 'full-local' scene is supported.");if(t._needsLoading())throw a.ExceptionFactory.createAssertionError("Game#skippingScene: must not depend on any assets.")}this._skippingScene=t}},enumerable:!1,configurable:!0}),y.prototype.pushScene=function(t,e){this._postTickTasks.push({type:0,scene:t,prepare:null==e?void 0:e.prepare})},y.prototype.replaceScene=function(t,e){var r,n;"object"==typeof e?(r=!!e.preserveCurrent,n=e.prepare):r=!!e,this._postTickTasks.push({type:1,scene:t,preserveCurrent:r,prepare:n})},y.prototype.popScene=function(t,e){void 0===e&&(e=1);for(var r=0;r<e;r++)this._postTickTasks.push({type:2,preserveCurrent:!!t})},y.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},y.prototype.tick=function(t,e,r){var n=null;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(n=this.scenes[this.scenes.length-1],r&&r.length)for(var i=0;i<r.length;++i){var o=this._eventConverter.toGameEvent(r[i]),s=this._eventTriggerMap[o.type];s&&s.fire(o)}n.onUpdate.fire(),t&&++this.age}return this.onUpdate.fire(),!!this._postTickTasks.length&&(this._flushPostTickTasks(),n!==this.scenes[this.scenes.length-1])},y.prototype.render=function(){var t,e,r=null!==(t=this._skippingScene)&&void 0!==t?t:this._defaultSkippingScene;if(r&&this.isSkipping?(e=r).onUpdate.fire():e=this.scene(),this._modified&&e){for(var n=this.focusingCamera,i=this.renderers,o=this.scenes.length-1;o>=0&&this.scenes[o].seethrough;)--o;for(var s=o,a=0;a<i.length;++a){var u=i[a];if(u.begin(),u.save(),u.clear(),n&&(u.save(),n._applyTransformToRenderer(u)),e===r)for(var c=0;c<e.children.length;++c)e.children[c].render(u,n);else for(var h=s;h<this.scenes.length;++h){var l=this.scenes[h].children;for(c=0;c<l.length;++c)l[c].render(u,n)}n&&u.restore(),u.restore(),u.end()}this._modified=!1}},y.prototype.resolvePointEvent=function(t){switch(t.type){case 0:return this._pointEventResolver.pointDown(t);case 1:return this._pointEventResolver.pointMove(t);case 2:return this._pointEventResolver.pointUp(t)}},y.prototype.findPointSource=function(t,e){e||(e=this.focusingCamera);var r=this.scene();if(r)return r.findPointSourceByPoint(t,!1,e)},y.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(t.id>0)throw a.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.has(t.id))throw a.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb.set(t.id,t)}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw a.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.has(t.id))throw a.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db.set(t.id,t)}},y.prototype.unregister=function(t){t.local?this._localDb.delete(t.id):this.db.delete(t.id)},y.prototype.terminateGame=function(){this._isTerminated=!0,this._terminateGame()},y.prototype.modified=function(){this._modified=!0},y.prototype.raiseEvent=function(t){this.handlerSet.raiseEvent(this._eventConverter.toPlaylogEvent(t))},y.prototype.raiseTick=function(t){if(null!=t&&t.length){for(var e=[],r=0;r<t.length;r++)e.push(this._eventConverter.toPlaylogEvent(t[r]));this.handlerSet.raiseTick(e)}else this.handlerSet.raiseTick()},y.prototype.addEventFilter=function(t,e){this.handlerSet.addEventFilter(t,e)},y.prototype.removeEventFilter=function(t){this.handlerSet.removeEventFilter(t)},y.prototype.shouldSaveSnapshot=function(){return this.handlerSet.shouldSaveSnapshot()},y.prototype.saveSnapshot=function(t,e){this.handlerSet.saveSnapshot(this.age,t,this.random.serialize(),this._idx,e)},y.prototype.requestSaveSnapshot=function(t,e){var r=this;this._postTickTasks.unshift({type:3,fun:function(){if(r.handlerSet.shouldSaveSnapshot()){var n=t.call(e);n&&r.handlerSet.saveSnapshot(r.age,n.snapshot,r.random.serialize(),r._idx,n.timestamp)}},owner:null})},y.prototype.suspendLocalTick=function(){this.handlerSet.suspendLocalTick()},y.prototype.resumeLocalTick=function(){this.handlerSet.resumeLocalTick()},y.prototype.getCurrentTime=function(){return this.handlerSet.getCurrentTime()},y.prototype.isActiveInstance=function(){return"active"===this.handlerSet.getInstanceType()},y.prototype._pushPostTickTask=function(t,e){this._postTickTasks.push({type:3,fun:t,owner:e})},y.prototype._popSceneRaw=function(t){this._postTickTasks.push({type:4,preserveCurrent:t})},y.prototype._normalizeConfiguration=function(t){if(!t)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if(null==t.assets&&(t.assets={}),null==t.fps&&(t.fps=30),"number"!=typeof t.fps)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},y.prototype._setAudioPlaybackRate=function(t){this.audio._setPlaybackRate(t)},y.prototype._startSuppressAudio=function(){this.audio._startSuppress()},y.prototype._endSuppressAudio=function(){this.audio._endSuppress()},y.prototype._setMuted=function(t){this.audio._setMuted(t)},y.prototype._decodeOperationPluginOperation=function(t,e){var r=this.operationPluginManager.plugins[t];return r&&r.decode?r.decode(e):e},y.prototype._reset=function(t){var e;if(this.operationPluginManager.reset(),this.operationPluginManager.onOperate.add(this._onOperationPluginOperated.fire,this._onOperationPluginOperated),this.scene()){for(;this.scene()!==this._initialScene;)this._popSceneRaw(!1),this._flushPostTickTasks();this.isLoaded||this.scenes.pop()}switch(this._skippingScene&&!this._skippingScene.destroyed()&&this._skippingScene.destroy(),t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.randGenSer?this.random=_.XorshiftRandomGenerator.deserialize(t.randGenSer):void 0!==t.randSeed&&(this.random=new _.XorshiftRandomGenerator(t.randSeed))),this.audio._reset(),this._onLoad.removeAll({func:this._handleLoad,owner:this}),this.onJoin.removeAll(),this.onLeave.removeAll(),this.onSeed.removeAll(),this.onResized.removeAll(),this.onSkipChange.removeAll(),this.onSceneChange.removeAll(),this.onUpdate.removeAll(),this.handlerSet.removeAllEventFilters(),this.isSkipping=!1,this.onSkipChange.add(this._handleSkipChange,this),this.joinedPlayerIds=[],this.onJoin.add(this._handleJoinEvent,this),this.onLeave.add(this._handleLeaveEvent,this),this._idx=null!==(e=null==t?void 0:t.nextEntityId)&&void 0!==e?e:0,this._localIdx=0,this._cameraIdx=0,this.db=new f.WeakRefKVS,this._localDb=new f.WeakRefKVS,this._modified=!0,this.loadingScene=void 0,this._skippingScene=void 0,this._focusingCamera=void 0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this.onSnapshotRequest.removeAll(),this._postTickTasks=[],this._toBeDestroyedScenes=[],this._eventConverter=new s.EventConverter({game:this,playerId:this.selfId}),this._pointEventResolver=new d.PointEventResolver({sourceResolver:this,playerId:this.selfId,maxPoints:this._configuration.maxPoints}),this.localRandom=new _.XorshiftRandomGenerator(Math.floor(9007199254740991*Math.random())),this._isTerminated=!1,this.vars={},this._moduleManager=new h.ModuleManager(this._runtimeValueBase,this._assetManager),this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new p.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new c.LoadingScene({game:this});break;case"compact":this._defaultLoadingScene=new i.DefaultLoadingScene({game:this,style:"compact"});break;default:this._defaultLoadingScene=new i.DefaultLoadingScene({game:this})}switch(this._configuration.defaultSkippingScene){case"none":this._defaultSkippingScene=new o.DefaultSkippingScene({game:this,style:"none"});break;case"indicator":this._defaultSkippingScene=new o.DefaultSkippingScene({game:this,style:"indicator"});break;default:this._defaultSkippingScene=void 0}},y.prototype._destroy=function(){if(this.operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this._defaultSkippingScene&&!this._defaultSkippingScene.destroyed()&&this._defaultSkippingScene.destroy(),this._skippingScene&&!this._skippingScene.destroyed()&&this._skippingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this._modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0,this.audio.music.stopAll(),this.audio.sound.stopAll(),this.audio=void 0,this.defaultAudioSystemId=void 0,this.handlerSet=void 0,this.localRandom=void 0,this.onJoin.destroy(),this.onJoin=void 0,this.onLeave.destroy(),this.onLeave=void 0,this.onSeed.destroy(),this.onSeed=void 0,this.onPlayerInfo.destroy(),this.onPlayerInfo=void 0,this.onResized.destroy(),this.onResized=void 0,this.onSkipChange.destroy(),this.onSkipChange=void 0,this.onSceneChange.destroy(),this.onSceneChange=void 0,this.onUpdate.destroy(),this.onUpdate=void 0,this.onSnapshotRequest.destroy(),this.onSnapshotRequest=void 0,this.join=void 0,this.leave=void 0,this.seed=void 0,this.playerInfo=void 0,this.snapshotRequest=void 0,this.resized=void 0,this.skippingChanged=void 0,this._sceneChanged=void 0,this._loaded=void 0,this._started=void 0,this._operationPluginOperated=void 0,this._onSceneChange.destroy(),this._onSceneChange=void 0,this._onLoad.destroy(),this._onLoad=void 0,this._onStart.destroy(),this._onStart=void 0,this.resourceFactory=void 0,this.playId=void 0,this.operationPlugins=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._main=void 0,this._mainFunc=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this.asset=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this.operationPluginManager=void 0,this._onOperationPluginOperated.destroy(),this._onOperationPluginOperated=void 0,this._idx=0,this._localDb=void 0,this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._skippingScene=void 0,this._configuration=void 0,this._postTickTasks=void 0,this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0,this._moduleManager=void 0},y.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._handleLoad():(this._onLoad.add(this._handleLoad,this),this.pushScene(this._initialScene),this._flushPostTickTasks())},y.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw a.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushPostTickTasks()},y.prototype._updateEventTriggers=function(t){if(this._modified=!0,!t)return this._eventTriggerMap.message=void 0,this._eventTriggerMap["point-down"]=void 0,this._eventTriggerMap["point-move"]=void 0,this._eventTriggerMap["point-up"]=void 0,void(this._eventTriggerMap.operation=void 0);this._eventTriggerMap.message=t.onMessage,this._eventTriggerMap["point-down"]=t.onPointDownCapture,this._eventTriggerMap["point-move"]=t.onPointMoveCapture,this._eventTriggerMap["point-up"]=t.onPointUpCapture,this._eventTriggerMap.operation=t.onOperation,t._activate()},y.prototype._handleInitialSceneLoad=function(){this._initialScene.onLoad.remove(this._handleInitialSceneLoad,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._onLoad.fire(this)},y.prototype._handleOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this.handlerSet.raiseEvent(e)},y.prototype._handleSceneChanged=function(t){this._updateEventTriggers(t);var e=t?t.local:"full-local",r=t?t.tickGenerationMode:"by-clock";this.lastLocalTickMode===e&&this.lastTickGenerationMode===r||(this.lastLocalTickMode=e,this.lastTickGenerationMode=r,this.handlerSet.changeSceneMode({local:e,tickGenerationMode:r}))},y.prototype._handleSkippingSceneReady=function(t){this._pushPostTickTask(t._fireLoaded,t)},y.prototype._terminateGame=function(){},y.prototype._flushPostTickTasks=function(){do{var t=this._postTickTasks;this._postTickTasks=[];for(var e=0;e<t.length;++e){var r=t[e];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene,!1,r.prepare?this._createPreparingLoadingScene(r.scene,r.prepare,"akashic:preparing-".concat(r.scene.name)):void 0);break;case 1:this._doPopScene(r.preserveCurrent,!1,!1),this._doPushScene(r.scene,!1,r.prepare?this._createPreparingLoadingScene(r.scene,r.prepare,"akashic:preparing-".concat(r.scene.name)):void 0);break;case 2:this._doPopScene(r.preserveCurrent,!1,!0);break;case 3:r.fun.call(r.owner);break;case 4:this._doPopScene(r.preserveCurrent,!0,!0);break;default:throw a.ExceptionFactory.createAssertionError("Game#_flushPostTickTasks: unknown post-tick task type.")}}}while(this._postTickTasks.length>0);if(this._toBeDestroyedScenes.length>0){for(var i=0,o=this._toBeDestroyedScenes;i<o.length;i++)o[i].destroy();this._toBeDestroyedScenes=[]}},y.prototype._handleSkipChange=function(t){var e;if(this.isSkipping=t,t){var r=null!==(e=this._skippingScene)&&void 0!==e?e:this._defaultSkippingScene;r&&!r._loaded&&(r._load(),r._onReady.addOnce(this._handleSkippingSceneReady,this))}this._cleanDB(),this._modified=!0},y.prototype._handleJoinEvent=function(t){t.player.id&&-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},y.prototype._handleLeaveEvent=function(t){this.joinedPlayerIds=this.joinedPlayerIds.filter(function(e){return e!==t.player.id})},y.prototype._doPopScene=function(t,e,r){var n,i=this.scenes.pop();if(!e)for(;i&&i instanceof c.LoadingScene;)i._clearTargetScene(),i=this.scenes.pop();if(!i)throw a.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; scene stack underflow");if(i===this._initialScene)throw a.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");if(t||this._toBeDestroyedScenes.includes(i)||this._toBeDestroyedScenes.push(i),!e&&(s=this.scene())&&s._needsLoading()&&"loaded-fired"!==s._loadingState){var o=s._waitingPrepare?this._createPreparingLoadingScene(s,s._waitingPrepare,"akashic:preparing-".concat(s.name)):null!==(n=this.loadingScene)&&void 0!==n?n:this._defaultLoadingScene;this._doPushScene(o,!0,this._defaultLoadingScene),o.reset(s)}if(r){var s=this.scene();this.onSceneChange.fire(s),this._onSceneChange.fire(s)}},y.prototype._handleLoad=function(){for(var t=0,e=this._configuration.operationPlugins||[];t<e.length;t++){var r=e[t];if(r.script){var n=this._moduleManager._internalRequire(r.script),i=this.operationPluginManager.register(n,r.code,r.option);!r.manualStart&&i&&i.start()}}this.operationPlugins=this.operationPluginManager.plugins;for(var o=0,s=this._assetManager.preloadScriptAssetPaths();o<s.length;o++){var u=s[o],c=this._moduleManager._internalRequire(u);if(!c||"function"!=typeof c)throw a.ExceptionFactory.createAssertionError("Game#_handleLoad: ".concat(u," has no-exported function."));c()}if(this._mainFunc)this._mainFunc(this._runtimeValueBase,this._mainParameter||{});else{if(!this._main)throw a.ExceptionFactory.createAssertionError("Game#_handleLoad: does not have an entry point");var h=this._moduleManager._internalRequire(this._main);if(!h||"function"!=typeof h)throw a.ExceptionFactory.createAssertionError("Game#_handleLoad: Entry point ".concat(this._main," not found."));h(this._mainParameter)}this._flushPostTickTasks(),this._onStart.fire()},y.prototype._doPushScene=function(t,e,r){var n=this.scenes;if(!e)for(;n.length>0&&n[n.length-1]instanceof c.LoadingScene;)n.pop()._clearTargetScene();if(r||(r=this.loadingScene||this._defaultLoadingScene),n.push(t),t._needsLoading()&&"loaded-fired"!==t._loadingState){if(this._defaultLoadingScene._needsLoading())throw a.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets.");this._doPushScene(r,!0,this._defaultLoadingScene),r.reset(t)}else this.onSceneChange.fire(t),this._onSceneChange.fire(t),t._loaded||(t._load(),this._pushPostTickTask(t._fireLoaded,t));this._modified=!0},y.prototype._createPreparingLoadingScene=function(t,e,r){var n=this;t._waitingPrepare=e;var i=new c.LoadingScene({game:this,explicitEnd:!0,name:r});return i.onTargetReady.addOnce(function(){var e=t._waitingPrepare;t._waitingPrepare=void 0,e?e(function(){n._isTerminated||i.end()}):n._pushPostTickTask(i.end,i)}),i},y.prototype._cleanDB=function(){this.db.clean(),this._localDb.clean()},y}();return $o.Game=y,$o}(),t)}(W)),W}var Zo,Qo,ts,es,rs={};function ns(){return Qo||(Qo=1,function(t){var e=V&&V.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=V&&V.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(Jo(),t),r((Zo||(Zo=1,Object.defineProperty(rs,"__esModule",{value:!0})),rs),t)}(V)),V}function is(){return es?ts:(es=1,ts=ns())}var os,ss={};var as={};var us,cs,hs=Object.freeze({__proto__:null,default:function(){return function(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);if(t[0].match(/^[^/:]+:\/*$/)&&t.length>1){var r=t.shift();t[0]=r+t[0]}t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<t.length;n++){var i=t[n];if("string"!=typeof i)throw new TypeError("Url must be a string. Received "+i);""!==i&&(n>0&&(i=i.replace(/^[\/]+/,"")),i=n<t.length-1?i.replace(/[\/]+$/,""):i.replace(/[\/]+$/,"/"),e.push(i))}var o=e.join("/"),s=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return s.shift()+(s.length>0?"?":"")+s.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}}),ls=e(hs),ds={},ps={},fs={},_s={};function ys(){return us||(us=1,Object.defineProperty(_s,"__esModule",{value:!0}),_s.ExceptionFactory=void 0,function(t){t.createAssetLoadError=function(t,e,r){return void 0===e&&(e=!0),{name:"AssetLoadError",message:t,retriable:e,cause:r}}}(t||(_s.ExceptionFactory=t={}))),_s;var t}function vs(){if(cs)return fs;cs=1,Object.defineProperty(fs,"__esModule",{value:!0}),fs.XHRLoader=void 0;var t=ys(),e=function(){function e(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return e.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},e.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},e.prototype._getRequestObject=function(e,r){var n=new XMLHttpRequest;n.open("GET",e.url,!0),n.responseType=e.responseType,n.timeout=this.timeout,n.addEventListener("timeout",function(){r(t.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),n.addEventListener("load",function(){if(n.status>=200&&n.status<300){var i="text"===e.responseType?n.responseText:n.response;r(null,i)}else r(t.ExceptionFactory.createAssetLoadError("loading error. status: "+n.status))},!1),n.addEventListener("error",function(){r(t.ExceptionFactory.createAssetLoadError("loading error. status: "+n.status))},!1),n.send()},e}();return fs.XHRLoader=e,fs}var gs,ms,ws,bs={};function As(){if(gs)return bs;gs=1,Object.defineProperty(bs,"__esModule",{value:!0}),bs.Asset=void 0;var t=pt(),e=function(){function e(e,r){this.onDestroyed=new t.Trigger,this.id=e,this.originalPath=r,this.path=this._assetPathFilter(r)}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();return bs.Asset=e,bs}function xs(){if(ms)return ps;ms=1;var t=ps&&ps.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ps,"__esModule",{value:!0}),ps.BinaryAsset=void 0;var e=vs(),r=function(r){function n(t,e){var n=r.call(this,t,e)||this;return n.type="binary",n.data=void 0,n}return t(n,r),n.prototype.destroy=function(){this.data=void 0,r.prototype.destroy.call(this)},n.prototype._load=function(t){var r=this;(new e.XHRLoader).getArrayBuffer(this.path,function(e,n){e?t._onAssetError(r,e):null!=n?(r.data=n,t._onAssetLoad(r)):t._onAssetError(r,{name:"AssetLoadError",retriable:!1,message:"BinaryAsset#_load(): no data received"})})},n}(As().Asset);return ps.BinaryAsset=r,ps}var Ss,Ps,Es={},Os={},Ts={},Ms={},Cs={},Ls={};function Rs(){if(Ss)return Ls;Ss=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.Surface=void 0;var t=function(){function t(t,e,r){this.width=Math.ceil(t),this.height=Math.ceil(e),this._drawable=r}return t.prototype.destroy=function(){this._destroyed=!0},t.prototype.destroyed=function(){return!!this._destroyed},t}();return Ls.Surface=t,Ls}function Is(){if(Ps)return Cs;Ps=1;var t=Cs&&Cs.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Cs,"__esModule",{value:!0}),Cs.CanvasSurface=void 0;var e=function(e){function r(t,r){var n=this,i=document.createElement("canvas");return n=e.call(this,t,r,i)||this,i.width=t,i.height=r,n.canvas=i,n}return t(r,e),r.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=void 0,e.prototype.destroy.call(this)},r.prototype.getHTMLElement=function(){return this.canvas},r.prototype.changeVisualScale=function(t,e){var r=this.canvas.style;"transform"in r?(r.transformOrigin="0 0",r.transform="scale("+t+","+e+")"):"webkitTransform"in r?(r.webkitTransformOrigin="0 0",r.webkitTransform="scale("+t+","+e+")"):(r.width=Math.floor(t*this.width)+"px",r.height=Math.floor(e*this.width)+"px")},r}(Rs().Surface);return Cs.CanvasSurface=e,Cs}var Fs,js,Ds,ks={},Us={},Gs={};function Bs(){if(Fs)return Gs;Fs=1,Object.defineProperty(Gs,"__esModule",{value:!0}),Gs.AffineTransformer=void 0;var t=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var r=this.matrix;return r[0]*=t,r[1]*=t,r[2]*=e,r[3]*=e,this},t.prototype.translate=function(t,e){var r=this.matrix;return r[4]+=r[0]*t+r[2]*e,r[5]+=r[1]*t+r[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,r=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],i=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=r,e[1]=n,e[2]=i,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();return Gs.AffineTransformer=t,Gs}function Hs(){if(Ds)return ks;Ds=1,Object.defineProperty(ks,"__esModule",{value:!0}),ks.CanvasSurfaceContext=void 0;var t=function(){if(js)return Us;js=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.CanvasRenderingState=void 0;var t=Bs(),e=function(e){e?(this.fillStyle=e.fillStyle,this.globalAlpha=e.globalAlpha,this.globalCompositeOperation=e.globalCompositeOperation,this.transformer=new t.AffineTransformer(e.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new t.AffineTransformer)};return Us.CanvasRenderingState=e,Us}(),e=function(){function e(e){this._stateStack=[],this._modifiedTransform=!1,this._context=e;var r=new t.CanvasRenderingState;this._contextFillStyle=r.fillStyle,this._contextGlobalAlpha=r.globalAlpha,this._contextGlobalCompositeOperation=r.globalCompositeOperation,this.pushState(r)}return Object.defineProperty(e.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!1,configurable:!0}),e.prototype.getCanvasRenderingContext2D=function(){return this._context},e.prototype.clearRect=function(t,e,r,n){this.prerender(),this._context.clearRect(t,e,r,n)},e.prototype.save=function(){var e=new t.CanvasRenderingState(this.currentState());this.pushState(e)},e.prototype.restore=function(){this.popState()},e.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},e.prototype.drawImage=function(t,e,r,n,i,o,s,a,u){this.prerender(),this._context.drawImage(t,e,r,n,i,o,s,a,u)},e.prototype.fillRect=function(t,e,r,n){this.prerender(),this._context.fillRect(t,e,r,n)},e.prototype.fillText=function(t,e,r,n){this.prerender(),this._context.fillText(t,e,r,n)},e.prototype.strokeText=function(t,e,r,n){this.prerender(),this._context.strokeText(t,e,r,n)},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},e.prototype.transform=function(t,e,r,n,i,o){this.currentState().transformer.transform([t,e,r,n,i,o]),this._modifiedTransform=!0},e.prototype.setTransform=function(t,e,r,n,i,o){this.currentState().transformer.setTransform([t,e,r,n,i,o]),this._modifiedTransform=!0},e.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},e.prototype.getImageData=function(t,e,r,n){return this._context.getImageData(t,e,r,n)},e.prototype.putImageData=function(t,e,r,n,i,o,s){this._context.putImageData(t,e,r,n,i,o,s)},e.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._contextFillStyle&&(this._context.fillStyle=t.fillStyle,this._contextFillStyle=t.fillStyle),t.globalAlpha!==this._contextGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._contextGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._contextGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._contextGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},e.prototype.pushState=function(t){this._stateStack.push(t)},e.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0,this._contextFillStyle=this._context.fillStyle,this._contextGlobalAlpha=this._context.globalAlpha,this._contextGlobalCompositeOperation=this._context.globalCompositeOperation)},e.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},e}();return ks.CanvasSurfaceContext=e,ks}var Vs,Ws,Ns,zs,Xs,qs={};function Ys(){if(Vs)return qs;Vs=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.Context2DRenderer=void 0;var t={"source-over":"source-over","source-atop":"source-atop",lighter:"lighter",copy:"copy","experimental-source-in":"source-in","experimental-source-out":"source-out","experimental-destination-atop":"destination-atop","experimental-destination-in":"destination-in","destination-out":"destination-out","destination-over":"destination-over",xor:"xor",difference:"difference",saturation:"saturation"},e=function(){function e(t){this.surface=t,this.context=t.context(),this.canvasRenderingContext2D=this.context.getCanvasRenderingContext2D()}return e.prototype.begin=function(){this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore()},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,r,n,i,o,s){this.context.drawImage(t._drawable,e,r,n,i,o,s,n,i)},e.prototype.drawSprites=function(t,e,r,n,i,o,s,a){for(var u=0;u<a;++u)this.drawImage(t,e[u],r[u],n[u],i[u],o[u],s[u])},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,r,n,i){this.context.fillStyle=i,this.context.fillRect(t,e,r,n)},e.prototype.setCompositeOperation=function(e){this.context.globalCompositeOperation=t[e]||"source-over"},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw new Error("Context2DRenderer#setShaderProgram() is not implemented")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype.getContext=function(){return this.context.getCanvasRenderingContext2D()},e.prototype.flush=function(){},e.prototype._getImageData=function(t,e,r,n){return this.context.getImageData(t,e,r,n)},e.prototype._putImageData=function(t,e,r,n,i,o,s){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,r,n,i,o,s)},e}();return qs.Context2DRenderer=e,qs}function Ks(){if(Ws)return Ms;Ws=1;var t=Ms&&Ms.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.Context2DSurface=void 0;var e=Is(),r=Hs(),n=Ys(),i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return t(i,e),i.prototype.context=function(){if(!this._context){var t=this.canvas.getContext("2d");if(!t)throw new Error("Context2DSurface#context(): could not initialize CanvasRenderingContext2D");this._context=new r.CanvasSurfaceContext(t)}return this._context},i.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},i.prototype.changePhysicalScale=function(t,e){if(!this._context)throw new Error("Context2DSurface#changePhysicalScale(): context has not been initialized");this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},i.prototype.isPlaying=function(){return!1},i}(e.CanvasSurface);return Ms.Context2DSurface=i,Ms}function $s(){if(Ns)return Ts;Ns=1;var t=Ts&&Ts.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.SVGImageAsset=Ts.SVGImageAssetSurface=void 0;var e=Ks(),r=Rs(),n=ys(),i=As(),o=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.renderer=function(){throw new Error("SVGImageAssetSurface cannot be rendered.")},r.prototype.isPlaying=function(){return!1},r}(r.Surface);Ts.SVGImageAssetSurface=o;var s=function(r){function i(t,e,n,i,o){var s=r.call(this,t,e)||this;return s.type="vector-image",s.width=n,s.height=i,s.hint=o,s.data=null,s._surface=null,s}return t(i,r),i.prototype.destroy=function(){this.data=null,this.hint=void 0,this._surface=null,r.prototype.destroy.call(this)},i.prototype._load=function(t){var e=this,r=new Image;this.hint&&this.hint.untainted&&(r.crossOrigin="anonymous"),r.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError("SVGImageAsset unknown loading error"))},r.onload=function(){e.data=r,t._onAssetLoad(e)},r.src=this.path},i.prototype.createSurface=function(t,r,n,i,s,a){void 0===n&&(n=0),void 0===i&&(i=0);var u=this,c=u.width,h=u.height,l=u.data;if(!l)throw new Error("SVGImageAsset#asSurface: not yet loaded.");this._surface||(this._surface=new o(c,h,l)),s||(s=c),a||(a=h);var d=new e.Context2DSurface(t,r),p=d.renderer();return p.save(),p.transform([t/s,0,0,r/a,0,0]),p.drawImage(this._surface,n,i,s,a,0,0),p.restore(),d},i}(i.Asset);return Ts.SVGImageAsset=s,Ts}function Js(){if(zs)return Os;zs=1;var t=Os&&Os.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Os,"__esModule",{value:!0}),Os.GeneratedSVGImageAsset=void 0;var e=ys(),r=function(r){function i(t,e,n){var i=r.call(this,t,e,0,0)||this;return i._svgString=n,i}return t(i,r),i.prototype.destroy=function(){this._svgString=null,r.prototype.destroy.call(this)},i.prototype._load=function(t){var r,i=this,o=this._svgString,s=new DOMParser;try{var a=s.parseFromString(o,"text/xml").getElementsByTagName("svg")[0],u=a.getAttribute("width"),c=a.getAttribute("height");if(null==u)throw new Error("must give width in the root element.");if(null==c)throw new Error("must give height in the root element.");if(!n(u))throw new Error('the width in the root element must be given in "px" units');if(!n(c))throw new Error('the height in the root element must be given in "px" units');r=window.btoa(o),this.width=parseFloat(u),this.height=parseFloat(c)}catch(r){return void t._onAssetError(this,e.ExceptionFactory.createAssetLoadError(r.message,!1,r))}var h=new Image;h.onerror=function(r){t._onAssetError(i,e.ExceptionFactory.createAssetLoadError("GeneratedSVGImageAsset: unknown loading error",void 0,r))},h.onload=function(){i.data=h,t._onAssetLoad(i)},h.src="data:image/svg+xml;base64,"+r},i}($s().SVGImageAsset);function n(t){return/^[+-]?(?:(?:[0-9]+(?:\.[0-9]*)?)|(?:\.[0-9]+))(?:[eE][+-]?[0-9]+)?(?:px)?$/.test(t)}return Os.GeneratedSVGImageAsset=r,Os}var Zs,Qs,ta={},ea={};function ra(){if(Zs)return ea;Zs=1;var t=ea&&ea.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ea,"__esModule",{value:!0}),ea.HTMLImageAsset=ea.ImageAssetSurface=void 0;var e=Rs(),r=ys(),n=As(),i=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.renderer=function(){throw new Error("ImageAssetSurface cannot be rendered.")},r.prototype.isPlaying=function(){return!1},r}(e.Surface);ea.ImageAssetSurface=i;var o=function(e){function n(t,r,n,i){var o=e.call(this,t,r)||this;return o.type="image",o.width=n,o.height=i,o.data=void 0,o._surface=void 0,o}return t(n,e),n.prototype.initialize=function(t){this.hint=t},n.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,e.prototype.destroy.call(this)},n.prototype._load=function(t){var e=this,n=new Image;this.hint&&this.hint.untainted&&(n.crossOrigin="anonymous"),n.onerror=function(){t._onAssetError(e,r.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},n.onload=function(){e.data=n,t._onAssetLoad(e)},n.src=this.path},n.prototype.asSurface=function(){if(!this.data)throw new Error("ImageAssetImpl#asSurface: not yet loaded.");return this._surface||(this._surface=new i(this.width,this.height,this.data)),this._surface},n}(n.Asset);return ea.HTMLImageAsset=o,ea}var na,ia={},oa={};function sa(){if(na)return oa;na=1;var t=oa&&oa.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(oa,"__esModule",{value:!0}),oa.XHRScriptAsset=void 0;var e=vs(),r=function(r){function n(t,e,n){void 0===n&&(n=[]);var i=r.call(this,t,e)||this;return i.type="script",i.script="",i.exports=n,i}return t(n,r),n.prototype._load=function(t){var r=this;(new e.XHRLoader).get(this.path,function(e,n){e?t._onAssetError(r,e):(r.script=n+"\n",t._onAssetLoad(r))})},n.prototype.execute=function(t){return this._wrap()(t),t.module.exports},n.prototype.destroy=function(){this.script=void 0,r.prototype.destroy.call(this)},n.prototype._wrap=function(){for(var t="",e=0,r=this.exports;e<r.length;e++){var n=r[e];t+='exports["'.concat(n,'"] = typeof ').concat(n,' !== "undefined" ? ').concat(n," : undefined;\n")}return new Function("g","(function(exports, require, module, __filename, __dirname) {\n"+this.script+"\n"+t+"\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);")},n}(As().Asset);return oa.XHRScriptAsset=r,oa}var aa,ua={},ca={};function ha(){if(aa)return ca;aa=1,Object.defineProperty(ca,"__esModule",{value:!0}),ca.Asset=void 0;var t=pt(),e=function(){function e(e,r){this.id=e,this.originalPath=r,this.path=this._assetPathFilter(r),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();return ca.Asset=e,ca}var la,da={};var pa,fa={};var _a,ya={};var va,ga={};var ma,wa={};var ba,Aa={};var xa,Sa={};var Pa,Ea={};var Oa,Ta={};var Ma,Ca={};var La,Ra={};var Ia,Fa={};var ja,Da={};var ka,Ua={};var Ga,Ba={};var Ha,Va,Wa,Na={};function za(){return Va||(Va=1,function(t){var e,r=ua&&ua.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),n=ua&&ua.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(ha(),t),n(function(){if(la)return da;la=1;var t=da&&da.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(da,"__esModule",{value:!0}),da.AudioAsset=void 0;var e=function(e){function r(t,r,n,i,o,s,a){var u=e.call(this,t,r)||this;return u.type="audio",u.duration=n,u.loop=o,u.hint=s,u._system=i,u.data=void 0,u.offset=a,u}return t(r,e),r.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},r.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},r.prototype.inUse=function(){return this._system.findPlayers(this).length>0},r.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,e.prototype.destroy.call(this)},r}(ha().Asset);return da.AudioAsset=e,da}(),t),n(function(){if(pa)return fa;pa=1,Object.defineProperty(fa,"__esModule",{value:!0}),fa.AudioPlayer=void 0;var t=pt(),e=function(){function e(e){this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},e}();return fa.AudioPlayer=e,fa}(),t),n(function(){if(_a)return ya;_a=1;var t=ya&&ya.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ya,"__esModule",{value:!0}),ya.BinaryAsset=void 0;var e=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.type="binary",n.data=void 0,n}return t(r,e),r.prototype.destroy=function(){this.data=void 0,e.prototype.destroy.call(this)},r}(ha().Asset);return ya.BinaryAsset=e,ya}(),t),n(function(){return va||(va=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.ExceptionFactory=void 0,function(t){t.createAssertionError=function(t,e){var r=new Error(t);return r.name="AssertionError",r.cause=e,r},t.createTypeMismatchError=function(t,e,r,n){var i="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var o=void 0;i+=", actual type is "+((o=r&&r.constructor&&r.constructor.name?r.constructor.name:typeof r).length>40?o.substr(0,40):o)}catch(t){}i+=".";var s=new Error(i);return s.name="TypeMismatchError",s.cause=n,s.expected=e,s.actual=r,s},t.createAssetLoadError=function(t,e,r,n){void 0===e&&(e=!0);var i=new Error(t);return i.name="AssetLoadError",i.cause=n,i.retriable=e,i}}(t||(ga.ExceptionFactory=t={}))),ga;var t}(),t),n(function(){if(ma)return wa;ma=1,Object.defineProperty(wa,"__esModule",{value:!0}),wa.Glyph=void 0;var t=function(){function t(t,e,r,n,i,o,s,a,u,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=n),void 0===c&&(c=!!u),this.code=t,this.x=e,this.y=r,this.width=n,this.height=i,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=u,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();return wa.Glyph=t,wa}(),t),n(function(){if(ba)return Aa;ba=1,Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.GlyphFactory=void 0;var t=function(t,e,r,n,i,o,s,a){void 0===r&&(r=e),void 0===n&&(n="black"),void 0===i&&(i=0),void 0===o&&(o="black"),void 0===s&&(s=!1),void 0===a&&(a="normal"),this.fontFamily=t,this.fontSize=e,this.fontWeight=a,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=i,this.strokeColor=o,this.strokeOnly=s};return Aa.GlyphFactory=t,Aa}(),t),n(function(){if(xa)return Sa;xa=1;var t=Sa&&Sa.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.ImageAsset=void 0;var e=function(e){function r(t,r,n,i){var o=e.call(this,t,r)||this;return o.type="image",o.width=n,o.height=i,o}return t(r,e),r.prototype.initialize=function(t){this.hint=t},r}(ha().Asset);return Sa.ImageAsset=e,Sa}(),t),n((Pa||(Pa=1,Object.defineProperty(Ea,"__esModule",{value:!0}),Ea.PdiCommonUtil=void 0,function(t){t.addExtname=function(t,e){var r=t.indexOf("?");return-1===r?t+"."+e:t.substring(0,r)+"."+e+t.substring(r,t.length)}}(e||(Ea.PdiCommonUtil=e={}))),Ea),t),n(function(){if(Oa)return Ta;Oa=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.Renderer=void 0;var t=function(){function t(){}return t.prototype.begin=function(){},t.prototype.end=function(){},t}();return Ta.Renderer=t,Ta}(),t),n(function(){if(Ma)return Ca;Ma=1,Object.defineProperty(Ca,"__esModule",{value:!0}),Ca.ResourceFactory=void 0;var t=function(){};return Ca.ResourceFactory=t,Ca}(),t),n(function(){if(La)return Ra;La=1;var t=Ra&&Ra.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.ScriptAsset=void 0;var e=function(e){function r(t,r,n){void 0===n&&(n=[]);var i=e.call(this,t,r)||this;return i.type="script",i.exports=n,i.script=void 0,i}return t(r,e),r.prototype.destroy=function(){this.script=void 0,e.prototype.destroy.call(this)},r}(ha().Asset);return Ra.ScriptAsset=e,Ra}(),t),n(function(){if(Ia)return Fa;Ia=1,Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.Surface=void 0;var t=function(){function t(t,e,r){this.width=Math.floor(t),this.height=Math.floor(e),this._drawable=r}return t.prototype.destroy=function(){this._destroyed=!0},t.prototype.destroyed=function(){return!!this._destroyed},t}();return Fa.Surface=t,Fa}(),t),n(function(){if(ja)return Da;ja=1;var t=Da&&Da.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Da,"__esModule",{value:!0}),Da.TextAsset=void 0;var e=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.type="text",n.data=void 0,n}return t(r,e),r.prototype.destroy=function(){this.data=void 0,e.prototype.destroy.call(this)},r}(ha().Asset);return Da.TextAsset=e,Da}(),t),n(function(){if(ka)return Ua;ka=1;var t=Ua&&Ua.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.VectorImageAsset=void 0;var e=function(e){function r(t,r,n,i,o){var s=e.call(this,t,r)||this;return s.type="vector-image",s.width=n,s.height=i,s.hint=o,s}return t(r,e),r}(ha().Asset);return Ua.VectorImageAsset=e,Ua}(),t),n(function(){if(Ga)return Ba;Ga=1;var t=Ba&&Ba.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ba,"__esModule",{value:!0}),Ba.VideoAsset=void 0;var e=function(e){function r(t,r,n,i,o,s,a){var u=e.call(this,t,r)||this;return u.type="video",u.width=n,u.height=i,u.realWidth=0,u.realHeight=0,u._system=o,u._loop=s,u._useRealSize=a,u}return t(r,e),r.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},r.prototype.stop=function(){this.getPlayer().stop()},r.prototype.destroy=function(){this._system=void 0,e.prototype.destroy.call(this)},r}(ha().Asset);return Ba.VideoAsset=e,Ba}(),t),n(function(){if(Ha)return Na;Ha=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.VideoPlayer=void 0;var t=pt(),e=function(){function e(e){this._loop=!!e,this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.onPlay.fire({player:this,video:t})},e.prototype.stop=function(){var t=this.currentVideo;this.onStop.fire({player:this,video:t})},e.prototype.changeVolume=function(t){this.volume=t},e}();return Na.VideoPlayer=e,Na}(),t)}(ua)),ua}var Xa,qa={};var Ya,Ka,$a={},Ja={};function Za(){if(Ka)return $a;Ka=1,Object.defineProperty($a,"__esModule",{value:!0}),$a.TextAsset=void 0;var t=H,e=t.__importStar(is()),r=vs(),n=za(),i=function(){if(Ya)return Ja;Ya=1,Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.Asset=void 0;var t=H.__importStar(is()),e=function(){function e(e,r){this.type="",this.onDestroyed=new t.Trigger,this.id=e,this.path=r,this.originalPath=r}return e.prototype.inUse=function(){return!1},e.prototype.destroy=function(){this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.onDestroyed},e.prototype._assetPathFilter=function(t){return t},e}();return Ja.Asset=e,Ja}(),o=function(i){function o(t,r){var n=i.call(this,t,r)||this;return n.type="text",n.data="",n.onDestroyed=new e.Trigger,n}return t.__extends(o,i),o.prototype._load=function(t){var e=this;(new r.XHRLoader).get(this.path,function(r,n){r?t._onAssetError(e,r):(e.data=n+"\n",t._onAssetLoad(e))})},o.prototype._overrideLoadFunc=function(t){var e=this;this._load=function(r){t(e.id,e.path,function(t,i){t?r._onAssetError(e,n.ExceptionFactory.createAssetLoadError(t.message,!1)):i?(e.data=i,r._onAssetLoad(e)):r._onAssetError(e,n.ExceptionFactory.createAssetLoadError("no data received",!1))})}},o}(i.Asset);return $a.TextAsset=o,$a}var Qa,tu,eu,ru={},nu={},iu={};function ou(){if(tu)return nu;tu=1;var t=nu&&nu.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(nu,"__esModule",{value:!0}),nu.HTMLVideoAsset=void 0;var e=Rs(),r=As(),n=function(){if(Qa)return iu;Qa=1,Object.defineProperty(iu,"__esModule",{value:!0}),iu.HTMLVideoPlayer=void 0;var t=pt(),e=function(){function e(e){this._loop=!!e,this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentVideo=void 0,this.volume=1,this.isDummy=!0}return e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}();return iu.HTMLVideoPlayer=e,iu}(),i=function(e){function r(t,r,n){return e.call(this,t,r,n)||this}return t(r,e),r.prototype.renderer=function(){throw new Error("VideoAssetSurface cannot be rendered.")},r.prototype.isPlaying=function(){return!1},r}(e.Surface),o=function(e){function r(t,r,o,s,a,u,c){var h=e.call(this,t,r)||this;return h.type="video",h.width=o,h.height=s,h.realWidth=0,h.realHeight=0,h._system=a,h._loop=u,h._useRealSize=c,h._player=new n.HTMLVideoPlayer,h._surface=new i(o,s),h}return t(r,e),r.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},r.prototype.stop=function(){this.getPlayer().stop()},r.prototype.inUse=function(){return!1},r.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},r.prototype.getPlayer=function(){return this._player},r.prototype.asSurface=function(){return this._surface},r}(r.Asset);return nu.HTMLVideoAsset=o,nu}var su,au={},uu={},cu={},hu={};function lu(){if(su)return hu;su=1;var t=hu&&hu.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(hu,"__esModule",{value:!0}),hu.XHRTextAsset=void 0;var e=vs(),r=function(r){function n(t,e){var n=r.call(this,t,e)||this;return n.type="text",n.data="",n}return t(n,r),n.prototype._load=function(t){var r=this;(new e.XHRLoader).get(this.path,function(e,n){e?t._onAssetError(r,e):n?(r.data=n,t._onAssetLoad(r)):t._onAssetError(r,{name:"AssetLoadError",message:"XHRTextAsset#_load(): no data received",retriable:!1})})},n.prototype.destroy=function(){this.data=void 0,r.prototype.destroy.call(this)},n}(As().Asset);return hu.XHRTextAsset=r,hu}var du,pu={};function fu(){if(du)return pu;du=1,Object.defineProperty(pu,"__esModule",{value:!0}),pu.AudioManager=void 0;var t=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();return pu.AudioManager=t,pu}var _u,yu,vu={},gu={},mu={},wu={};function bu(){if(_u)return wu;_u=1,Object.defineProperty(wu,"__esModule",{value:!0}),wu.InputEventHandler=void 0,wu.preventEventDefault=function(t){t.preventDefault()};var t=pt(),e=function(){function e(e){this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this.pointTrigger=new t.Trigger,e.style.touchAction="none",e.style.userSelect="none"}return e.isSupported=function(){return!1},e.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},e.prototype.pointDown=function(t,e,r){e.offsetX<0||e.offsetY<0||e.offsetX>this.inputView.offsetWidth||e.offsetY>this.inputView.offsetHeight||(this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e),button:r}),this.pointerEventLock[t]=!0)},e.prototype.pointMove=function(t,e,r){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e),button:r})},e.prototype.pointUp=function(t,e,r){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e),button:r}),delete this.pointerEventLock[t])},e.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},e.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},e.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),r=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/r.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/r.y}},e}();return wu.InputEventHandler=e,wu}var Au,xu,Su,Pu={};function Eu(){if(xu)return gu;xu=1,Object.defineProperty(gu,"__esModule",{value:!0}),gu.InputHandlerLayer=void 0;var t=pt(),e=function(){if(yu)return mu;yu=1;var t=mu&&mu.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(mu,"__esModule",{value:!0}),mu.MouseTouchEventHandler=void 0;var e=bu(),r=function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.pressingMouseButton=null,t.onMouseDown=function(e){null==t.pressingMouseButton&&(t.pressingMouseButton=e.button,t.pointDown(n.MOUSE_IDENTIFIER,t.getOffsetPositionFromInputView(e),t.getPlatformButtonType(e,0)),window.addEventListener("mousemove",t.onWindowMouseMove,!1),window.addEventListener("mouseup",t.onWindowMouseUp,!1))},t.onWindowMouseMove=function(e){t.pointMove(n.MOUSE_IDENTIFIER,t.getOffsetPositionFromInputView(e),-1)},t.onWindowMouseUp=function(e){t.pressingMouseButton===e.button&&(t.pressingMouseButton=null,t.pointUp(n.MOUSE_IDENTIFIER,t.getOffsetPositionFromInputView(e),t.getPlatformButtonType(e,0)),window.removeEventListener("mousemove",t.onWindowMouseMove,!1),window.removeEventListener("mouseup",t.onWindowMouseUp,!1))},t.onTouchStart=function(e){for(var r=e.changedTouches,n=0,i=r.length;n<i;n++){var o=r[n];t.pointDown(o.identifier,t.getOffsetPositionFromInputView(o),0)}e.preventDefault()},t.onTouchMove=function(e){for(var r=e.changedTouches,n=0,i=r.length;n<i;n++){var o=r[n];t.pointMove(o.identifier,t.getOffsetPositionFromInputView(o),0)}},t.onTouchEnd=function(e){for(var r=e.changedTouches,n=0,i=r.length;n<i;n++){var o=r[n];t.pointUp(o.identifier,t.getOffsetPositionFromInputView(o),0)}window.removeEventListener("touchmove",t.onTouchMove,!1),window.removeEventListener("touchend",t.onTouchEnd,!1)},t}return t(n,r),n.isSupported=function(){return!1},n.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1),this.inputView.addEventListener("touchstart",this.onTouchStart),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchEnd),this.inputView.addEventListener("contextmenu",e.preventEventDefault)},n.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1),this.inputView.removeEventListener("touchstart",this.onTouchStart),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchEnd),this.inputView.removeEventListener("contextmenu",e.preventEventDefault)},n.prototype.getPlatformButtonType=function(t,e){switch(t.button){case-1:return-1;case 0:return 0;case 1:return 1;case 2:return 2;default:return e}},n.MOUSE_IDENTIFIER=1,n}(e.InputEventHandler);return mu.MouseTouchEventHandler=r,mu}(),r=function(){if(Au)return Pu;Au=1;var t=Pu&&Pu.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.PointerEventHandler=void 0;var e=bu(),r=function(r){function n(t){var e=r.call(this,t)||this;return e.onPointerDown=function(t){e.pointDown(t.pointerId,e.getOffsetPositionFromInputView(t),e.getPlatformButtonType(t,0));var r=function(r){t.pointerId===r.pointerId&&e.pointMove(r.pointerId,e.getOffsetPositionFromInputView(r),e.getPlatformButtonType(r,-1))},n=function(r){if(t.pointerId===r.pointerId){e.pointUp(r.pointerId,e.getOffsetPositionFromInputView(r),e.getPlatformButtonType(r,0));var n=e._eventHandlersMap[r.pointerId];if(n){var i=n.onPointerMove,o=n.onPointerUp;window.removeEventListener("pointermove",i,!1),window.removeEventListener("pointerup",o,!1),window.removeEventListener("pointercancel",o,!1),delete e._eventHandlersMap[r.pointerId]}}};window.addEventListener("pointermove",r,!1),window.addEventListener("pointerup",n,!1),window.addEventListener("pointercancel",n,!1),e._eventHandlersMap[t.pointerId]={onPointerMove:r,onPointerUp:n}},e._eventHandlersMap=Object.create(null),e}return t(n,r),n.isSupported=function(){return!1},n.prototype.start=function(){this.inputView.addEventListener("pointerdown",this.onPointerDown,!1),this.inputView.addEventListener("contextmenu",e.preventEventDefault,!1)},n.prototype.stop=function(){this.inputView.removeEventListener("pointerdown",this.onPointerDown,!1),this.inputView.removeEventListener("contextmenu",e.preventEventDefault,!1)},n.prototype.getPlatformButtonType=function(t,e){switch(t.button){case-1:return-1;case 0:return 0;case 1:return 1;case 2:return 2;default:return e}},n}(e.InputEventHandler);return Pu.PointerEventHandler=r,Pu}(),n=function(){function n(e){this.view=this._createInputView(e.width,e.height),this._inputHandler=void 0,this.pointEventTrigger=new t.Trigger}return n.prototype.enablePointerEvent=function(){var t=this,n=!!window.PointerEvent;this._inputHandler=n?new r.PointerEventHandler(this.view):new e.MouseTouchEventHandler(this.view),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},n.prototype.disablePointerEvent=function(){var t;null===(t=this._inputHandler)||void 0===t||t.stop()},n.prototype.setOffset=function(t){var e="position:relative; left:".concat(t.x,"px; top:").concat(t.y,"px");this._inputHandler.inputView.setAttribute("style",e)},n.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},n.prototype.setViewTabIndex=function(t){this.view.setAttribute("tabindex",t)},n.prototype._createInputView=function(t,e){var r=document.createElement("div");return r.setAttribute("style","display:inline-block; outline:none; touch-action:none"),r.style.width=t+"px",r.style.height=e+"px",r.setAttribute("tabindex","0"),r},n}();return gu.InputHandlerLayer=n,gu}var Ou,Tu={};function Mu(){if(Ou)return Tu;Ou=1,Object.defineProperty(Tu,"__esModule",{value:!0}),Tu.AudioPluginManager=void 0;var t=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,r=t.length;e<r;e++){var n=t[e];if(!n.isSupported)return this._activePlugin=n,!0;var i=n;if(i.isSupported())return this._activePlugin=new i,!0}return!1},t.prototype.clear=function(){var t;null===(t=this._activePlugin)||void 0===t||t.clear()},t}();return Tu.AudioPluginManager=t,Tu}var Cu,Lu={};function Ru(){if(Cu)return Lu;Cu=1,Object.defineProperty(Lu,"__esModule",{value:!0}),Lu.AudioPluginRegistry=void 0;var t=[];return Lu.AudioPluginRegistry={addPlugin:function(e){-1===t.indexOf(e)&&t.push(e)},getRegisteredAudioPlugins:function(){return t},clear:function(){t=[]}},Lu}var Iu,Fu={};var ju,Du={},ku={};function Uu(){if(ju)return ku;ju=1,Object.defineProperty(ku,"__esModule",{value:!0}),ku.GlyphFactory=void 0;var t=Ks();function e(e,r,n,i,s,a,u,c,h,l,d,p){var f=r<o._environmentMinimumFontSize?r/o._environmentMinimumFontSize:1,_=Math.ceil((r+2*s)*f),y=Math.ceil((r+2*a)*f),v=new t.Context2DSurface(_,y),g=v.canvas,m=g.getContext("2d");if(!m)throw new Error("createGlyphRenderedSurface(): could not initialize CanvasRenderingContext2D");var w=4294901760&e?String.fromCharCode((4294901760&e)>>>16,65535&e):String.fromCharCode(e);m.save(),m.font=p+" "+r+"px "+n,m.textAlign="left",m.textBaseline="alphabetic",m.lineJoin="bevel",1!==f&&m.scale(f,f),h>0&&(m.lineWidth=h,m.strokeStyle=l,m.strokeText(w,s,a+i)),d||(m.fillStyle=c,m.fillText(w,s,a+i));var b=m.measureText(w).width;return m.restore(),{surface:v,advanceWidth:b,imageData:u?m.getImageData(0,0,g.width,g.height):void 0}}var r=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function n(t){return-1!==r.indexOf(t)?t:'"'+t+'"'}function i(t,e,r,n,i,o,s,a,u,c){return{code:t,x:e,y:r,width:n,height:i,surface:u,offsetX:o,offsetY:s,advanceWidth:a,isSurfaceValid:c,_atlas:null}}var o=function(){function t(e,r,i,o,s,a,u,c){void 0===i&&(i=r),void 0===o&&(o="black"),void 0===s&&(s=0),void 0===a&&(a="black"),void 0===u&&(u=!1),void 0===c&&(c="normal"),this._glyphAreas=Object.create(null),this.fontFamily=e,this.fontSize=r,this.baselineHeight=i,this.fontColor=o,this.strokeWidth=s,this.strokeColor=a,this.strokeOnly=u,this.fontWeight=c,this._cssFontFamily="string"==typeof e?n(e):e.map(n).join(","),-1===this._cssFontFamily.indexOf("sans-serif")&&(this._cssFontFamily+=",sans-serif"),this._marginW=Math.ceil(.3*this.fontSize+this.strokeWidth/2),this._marginH=Math.ceil(.3*this.fontSize+this.strokeWidth/2),void 0===t._environmentMinimumFontSize&&(t._environmentMinimumFontSize=this.measureMinimumFontSize())}return t.prototype.create=function(t){var r=null,n=this._glyphAreas[t];return n||((n=function(t){for(var e=t.width,r=t.height,n=0,i=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var u=0,c=t.width;u<c;u=u+1|0)0!==t.data[o+3]&&(u<e&&(e=u),u>n&&(n=u),s<r&&(r=s),s>i&&(i=s)),o+=4;return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:r,width:n-e+1,height:i-r+1}}((r=e(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)).imageData)).advanceWidth=r.advanceWidth,this._glyphAreas[t]=n),function(t){return 0===t.width||0===t.height}(n)?(r&&r.surface.destroy(),i(t,0,0,0,0,0,0,n.advanceWidth,void 0,!0)):(r||(r=e(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),i(t,n.x,n.y,n.width,n.height,n.x-this._marginW,n.y-this._marginH,n.advanceWidth,r.surface,!0))},t.prototype.measureMinimumFontSize=function(){var t,e=1,r=document.createElement("canvas").getContext("2d");if(!r)throw new Error("GlyphFactory#measureMinimumFontSize(): could not initialize CanvasRenderingContext2D");r.textAlign="left",r.textBaseline="alphabetic",r.lineJoin="bevel",r.font=e+"px sans-serif";var n=r.measureText("M").width;do{t=n,e+=1,r.font=e+"px sans-serif",n=r.measureText("M").width}while(t===n||e>50);return e},t}();return ku.GlyphFactory=o,ku}var Gu,Bu={},Hu={};function Vu(){return Gu||(Gu=1,Object.defineProperty(Hu,"__esModule",{value:!0}),Hu.RenderingHelper=void 0,function(t){t.toPowerOfTwo=function(t){if(t&t-1){for(var e=1;e<t;)e*=2;return e}return t},t.clamp=function(t){return Math.min(Math.max(t,0),1)},t.usedWebGL=function(t){var e;if(!t||0===t.length)return!1;var r=t[0];if("string"==typeof r){if("webgl"===r)return{type:"webgl",options:{enableDepthBuffer:!1}}}else if("webgl"===r.type){return{type:"webgl",options:{enableDepthBuffer:!!(null===(e=r.options)||void 0===e?void 0:e.enableDepthBuffer)}}}return!1}}(t||(Hu.RenderingHelper=t={}))),Hu;var t}var Wu,Nu={},zu={},Xu={},qu={},Yu={};var Ku,$u,Ju,Zu={};function Qu(){if(Ku)return Zu;Ku=1,Object.defineProperty(Zu,"__esModule",{value:!0}),Zu.WebGLRenderingState=void 0;var t=Bs(),e=function(){function e(e){e?(this.globalAlpha=e.globalAlpha,this.globalCompositeOperation=e.globalCompositeOperation,this.transformer=new t.AffineTransformer(e.transformer),this.shaderProgram=e.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new t.AffineTransformer,this.shaderProgram=null)}return e.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},e}();return Zu.WebGLRenderingState=e,Zu}function tc(){if($u)return qu;$u=1,Object.defineProperty(qu,"__esModule",{value:!0}),qu.WebGLRenderer=void 0;var t=function(){if(Wu)return Yu;Wu=1,Object.defineProperty(Yu,"__esModule",{value:!0}),Yu.WebGLColor=void 0;var t,e=Vu();return function(t){t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=function(r){var n="string"==typeof r?t._toColor(r):[r[0],r[1],r[2],r[3]];return n[3]=e.RenderingHelper.clamp(n[3]),n[0]=e.RenderingHelper.clamp(n[0])*n[3],n[1]=e.RenderingHelper.clamp(n[1])*n[3],n[2]=e.RenderingHelper.clamp(n[2])*n[3],n},t._hsl2rgb=function(t){var e=t[0]%360,r=t[1],n=t[2]>50?100-t[2]:t[2],i=t[3],o=n+n*r,s=n-n*r;return e<60?[o,e/60*(o-s)+s,s,i]:e<120?[(120-e)/60*(o-s)+s,o,s,i]:e<180?[s,o,(e-120)/60*(o-s)+s,i]:e<240?[s,(240-e)/60*(o-s)+s,o,i]:e<300?[(e-240)/60*(o-s)+s,s,o,i]:[o,s,(360-e)/60*(o-s)+s,i]},t._toColor=function(r){var n=r.toUpperCase().replace(/\s+/g,""),i=t.colorMap[n];if(i)return i;if(n.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(n.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(n.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(n.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(n.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),e.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),e.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(n.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),e.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),e.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+n)}}(t||(Yu.WebGLColor=t={})),Yu}(),e=Qu(),r=function(){function r(t,e){this._stateStack=[],this._stateStackPointer=0,this._capacity=0,this._reallocation(r.DEFAULT_CAPACITY),this._whiteColor=[1,1,1,1],this._shared=t,this._renderTarget=e}return r.prototype.clear=function(){this._shared.clear()},r.prototype.begin=function(){},r.prototype.end=function(){this._shared.end()},r.prototype.save=function(){this._pushState()},r.prototype.restore=function(){this._popState()},r.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},r.prototype.transform=function(t){this.currentState().transformer.transform(t)},r.prototype.opacity=function(t){this.currentState().globalAlpha*=t},r.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},r.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},r.prototype.fillRect=function(e,r,n,i,o){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,n,i,e,r,t.WebGLColor.get(o))},r.prototype.drawSprites=function(t,e,r,n,i,o,s,a){for(var u=0;u<a;++u)this.drawImage(t,e[u],r[u],n[u],i[u],o[u],s[u])},r.prototype.drawImage=function(t,e,r,n,i,o,s){if(!t._drawable)throw new Error("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw new Error("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,r,n,i,o,s,this._whiteColor)},r.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},r.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},r.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},r.prototype.isSupportedShaderProgram=function(){return!0},r.prototype.changeViewportSize=function(t,e){var r=this._renderTarget;this._renderTarget={width:r.width,height:r.height,viewportWidth:t,viewportHeight:e,texture:r.texture,framebuffer:r.framebuffer}},r.prototype.getContext=function(){return this._shared.getContext()},r.prototype.flush=function(){return this._shared.flush()},r.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},r.prototype._getImageData=function(){throw new Error("WebGLRenderer#_getImageData() is not implemented")},r.prototype._putImageData=function(t,e,r,n,i,o,s){throw new Error("WebGLRenderer#_putImageData() is not implemented")},r.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},r.prototype._popState=function(){if(!(this._stateStackPointer>0))throw new Error("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},r.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},r.prototype._reallocation=function(t){var r=this._capacity;if(r<t){t<2*r?this._capacity*=2:this._capacity=t;for(var n=r;n<this._capacity;++n)this._stateStack.push(new e.WebGLRenderingState)}},r.DEFAULT_CAPACITY=16,r}();return qu.WebGLRenderer=r,qu}var ec,rc,nc,ic={},oc={};function sc(){if(rc)return ic;rc=1;var t=ic&&ic.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ic,"__esModule",{value:!0}),ic.WebGLPrimarySurface=void 0;var e=Is(),r=function(){if(ec)return oc;ec=1;var t=oc&&oc.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(oc,"__esModule",{value:!0}),oc.WebGLPrimarySurfaceRenderer=void 0;var e=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n._shared.pushRenderTarget(n._renderTarget),n}return t(r,e),r.prototype.begin=function(){e.prototype.begin.call(this),this._shared.begin()},r}(tc().WebGLRenderer);return oc.WebGLPrimarySurfaceRenderer=e,oc}(),n=function(e){function n(t,r,n){var i=e.call(this,r,n)||this;return i.canvas.style.position="absolute",i._shared=t,i}return t(n,e),n.prototype.renderer=function(){return this._renderer||(this._renderer=new r.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},n.prototype.changePhysicalScale=function(t,e){var r=Math.ceil(this.width*t),n=Math.ceil(this.height*e);this.canvas.width=r,this.canvas.height=n,this.renderer().changeViewportSize(r,n)},n.prototype.isPlaying=function(){return!1},n}(e.CanvasSurface);return ic.WebGLPrimarySurface=n,ic}function ac(){if(nc)return zu;nc=1;var t=zu&&zu.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(zu,"__esModule",{value:!0}),zu.WebGLBackSurface=void 0;var e=function(){if(Ju)return Xu;Ju=1;var t=Xu&&Xu.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.WebGLBackSurfaceRenderer=void 0;var e=tc(),r=Qu(),n=function(e){function n(t,r){var n=e.call(this,r,r.createRenderTarget(t.width,t.height))||this;return t._drawable={texture:n._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:t.width,textureHeight:t.height},n}return t(n,e),n.prototype.begin=function(){e.prototype.begin.call(this),this.save();var t=new r.WebGLRenderingState(this.currentState()),n=t.transformer.matrix;n[1]*=-1,n[3]*=-1,n[5]=-n[5]+this._renderTarget.height,this.currentState().copyFrom(t),this._shared.pushRenderTarget(this._renderTarget)},n.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),e.prototype.end.call(this)},n}(e.WebGLRenderer);return Xu.WebGLBackSurfaceRenderer=n,Xu}(),r=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return t(n,r),n.prototype.renderer=function(){return this._renderer||(this._renderer=new e.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},n.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,r.prototype.destroy.call(this)},n}(sc().WebGLPrimarySurface);return zu.WebGLBackSurface=r,zu}var uc,cc={};var hc,lc,dc,pc={},fc={};function _c(){if(lc)return pc;lc=1,Object.defineProperty(pc,"__esModule",{value:!0}),pc.WebGLTextureAtlas=void 0;var t=Vu(),e=function(){if(hc)return fc;hc=1,Object.defineProperty(fc,"__esModule",{value:!0}),fc.WebGLTextureMap=void 0;var t=function(){function t(t,e,r,n,i){this._left=null,this._right=null,this._surface=null,this.texture=t,this.offsetX=e,this.offsetY=r,this._width=n,this._height=i}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var r=e._drawable,n=r.width+t.TEXTURE_MARGIN,i=r.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<n||this._height<i)return null;var a=this._width-n,u=this._height-i;return a<=u?(this._left=new t(this.texture,this.offsetX+n,this.offsetY,a,i),this._right=new t(this.texture,this.offsetX,this.offsetY+i,this._width,u)):(this._left=new t(this.texture,this.offsetX,this.offsetY+i,n,u),this._right=new t(this.texture,this.offsetX+n,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();return fc.WebGLTextureMap=t,fc}(),r=function(){function r(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(r.TEXTURE_SIZE*r.TEXTURE_SIZE*4)}return r.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},r.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},r.prototype.makeTextureForSurface=function(e,n){var i=n._drawable;if(i&&!i.texture){var o=i.width,s=i.height;if(o>=r.TEXTURE_SIZE||s>=r.TEXTURE_SIZE){var a=t.RenderingHelper.toPowerOfTwo(i.width),u=t.RenderingHelper.toPowerOfTwo(i.height);if(a!==i.width||u!==i.height){var c=document.createElement("canvas");c.width=a,c.height=u;var h=c.getContext("2d");if(!h)throw new Error("WebGLTextureAtlas#makeTextureForSurface(): could not initialize CanvasRenderingContext2D");h.globalCompositeOperation="copy",h.drawImage(i,0,0),i=h.getImageData(0,0,a,u)}return n._drawable.texture=e.makeTexture(i),n._drawable.textureOffsetX=0,n._drawable.textureOffsetY=0,n._drawable.textureWidth=a,void(n._drawable.textureHeight=u)}this._assign(e,n,this._maps)}},r.prototype._assign=function(t,n,i){for(var o=null,s=0;s<i.length;++s)if(o=i[(s+this._insertPos)%i.length].insert(n))return this._register(t,o,n._drawable),void(this._insertPos=s);o=null,i.length>=r.TEXTURE_COUNT&&(o=i.shift(),t.disposeTexture(o.texture),o.dispose(),t.clearTexture(this.emptyTexturePixels,r.TEXTURE_SIZE,r.TEXTURE_SIZE,o.texture)),o||(o=new e.WebGLTextureMap(t.makeTextureRaw(r.TEXTURE_SIZE,r.TEXTURE_SIZE),0,0,r.TEXTURE_SIZE,r.TEXTURE_SIZE)),i.push(o),o=o.insert(n),this._register(t,o,n._drawable)},r.prototype._register=function(t,e,n){n.texture=e.texture,n.textureOffsetX=e.offsetX,n.textureOffsetY=e.offsetY,n.textureWidth=r.TEXTURE_SIZE,n.textureHeight=r.TEXTURE_SIZE,t.assignTexture(n,e.offsetX,e.offsetY,e.texture)},r.TEXTURE_SIZE=1024,r.TEXTURE_COUNT=16,r}();return pc.WebGLTextureAtlas=r,pc}function yc(){if(dc)return Nu;dc=1,Object.defineProperty(Nu,"__esModule",{value:!0}),Nu.WebGLSharedObject=void 0;var t=ac(),e=sc(),r=function(){if(uc)return cc;uc=1,Object.defineProperty(cc,"__esModule",{value:!0}),cc.WebGLShaderProgram=void 0;var t=function(){function t(e,r,n){void 0===n&&(n=Object.create(null));var i=t._DEFAULT_VERTEX_SHADER;r=r||t._DEFAULT_FRAGMENT_SHADER;var o=t._makeShaderProgram(e,i,r);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,"aVertex");var s=e.getUniformLocation(this.program,"uColor");if(!s)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uColor'");var a=e.getUniformLocation(this.program,"uAlpha");if(!a)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uAlpha'");var u=e.getUniformLocation(this.program,"uSampler");if(!u)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uSampler'");this._uColor=s,this._uAlpha=a,this._uSampler=u,this._uniforms=n,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,r){var n=t.createShader(e);if(!n)throw new Error("WebGLShaderProgram._makeShader(): WebGLShader could not initialize");if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error(null!=i?i:"WebGLShaderProgram._makeShader(): unknown gl error")}return n},t._makeShaderProgram=function(e,r,n){var i=e.createProgram();if(!i)throw new Error("WebGLShaderProgram._makeShaderProgram(): WebGLProgram could not initialize");var o=t._makeShader(e,e.VERTEX_SHADER,r);e.attachShader(i,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,n);if(e.attachShader(i,s),e.deleteShader(s),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){var a=e.getProgramInfoLog(i);throw e.deleteProgram(i),new Error(null!=a?a:"WebGLShaderProgram._makeShaderProgram(): unknown gl error")}return i},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],r=this._uniforms[e.name].value;(e.isArray||r!==e.beforeValue)&&(e.update(e.loc,r),e.beforeValue=r)}},t.prototype.initializeUniforms=function(){var t=this,e=[],r=this._uniforms;null!=r&&Object.keys(r).forEach(function(n){var i=r[n].type,o=!("number"==typeof r[n].value);!o||"int"!==i&&"float"!==i||(i+="_v");var s=t._uniformSetterTable[i];if(!s)throw new Error("WebGLShaderProgram#initializeUniforms: Uniform type '".concat(i,"' is not supported."));var a=t._context.getUniformLocation(t.program,n);if(!a)throw new Error("WebGLShaderProgram#initializeUniforms: could not get UniformLocation of '".concat(n,"'."));e.push({name:n,update:s,beforeValue:null,isArray:o,loc:a})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",t._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",t}();return cc.WebGLShaderProgram=t,cc}(),n=_c(),i=function(){function i(t){this._renderTarget=void 0,this._defaultShaderProgram=void 0,this._textureAtlas=void 0,this._fillRectTexture=void 0,this._fillRectSurfaceTexture=void 0,this._maxSpriteCount=void 0,this._vertices=void 0,this._verticesCache=void 0,this._numSprites=void 0,this._renderTargetStack=void 0,this._currentTexture=void 0,this._currentColor=void 0,this._currentAlpha=void 0,this._currentCompositeOperation=void 0,this._currentShaderProgram=void 0,this._compositeOps=void 0,this._deleteRequestedTargets=void 0;var r=t.width,n=t.height,i=!!t.enableDepthBuffer,o=new e.WebGLPrimarySurface(this,r,n),s=o.canvas.getContext("webgl",{depth:i,preserveDrawingBuffer:!0});if(!s)throw new Error("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._enableDepthBuffer=i,this._surface=o,this._context=s,this._init()}return i.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},i.prototype.getPrimarySurface=function(){return this._surface},i.prototype.createBackSurface=function(e,r){return new t.WebGLBackSurface(this,e,r)},i.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},i.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},i.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},i.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},i.prototype.clear=function(){if(this._enableDepthBuffer)return this._context.depthMask(!0),this._context.clear(this._context.COLOR_BUFFER_BIT|this._context.DEPTH_BUFFER_BIT),void this._context.depthMask(!1);this._context.clear(this._context.COLOR_BUFFER_BIT)},i.prototype.draw=function(t,e,r,n,i,o,s,a,u){var c;if(this._numSprites>=this._maxSpriteCount&&this._commit(),c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===u[0]&&this._currentColor[1]===u[1]&&this._currentColor[2]===u[2]&&this._currentColor[3]===u[3]||(this._currentColor=u,this._commit(),this._currentShaderProgram.set_uColor(u)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var h=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(h[0],h[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+r+i),y=d*(f+n+o),v=l*(p+r),g=d*(f+n);this._register(this._transformVertex(s,a,i,o,t.transformer),[v,g,_,g,_,y,v,g,_,y,v,y])},i.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},i.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},i.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},i.prototype.assignTexture=function(t,e,r,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw new Error("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,r,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},i.prototype.clearTexture=function(t,e,r,n){this._context.bindTexture(this._context.TEXTURE_2D,n),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,r,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},i.prototype.makeTextureRaw=function(t,e,r){void 0===r&&(r=null);var n=this._context.createTexture();if(!n)throw new Error("WebGLSharedObject#makeTextureRaw(): could not create WebGLTexture");return this._context.bindTexture(this._context.TEXTURE_2D,n),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,r),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),n},i.prototype.makeTexture=function(t){var e=this._context.createTexture();if(!e)throw new Error("WebGLSharedObject#makeTexture(): could not create WebGLTexture");return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},i.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},i.prototype.createRenderTarget=function(t,e){var r=this._context,n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n);var i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0),r.bindTexture(r.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:n,texture:i}},i.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},i.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},i.prototype.getContext=function(){return this._context},i.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},i.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new r.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},i.prototype.flush=function(){this._commit()},i.prototype._init=function(){var t=new r.WebGLShaderProgram(this._context);this._textureAtlas=new n.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation="source-over",this._currentShaderProgram=t,this._defaultShaderProgram=t,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps={"source-atop":[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],"experimental-source-in":[this._context.DST_ALPHA,this._context.ZERO],"experimental-source-out":[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],"source-over":[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],"experimental-destination-atop":[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],"experimental-destination-in":[this._context.ZERO,this._context.SRC_ALPHA],"destination-out":[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],"destination-over":[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],lighter:[this._context.ONE,this._context.ONE],copy:[this._context.ONE,this._context.ZERO],xor:[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],difference:[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],saturation:[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA]};var e=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(e[0],e[1])},i.prototype._makeBuffer=function(t){var e=this._context.createBuffer();if(!e)throw new Error("WebGLSharedObject#_makeBuffer(): could not create WebGLBuffer");return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},i.prototype._transformVertex=function(t,e,r,n,i){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,u=i.matrix,c=s*r*u[0],h=a*r*u[1],l=s*n*u[2],d=a*n*u[3],p=s*(t*u[0]+e*u[2]+u[4])-1,f=a*(t*u[1]+e*u[3]+u[5])+1;return[p,f,c+p,h+f,c+l+p,h+d+f,p,f,c+l+p,h+d+f,l+p,d+f]},i.prototype._register=function(t,e){var r=6*this._numSprites;++this._numSprites;for(var n=0;n<6;++n)this._verticesCache[4*(n+r)+0]=t[2*n+0],this._verticesCache[4*(n+r)+1]=t[2*n+1],this._verticesCache[4*(n+r)+2]=e[2*n+0],this._verticesCache[4*(n+r)+3]=e[2*n+1]},i.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},i}();return Nu.WebGLSharedObject=i,Nu}var vc,gc,mc,wc,bc={};function Ac(){if(gc)return Bu;gc=1,Object.defineProperty(Bu,"__esModule",{value:!0}),Bu.SurfaceFactory=void 0;var t=Ks(),e=Vu(),r=yc(),n=function(){if(vc)return bc;vc=1,Object.defineProperty(bc,"__esModule",{value:!0}),bc.CanvasDisposer=void 0;var t=function(){function t(){this._idCounter=0,this._canvasMap={},this._registry="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry(this._dispose.bind(this)):null}return t.prototype.register=function(t,e){if(this._registry){var r="".concat(this._idCounter++);this._canvasMap[r]=e,this._registry.register(t,r)}},t.prototype._dispose=function(t){var e=this._canvasMap[t];e&&(e.width=1,e.height=1,delete this._canvasMap[t])},t}();return bc.CanvasDisposer=t,bc}(),i=function(){function i(){this._disposer=new n.CanvasDisposer}return i.prototype.createPrimarySurface=function(n,i,o){var s=e.RenderingHelper.usedWebGL(o);return s?(this._shared||(this._shared=new r.WebGLSharedObject({width:n,height:i,enableDepthBuffer:s.options.enableDepthBuffer})),this._shared.getPrimarySurface()):new t.Context2DSurface(n,i)},i.prototype.createBackSurface=function(r,n,i){var o=e.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(r,n):new t.Context2DSurface(r,n);return this._disposer.register(o,o.getHTMLElement()),o},i}();return Bu.SurfaceFactory=i,Bu}function xc(){if(mc)return Du;mc=1,Object.defineProperty(Du,"__esModule",{value:!0}),Du.ResourceFactory=void 0;var t=xs(),e=Js(),r=ra(),n=ou(),i=$s(),o=sa(),s=lu(),a=Uu(),u=Ac(),c=function(){function c(t){this._audioPluginManager=t.audioPluginManager,this._audioManager=t.audioManager,this._platform=t.platform,this._surfaceFactory=new u.SurfaceFactory}return c.prototype.createAudioAsset=function(t,e,r,n,i,o,s){var a=this._audioPluginManager.getActivePlugin();if(!a)throw new Error("ResourceFactory#createAudioAsset(): could not initialize ActivePlugin");var u=a.createAsset(t,e,r,n,i,o,s);return this._audioManager.registerAudioAsset(u),u.onDestroyed.addOnce(this._onAudioAssetDestroyed,this),u},c.prototype.createAudioPlayer=function(t){var e=this._audioPluginManager.getActivePlugin();if(!e)throw new Error("ResourceFactory#createAudioAsset(): could not initialize ActivePlugin");return e.createPlayer(t,this._audioManager)},c.prototype.createImageAsset=function(t,e,n,i){return new r.HTMLImageAsset(t,e,n,i)},c.prototype.createVideoAsset=function(t,e,r,i,o,s,a){return new n.HTMLVideoAsset(t,e,r,i,o,s,a)},c.prototype.createTextAsset=function(t,e){return new s.XHRTextAsset(t,e)},c.prototype.createScriptAsset=function(t,e,r){return new o.XHRScriptAsset(t,e,r)},c.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},c.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},c.prototype.createGlyphFactory=function(t,e,r,n,i,o,s,u){return new a.GlyphFactory(t,e,r,n,i,o,s,u)},c.prototype.createVectorImageAsset=function(t,e,r,n,o){return new i.SVGImageAsset(t,e,r,n,o)},c.prototype.createVectorImageAssetFromString=function(t,r,n){return new e.GeneratedSVGImageAsset(t,r,n)},c.prototype.createBinaryAsset=function(e,r){return new t.BinaryAsset(e,r)},c.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},c}();return Du.ResourceFactory=c,Du}function Sc(){if(wc)return cu;wc=1,Object.defineProperty(cu,"__esModule",{value:!0}),cu.Platform=void 0;var t=lu(),e=fu(),r=function(){if(Su)return vu;Su=1,Object.defineProperty(vu,"__esModule",{value:!0}),vu.ContainerController=void 0;var t=pt(),e=Eu(),r=function(){function r(e){this.container=void 0,this.surface=void 0,this.inputHandlerLayer=void 0,this.rootView=void 0,this.observer=void 0,this.useResizeForScaling=!1,this.pointEventTrigger=new t.Trigger,this._rendererReq=void 0,this.resourceFactory=e}return r.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._loadView()},r.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},r.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},r.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},r.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},r.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},r.prototype.setTabIndex=function(t){this.inputHandlerLayer.setViewTabIndex(t)},r.prototype._loadView=function(){var t=this,r=this._rendererReq,n=r.primarySurfaceWidth,i=r.primarySurfaceHeight;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:n,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy(),this.observer.disconnect())):this.inputHandlerLayer=new e.InputHandlerLayer({width:n,height:i}),this.surface=this.resourceFactory.createPrimarySurface(n,i);var o=this.surface.getHTMLElement();this.observer=new MutationObserver(function(){t.inputHandlerLayer.view.style.width=o.offsetWidth+"px",t.inputHandlerLayer.view.style.height=o.offsetHeight+"px"}),this.observer.observe(o,{attributeFilter:["width","height","style"]}),this.inputHandlerLayer.view.appendChild(o),this.container.appendChild(this.inputHandlerLayer.view)},r.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},r}();return vu.ContainerController=r,vu}(),n=Mu(),i=Ru(),o=function(){if(Iu)return Fu;Iu=1,Object.defineProperty(Fu,"__esModule",{value:!0}),Fu.RafLooper=void 0;var t=function(){function t(t){this._timerId=null,this._fun=t,this._prev=0}return t.prototype.start=function(){var t=this,e=function(r){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(r-t._prev),t._prev=r)};this._timerId=requestAnimationFrame(function(r){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=r})},t.prototype.stop=function(){null!=this._timerId&&cancelAnimationFrame(this._timerId),this._timerId=null,this._prev=0},t}();return Fu.RafLooper=t,Fu}(),s=xc(),a=function(){function a(t){this.usingPointerEvents=!0,this.containerView=t.containerView,this.audioPluginManager=new n.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(i.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new e.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new s.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new r.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return a.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},a.prototype.loadGameConfiguration=function(e,r){var n=new t.XHRTextAsset("(game.json)",e);n._load({_onAssetLoad:function(t){r(null,JSON.parse(n.data))},_onAssetError:function(t,e){r(e,null)}})},a.prototype.getResourceFactory=function(){return this._resourceFactory},a.prototype.setRendererRequirement=function(t){var e;t?(this._rendererReq=t,this._resourceFactory._rendererCandidates=null!==(e=this._rendererReq.rendererCandidates)&&void 0!==e?e:[],this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)):this.containerController&&this.containerController.unloadView()},a.prototype.getPrimarySurface=function(){return this.containerController.surface},a.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},a.prototype.createLooper=function(t){return new o.RafLooper(t)},a.prototype.sendToExternal=function(t,e){},a.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},a.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},a.prototype.notifyViewMoved=function(){},a.prototype.setMasterVolume=function(t){this._audioManager.setMasterVolume(t)},a.prototype.getMasterVolume=function(){return this._audioManager.getMasterVolume()},a.prototype.setTabIndex=function(t){this.containerController.setTabIndex(t)},a.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0),this.audioPluginManager.clear()},a}();return cu.Platform=a,cu}var Pc,Ec={},Oc={};function Tc(){if(Pc)return Oc;Pc=1,Object.defineProperty(Oc,"__esModule",{value:!0}),Oc.CachedLoader=void 0;var t=function(){function t(t,e){this.loaderImpl=t,this.table=new Map,this.priorities=new Map,this.totalSize=0,this.totalUseCount=0,this.limitSize=e.limitSize}return t.prototype.load=function(t){var e=this;this._maximizePriority(t);var r=this.table.get(t);if(r)return r.promise;var n=this.loaderImpl(t).then(function(r){var i=r.value,o=r.size;return e.table.set(t,{size:o,promise:n}),e._cleanupCache(o),{value:i,size:o}}).catch(function(r){throw e._deleteCache(t),r});return this.table.set(t,{size:0,promise:n}),n},t.prototype.reset=function(){this.table.clear(),this.priorities.clear(),this.totalSize=0,this.totalUseCount=0},t.prototype._cleanupCache=function(t){if(this.totalSize+=t,!(this.totalSize<=this.limitSize))for(var e=0,r=Array.from(this.priorities).sort(function(t,e){return t[1]-e[1]});e<r.length;e++){var n=r[e];if(this._deleteCache(n[0]),this.totalSize<=this.limitSize)break}},t.prototype._deleteCache=function(t){var e=this.table.get(t);e&&(this.totalSize-=e.size,this.table.delete(t),this.priorities.delete(t))},t.prototype._maximizePriority=function(t){this.totalUseCount++,this.priorities.set(t,this.totalUseCount)},t}();return Oc.CachedLoader=t,Oc}var Mc,Cc={};function Lc(){if(Mc)return Cc;return Mc=1,Object.defineProperty(Cc,"__esModule",{value:!0}),Cc.detectSupportedFormats=function(){var t;if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];for(var e=document.createElement("audio"),r=["ogg","m4a","aac","mp4"],n={m4a:"audio/x-m4a"},i=[],o=0,s=r.length;o<s;o++){var a=r[o],u=null!==(t=n[a])&&void 0!==t?t:"audio/"+a;try{var c=e.canPlayType(u);"no"!==c&&""!==c&&i.push(a)}catch(t){}}return i},Cc.resolveExtname=function(t,e){if(!t||!t.length)return null;for(var r=0,n=e;r<n.length;r++){var i="."+n[r];if(-1!==t.indexOf(i))return i}return null},Cc.addExtname=function(t,e){var r=t.indexOf("?");if(-1===r)return t+e;return t.substring(0,r)+e+t.substring(r,t.length)},Cc}var Rc,Ic,Fc={},jc={};function Dc(){if(Rc)return jc;Rc=1;var t=jc&&jc.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(jc,"__esModule",{value:!0}),jc.AudioAsset=void 0;var e=function(e){function r(t,r,n,i,o,s,a){var u=e.call(this,t,r)||this;return u.type="audio",u.data=void 0,u.duration=n,u.loop=o,u.hint=s,u._system=i,u.offset=a,u.path=u._modifyPath(u.path),u}return t(r,e),r.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},r.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},r.prototype.inUse=function(){return this._system.findPlayers(this).length>0},r.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,e.prototype.destroy.call(this)},r}(As().Asset);return jc.AudioAsset=e,jc}function kc(){if(Ic)return Fc;Ic=1;var t=Fc&&Fc.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),e=Fc&&Fc.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})},r=Fc&&Fc.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.HTMLAudioAsset=void 0,Fc.loadAudioElement=s;var n=Dc(),i=ys(),o=Lc();function s(t){return e(this,void 0,void 0,function(){function e(t){var e=new Audio,r=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))};return new Promise(function(n,i){var o=-1,s={success:function(){r(e,s),window.clearInterval(o),n({value:{audio:e,url:t},size:1e3*e.duration})},error:function(){r(e,s),window.clearInterval(o),i()}};e.autoplay=!1,e.preload="none",e.src=t,function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))}(e,s),e.preload="auto",function(t,e){var r=0;o=window.setInterval(function(){4===t.readyState?e.success():600===++r&&e.error()},100)}(e,s),e.load()})}var n,i,o,s;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,5]),[4,e(t)];case 1:case 3:return[2,r.sent()];case 2:return n=r.sent(),i=t.indexOf("?"),".aac"!==(i>=0?t.substring(0,i):t).slice(-4)||-1===a.supportedFormats.indexOf("mp4")?[3,4]:(o=t.substring(0,i-4)+".mp4",s=i>=0?t.substring(i,t.length):"",[4,e(o+s)]);case 4:throw n;case 5:return[2]}})})}var a=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);(this._loadFun?this._loadFun:s)(this.path).then(function(r){e.path!==r.value.url&&(e.path=r.value.url),e.data=r.value.audio,t._onAssetLoad(e)}).catch(function(r){t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error"))})},r.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},r.prototype._assetPathFilter=function(t){return-1!==r.supportedFormats.indexOf("ogg")?(0,o.addExtname)(t,".ogg"):-1!==r.supportedFormats.indexOf("aac")?(0,o.addExtname)(t,".aac"):null},r.prototype._modifyPath=function(t){var e,n=(0,o.resolveExtname)(null===(e=this.hint)||void 0===e?void 0:e.extensions,r.supportedFormats);return n?(0,o.addExtname)(this.originalPath,n):t},r}(n.AudioAsset);return Fc.HTMLAudioAsset=a,Fc}var Uc,Gc={},Bc={};function Hc(){if(Uc)return Bc;Uc=1,Object.defineProperty(Bc,"__esModule",{value:!0}),Bc.AudioPlayer=void 0;var t=pt(),e=function(){function e(e){this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.volume=1,this._muted=!1,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){},e.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},e}();return Bc.AudioPlayer=e,Bc}var Vc,Wc,Nc,zc={};function Xc(){if(Vc)return zc;Vc=1;var t=zc&&zc.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})},e=zc&&zc.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(zc,"__esModule",{value:!0}),zc.setupChromeMEIWorkaround=function(s){var a=null;function u(){switch(r){case 0:case 1:o()}r=2,clearTimeout(a)}switch(r){case 0:s.addEventListener("play",u,!0),a=window.setTimeout(function(){return t(this,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:switch(s.removeEventListener("play",u),r){case 0:return[3,1];case 1:return[3,2];case 2:return[3,3]}return[3,5];case 1:return n.push(s),r=1,document.addEventListener("keydown",i,!0),document.addEventListener("mousedown",i,!0),document.addEventListener("touchend",i,!0),[3,5];case 2:return n.push(s),[3,5];case 3:return[4,s.play()];case 4:return t.sent(),[3,5];case 5:return[2]}})})},100);break;case 1:n.push(s)}};var r=0,n=[];function i(){o(),document.removeEventListener("keydown",i),document.removeEventListener("mousedown",i),document.removeEventListener("touchend",i)}function o(){r=2,n.forEach(function(t){return t.play()}),n=[]}return zc}function qc(){if(Wc)return Gc;Wc=1;var t=Gc&&Gc.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),e=Gc&&Gc.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})},r=Gc&&Gc.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(Gc,"__esModule",{value:!0}),Gc.HTMLAudioPlayer=void 0;var n=Hc(),i=Xc(),o=function(n){function o(t,e){var r=n.call(this,t)||this;return r._audioInstance=null,r._isWaitingPlayEvent=!1,r._isStopRequested=!1,r._assetLoop=!1,r._manager=e,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return t(o,n),o.prototype.play=function(t){var o,s,a=this;if(this.currentAudio){if(t.id===this.currentAudio.id)return n.prototype.stop.call(this),this._audioInstance.currentTime=(null!==(o=t.offset)&&void 0!==o?o:0)/1e3,void n.prototype.play.call(this,t);this.stop()}var u=t.cloneElement();if(this._assetLoop=t.loop,u){if(t.offset){var c=(null!==(s=t.offset)&&void 0!==s?s:0)/1e3,h=t.duration/1e3+c;u.currentTime=c,u.ontimeupdate=function(){h<=u.currentTime&&(t.loop?u.currentTime=c:u.pause())},u.onended=function(){return e(a,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return t.loop?(u.currentTime=c,[4,u.play()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})}}else u.loop=t.loop;(0,i.setupChromeMEIWorkaround)(u),u.volume=this._calculateVolume(),u.play().catch(function(t){}),u.addEventListener("ended",this._endedEventHandler,!1),u.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=u}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration);n.prototype.play.call(this,t)},o.prototype.stop=function(){this.currentAudio?(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),n.prototype.stop.call(this)):n.prototype.stop.call(this)},o.prototype.changeVolume=function(t){n.prototype.changeVolume.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},o.prototype._changeMuted=function(t){n.prototype._changeMuted.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},o.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},o.prototype._onAudioEnded=function(){this._assetLoop||(this._clearEndedEventHandler(),n.prototype.stop.call(this))},o.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},o.prototype._onPlayEvent=function(){var t;this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,null===(t=this._audioInstance)||void 0===t||t.pause(),this._audioInstance=null))},o.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},o}(n.AudioPlayer);return Gc.HTMLAudioPlayer=o,Gc}var Yc,Kc={},$c={};var Jc,Zc,Qc={};function th(){if(Zc)return Kc;Zc=1,Object.defineProperty(Kc,"__esModule",{value:!0}),Kc.ProxyAudioPlugin=void 0;var t=function(){if(Yc)return $c;Yc=1;var t=$c&&$c.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty($c,"__esModule",{value:!0}),$c.ProxyAudioAsset=void 0;var e=Dc(),r=ys(),n=function(e){function n(t,r,n,i,o,s,a,u){var c=e.call(this,r,n,i,o,s,a,u)||this;return c._handlerSet=t,c}return t(n,e),n.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),e.prototype.destroy.call(this)},n.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint,offset:this.offset},function(n){n?t._onAssetError(e,r.ExceptionFactory.createAssetLoadError(n)):t._onAssetLoad(e)})},n.prototype._assetPathFilter=function(t){return t},n.prototype._modifyPath=function(t){return t},n}(e.AudioAsset);return $c.ProxyAudioAsset=n,$c}(),e=function(){if(Jc)return Qc;Jc=1;var t=Qc&&Qc.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Qc,"__esModule",{value:!0}),Qc.ProxyAudioPlayer=void 0;var e=function(e){function r(t,r,n){var i=e.call(this,r)||this;return i._audioPlayerId=null,i._handlerSet=t,i._manager=n,i}return t(r,e),r.prototype.changeVolume=function(t){e.prototype.changeVolume.call(this,t),this._notifyVolumeToHandler()},r.prototype._changeMuted=function(t){e.prototype._changeMuted.call(this,t),this._notifyVolumeToHandler()},r.prototype.play=function(t){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap".concat(r._audioPlayerIdCounter++),this._handlerSet.createAudioPlayer({assetId:t.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),e.prototype.play.call(this,t)},r.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),e.prototype.stop.call(this)},r.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},r.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},r.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},r._audioPlayerIdCounter=0,r}(Hc().AudioPlayer);return Qc.ProxyAudioPlayer=e,Qc}(),r=function(){function r(t){this.supportedFormats=[],this._handlerSet=t}return r.isSupported=function(){return!0},r.prototype.createAsset=function(e,r,n,i,o,s,a){return new t.ProxyAudioAsset(this._handlerSet,e,r,n,i,o,s,a)},r.prototype.createPlayer=function(t,r){return new e.ProxyAudioPlayer(this._handlerSet,t,r)},r.prototype.clear=function(){},r}();return Kc.ProxyAudioPlugin=r,Kc}var eh,rh,nh,ih,oh,sh={},ah={};function uh(){if(rh)return eh;rh=1;var t,e=window.AudioContext||window.webkitAudioContext;return function(t){t.getAudioContext=function(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var r=window.__akashic__.audioContext;return r instanceof e||(r=window.__akashic__.audioContext=new e,t._workAroundSafari()),r},t.createGainNode=function(t){return t.createGain?t.createGain():t.createGainNode()},t.createBufferNode=function(t){var e=t.createBufferSource();return e.start||(e.start=e.noteOn,e.stop=e.noteOff),e},t._workAroundSafari=function(){document.addEventListener("touchstart",function e(){document.removeEventListener("touchstart",e),t.getAudioContext().createBufferSource().start(0)},!0)}}(t||(t={})),eh=t}function ch(){if(nh)return ah;nh=1;var t=ah&&ah.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),e=ah&&ah.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})},r=ah&&ah.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(ah,"__esModule",{value:!0}),ah.WebAudioAsset=void 0,ah.loadArrayBuffer=u;var n=Dc(),i=ys(),o=vs(),s=Lc(),a=uh();function u(t){return e(this,void 0,void 0,function(){function e(t){var e=new o.XHRLoader;return new Promise(function(r,n){e.getArrayBuffer(t,function(e,i){return e?n(e):i?void a.getAudioContext().decodeAudioData(i,function(e){var n;return r({value:{audio:e,url:t},size:null!==(n=i.byteLength)&&void 0!==n?n:0})},n).catch(function(t){n(t)}):n("response is undefined: ".concat(t))})})}var n,i,s,u;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,5]),[4,e(t)];case 1:case 3:return[2,r.sent()];case 2:return n=r.sent(),i=t.indexOf("?"),".aac"!==(i>=0?t.substring(0,i):t).slice(-4)?[3,4]:(s=t.substring(0,i-4)+".mp4",u=i>=0?t.substring(i,t.length):"",[4,e(s+u)]);case 4:throw n;case 5:return[2]}})})}var c=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);(this._loadFun?this._loadFun:u)(this.path).then(function(r){e.path!==r.value.url&&(e.path=r.value.url),e.data=r.value.audio,t._onAssetLoad(e)}).catch(function(r){t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))})},r.prototype._assetPathFilter=function(t){return-1!==r.supportedFormats.indexOf("ogg")?(0,s.addExtname)(t,".ogg"):-1!==r.supportedFormats.indexOf("aac")?(0,s.addExtname)(t,".aac"):null},r.prototype._modifyPath=function(t){var e,n=(0,s.resolveExtname)(null===(e=this.hint)||void 0===e?void 0:e.extensions,r.supportedFormats);return n?(0,s.addExtname)(this.originalPath,n):t},r.supportedFormats=[],r}(n.AudioAsset);return ah.WebAudioAsset=c,ah}function hh(){if(oh)return ih;oh=1;var t,e=ih&&ih.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})},r=ih&&ih.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},n=uh();function i(){return e(this,void 0,void 0,function(){var t;return r(this,function(e){switch(e.label){case 0:return t=n.getAudioContext(),document.removeEventListener("keydown",i),document.removeEventListener("mousedown",i),document.removeEventListener("touchend",i),[4,t.resume()];case 1:return e.sent(),[2]}})})}return function(t){t.setupChromeMEIWorkaround=function(){var t=n.getAudioContext();if(!t||"function"==typeof t.resume){var e=n.createGainNode(t),r=t.createOscillator();r.type="sawtooth",r.frequency.value=440,r.connect(e),r.start(0);var o=t.state;r.disconnect(),"running"!==o&&(document.addEventListener("keydown",i,!0),document.addEventListener("mousedown",i,!0),document.addEventListener("touchend",i,!0))}}}(t||(t={})),ih=t}var lh,dh,ph,fh,_h,yh,vh={};function gh(){if(dh)return sh;dh=1,Object.defineProperty(sh,"__esModule",{value:!0}),sh.WebAudioPlugin=void 0;var t=Tc(),e=Lc(),r=ch(),n=hh(),i=function(){if(lh)return vh;lh=1;var t=vh&&vh.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(vh,"__esModule",{value:!0}),vh.WebAudioPlayer=void 0;var e=Hc(),r=uh(),n=function(e){function n(t,n){var i=e.call(this,t)||this;return i._audioContext=r.getAudioContext(),i._manager=n,i._gainNode=r.createGainNode(i._audioContext),i._gainNode.connect(i._audioContext.destination),i._dummyDurationWaitTimer=null,i._endedEventHandler=function(){i._onAudioEnded()},i}return t(n,e),n.prototype.changeVolume=function(t){e.prototype.changeVolume.call(this,t),this._gainNode.gain.value=this._calculateVolume()},n.prototype._changeMuted=function(t){e.prototype._changeMuted.call(this,t),this._gainNode.gain.value=this._calculateVolume()},n.prototype.play=function(t){var n;if(this.currentAudio&&this.stop(),t.data){var i=r.createBufferNode(this._audioContext);if(i.buffer=t.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,t.loop)i.loop=t.loop,this._sourceNode.start(0);else{var o=(null!==(n=t.offset)&&void 0!==n?n:0)/1e3;t.duration>0?this._sourceNode.start(0,o,t.duration/1e3):this._sourceNode.start(0,o)}}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration);e.prototype.play.call(this,t)},n.prototype.stop=function(){this.currentAudio?(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),e.prototype.stop.call(this)):e.prototype.stop.call(this)},n.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},n.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),e.prototype.stop.call(this)},n.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},n.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},n}(e.AudioPlayer);return vh.WebAudioPlayer=n,vh}(),o=function(){function o(){this._supportedFormats=[],this.supportedFormats=(0,e.detectSupportedFormats)(),this._cachedLoader=new t.CachedLoader(r.loadArrayBuffer,{limitSize:1e8}),n.setupChromeMEIWorkaround()}return o.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(o.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),o.prototype.createAsset=function(t,e,n,i,o,s,a){var u=new r.WebAudioAsset(t,e,n,i,o,s,a);return u._loadFun=this._cachedLoader.load.bind(this._cachedLoader),u},o.prototype.createPlayer=function(t,e){return new i.WebAudioPlayer(t,e)},o.prototype.clear=function(){this._cachedLoader.reset()},o}();return sh.WebAudioPlugin=o,sh}function mh(){return ph||(ph=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyAudioPlugin=t.WebAudioPlugin=t.HTMLAudioPlugin=t.AudioPluginManager=t.AudioPluginRegistry=t.ResourceFactory=t.Platform=void 0;var e=Sc();Object.defineProperty(t,"Platform",{enumerable:!0,get:function(){return e.Platform}});var r=Ru();Object.defineProperty(t,"AudioPluginRegistry",{enumerable:!0,get:function(){return r.AudioPluginRegistry}});var n=Mu();Object.defineProperty(t,"AudioPluginManager",{enumerable:!0,get:function(){return n.AudioPluginManager}});var i=function(){if(Nc)return Ec;Nc=1,Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.HTMLAudioPlugin=void 0;var t=Tc(),e=Lc(),r=kc(),n=qc(),i=function(){function i(){this._supportedFormats=[],this.supportedFormats=(0,e.detectSupportedFormats)(),this._cachedLoader=new t.CachedLoader(r.loadAudioElement,{limitSize:6e6})}return i.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(i.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),i.prototype.createAsset=function(t,e,n,i,o,s,a){var u=new r.HTMLAudioAsset(t,e,n,i,o,s,a);return u._loadFun=this._cachedLoader.load.bind(this._cachedLoader),u},i.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},i.prototype.clear=function(){this._cachedLoader.reset()},i}();return Ec.HTMLAudioPlugin=i,Ec}();Object.defineProperty(t,"HTMLAudioPlugin",{enumerable:!0,get:function(){return i.HTMLAudioPlugin}});var o=th();Object.defineProperty(t,"ProxyAudioPlugin",{enumerable:!0,get:function(){return o.ProxyAudioPlugin}});var s=gh();Object.defineProperty(t,"WebAudioPlugin",{enumerable:!0,get:function(){return s.WebAudioPlugin}});var a=xc();Object.defineProperty(t,"ResourceFactory",{enumerable:!0,get:function(){return a.ResourceFactory}})}(uu)),uu}function wh(){if(yh)return au;yh=1,Object.defineProperty(au,"__esModule",{value:!0}),au.AudioFactory=void 0;var t=_h?fh:(_h=1,fh=mh()),e=fu(),r=function(){function r(){this.audioManager=new e.AudioManager,this.audioPluginManager=new t.AudioPluginManager,this.audioPluginManager.tryInstallPlugin([t.HTMLAudioPlugin,t.WebAudioPlugin])}return r.prototype.createAudioAsset=function(t,e,r,n,i,o,s){var a=this.audioPluginManager.getActivePlugin().createAsset(t,e,r,n,i,o,null!=s?s:0);return this.audioManager.registerAudioAsset(a),a.onDestroyed.addOnce(this.handleAudioAssetDestroyed,this),a},r.prototype.createAudioPlayer=function(t){return this.audioPluginManager.getActivePlugin().createPlayer(t,this.audioManager)},r.prototype.handleAudioAssetDestroyed=function(t){this.audioManager.removeAudioAsset(t)},r}();return au.AudioFactory=r,au}var bh,Ah={};var xh,Sh={},Ph={};var Eh,Oh,Th,Mh,Ch={};function Lh(){if(Oh)return Sh;Oh=1,Object.defineProperty(Sh,"__esModule",{value:!0}),Sh.SurfaceFactory=void 0;var t=function(){if(xh)return Ph;xh=1,Object.defineProperty(Ph,"__esModule",{value:!0}),Ph.Context2DSurface=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}(t.__importStar(Ks()).Context2DSurface);return Ph.Context2DSurface=e,Ph}(),e=function(){if(Eh)return Ch;Eh=1,Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.PrimaryContext2DSurface=void 0;var t=H,e=Hs(),r=Ys(),n=function(n){function i(t,r,i){var o=n.call(this,t,r,i)||this,s=i.getContext("2d");if(null==s)throw new Error("PrimaryContext2DSurface#constructor: cannot get context");return o._context=new e.CanvasSurfaceContext(s),i.width=t,i.height=r,o.canvas=i,o._renderer=void 0,o}return t.__extends(i,n),i.prototype.context=function(){return this._context},i.prototype.renderer=function(){return this._renderer||(this._renderer=new r.Context2DRenderer(this)),this._renderer},i.prototype.changeVisualScale=function(t,e){var r=this.canvas.style;"transform"in r?(r.transformOrigin="0 0",r.transform="scale("+t+","+e+")"):"webkitTransform"in r?(r.webkitTransformOrigin="0 0",r.webkitTransform="scale("+t+","+e+")"):(r.width=Math.floor(t*this.width)+"px",r.height=Math.floor(e*this.width)+"px")},i.prototype.changePhysicalScale=function(t,e){this._context&&(this.canvas.width=this.width*t),this.canvas.height=this.height*e,this._context.scale(t,e)},i.prototype.isPlaying=function(){return!1},i.prototype.getHTMLElement=function(){return this.canvas},i.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=void 0,this._renderer=void 0,n.prototype.destroy.call(this)},i}(Rs().Surface);return Ch.PrimaryContext2DSurface=n,Ch}(),r=function(){function r(t){this.canvas=t}return r.prototype.createPrimarySurface=function(t,r){return new e.PrimaryContext2DSurface(t,r,this.canvas)},r.prototype.createSurface=function(e,r){return new t.Context2DSurface(e,r)},r}();return Sh.SurfaceFactory=r,Sh}function Rh(){if(Th)return as;Th=1,Object.defineProperty(as,"__esModule",{value:!0}),as.ResourceFactory=void 0;var t=H.__importDefault(ls),e=function(){if(ws)return ds;ws=1,Object.defineProperty(ds,"__esModule",{value:!0}),ds.BinaryAsset=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}(xs().BinaryAsset);return ds.BinaryAsset=e,ds}(),r=function(){if(Xs)return Es;Xs=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.GeneratedVectorImageAsset=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}(Js().GeneratedSVGImageAsset);return Es.GeneratedVectorImageAsset=e,Es}(),n=function(){if(Qs)return ta;Qs=1,Object.defineProperty(ta,"__esModule",{value:!0}),ta.ImageAsset=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}(ra().HTMLImageAsset);return ta.ImageAsset=e,ta}(),i=function(){if(Wa)return ia;Wa=1,Object.defineProperty(ia,"__esModule",{value:!0}),ia.ScriptAsset=void 0;var t=H,e=sa(),r=za(),n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n.prototype._overrideLoadFunc=function(t){var e=this;this._load=function(n){t(e.id,e.path,function(t,i){t?n._onAssetError(e,r.ExceptionFactory.createAssetLoadError(t.message,!1)):i?(e.script=i+"\n",n._onAssetLoad(e)):n._onAssetError(e,r.ExceptionFactory.createAssetLoadError("no data received",!1))})}},n}(e.XHRScriptAsset);return ia.ScriptAsset=n,ia}(),o=function(){if(Xa)return qa;Xa=1,Object.defineProperty(qa,"__esModule",{value:!0}),qa.VectorImageAsset=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}($s().SVGImageAsset);return qa.VectorImageAsset=e,qa}(),s=Za(),a=function(){if(eu)return ru;eu=1,Object.defineProperty(ru,"__esModule",{value:!0}),ru.VideoAsset=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}(ou().HTMLVideoAsset);return ru.VideoAsset=e,ru}(),u=wh(),c=function(){if(bh)return Ah;bh=1,Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.GlyphFactory=void 0;var t=H,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r}(t.__importStar(Uu()).GlyphFactory);return Ah.GlyphFactory=e,Ah}(),h=Lh(),l=function(){function l(t){this.surfaceFactory=new h.SurfaceFactory(t.canvas),this.audioFactory=new u.AudioFactory,this.assetLoaderFuncs=t.assetLoaderFuncs,this.assetBaseDir=t.assetBaseDir||""}return l.prototype.createAudioAsset=function(e,r,n,i,o,s){return this.audioFactory.createAudioAsset(e,(0,t.default)(this.assetBaseDir,r),n,i,o,s)},l.prototype.createAudioPlayer=function(t){return this.audioFactory.createAudioPlayer(t)},l.prototype.createImageAsset=function(e,r,i,o){return new n.ImageAsset(e,(0,t.default)(this.assetBaseDir,r),i,o)},l.prototype.createVectorImageAsset=function(e,r,n,i,s){return new o.VectorImageAsset(e,(0,t.default)(this.assetBaseDir,r),n,i,s)},l.prototype.createVideoAsset=function(e,r,n,i,o,s,u){return new a.VideoAsset(e,(0,t.default)(this.assetBaseDir,r),n,i,o,s,u)},l.prototype.createTextAsset=function(e,r){var n=new s.TextAsset(e,(0,t.default)(this.assetBaseDir,r));return this.assetLoaderFuncs&&this.assetLoaderFuncs.loadTextAsset&&n._overrideLoadFunc(this.assetLoaderFuncs.loadTextAsset),n},l.prototype.createScriptAsset=function(e,r,n){var o=new i.ScriptAsset(e,(0,t.default)(this.assetBaseDir,r),n);return this.assetLoaderFuncs&&this.assetLoaderFuncs.loadScriptAsset&&o._overrideLoadFunc(this.assetLoaderFuncs.loadScriptAsset),o},l.prototype.createBinaryAsset=function(r,n){return new e.BinaryAsset(r,(0,t.default)(this.assetBaseDir,n))},l.prototype.createPrimarySurface=function(t,e){return this.surfaceFactory.createPrimarySurface(t,e)},l.prototype.createSurface=function(t,e){return this.surfaceFactory.createSurface(t,e)},l.prototype.createGlyphFactory=function(t,e,r,n,i,o,s,a){return new c.GlyphFactory(t,e,r,n,i,o,s,a)},l.prototype.createVectorImageAssetFromString=function(t,e,n){return new r.GeneratedVectorImageAsset(t,e,n)},l}();return as.ResourceFactory=l,as}var Ih=function(){if(Mh)return r;Mh=1,Object.defineProperty(r,"__esModule",{value:!0}),r.initialize=function(r){var s,a,u,c=new i.ResourceFactory({canvas:r.canvas,assetLoaderFuncs:r.assetLoaderFuncs,assetBaseDir:r.assetBaseDir});null==r.configuration&&(r.configuration={});null==r.configuration.assets&&(r.configuration.assets={});for(var h=r.configuration.assets,l=Object.keys(h),d=0;d<l.length;d++)h[l[d]].virtualPath=h[l[d]].path;var p=new e.Game({engineModule:e,handlerSet:new n.GameHandlerSet({isSnapshotSaver:!0}),configuration:t.__assign(t.__assign({},r.configuration),{assets:r.configuration.assets,main:null!==(s=r.configuration.main)&&void 0!==s?s:"",width:null!==(a=r.configuration.width)&&void 0!==a?a:r.canvas.width,height:null!==(u=r.configuration.height)&&void 0!==u?u:r.canvas.height}),resourceFactory:c,operationPluginViewInfo:{view:r.canvas},mainFunc:r.mainFunc}),f=c.createPrimarySurface(p.width,p.height);p.renderers.push(f.renderer()),p._reset({randSeed:Date.now()}),p._loadAndStart({});var _=[],y=r.canvas,v=function(){return y.getBoundingClientRect().width/y.clientWidth},g=function(){return y.getBoundingClientRect().height/y.clientHeight},m={},w=function(t){var e=y.getBoundingClientRect();_.push({type:0,identifier:t.pointerId,offset:{x:(t.clientX-e.left)/v(),y:(t.clientY-e.top)/g()},button:t.button});var r=function(e){if(e.pointerId===t.pointerId){var r=y.getBoundingClientRect();_.push({type:1,identifier:e.pointerId,offset:{x:(e.clientX-r.left)/v(),y:(e.clientY-r.top)/g()},button:e.button})}},n=function(e){if(e.pointerId===t.pointerId){var r=y.getBoundingClientRect();if(_.push({type:2,identifier:e.pointerId,offset:{x:(e.clientX-r.left)/v(),y:(e.clientY-r.top)/g()},button:e.button}),m[e.pointerId]){var n=m[e.pointerId],i=n.move,o=n.release;window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",o),delete m[e.pointerId]}}};window.addEventListener("pointermove",r,{passive:!1}),window.addEventListener("pointerup",n,{passive:!1}),window.addEventListener("pointercancel",n,{passive:!1}),m[t.pointerId]={move:r,release:n}},b=function(t){t.preventDefault()};y.addEventListener("pointerdown",w,{passive:!1}),y.addEventListener("contextmenu",b,{passive:!1});var A=Date.now(),x=1e3/p.fps,S=function(){if(null!==o){var t=Date.now();if(A+2*x<t&&(A=t-x-1),A+x<t){if(_.length){for(var e=[],r=0;r<_.length;r++){var n=p.resolvePointEvent(_[r]);null!=n&&e.push(n)}_.length=0,p.tick(!0,void 0,e)}else p.tick(!0);p.render(),A+=x}o=window.requestAnimationFrame(S)}};return o=window.requestAnimationFrame(S),function(){null!==o&&(window.cancelAnimationFrame(o),o=null),p._destroy(),y.removeEventListener("pointerdown",w),y.removeEventListener("contextmenu",b),f.renderer().clear()}};var t=H,e=t.__importStar(is()),n=function(){if(os)return ss;os=1,Object.defineProperty(ss,"__esModule",{value:!0}),ss.GameHandlerSet=void 0;var t=H.__importStar(is()),e=function(){function e(e){this.raiseEventTrigger=new t.Trigger,this.raiseTickTrigger=new t.Trigger,this.changeSceneModeTrigger=new t.Trigger,this.snapshotTrigger=new t.Trigger,this._eventFilterFuncs=null,this._getCurrentTimeFunc=null,this._local=null,this._tickGenerationMode=null,this.isSnapshotSaver=!!e.isSnapshotSaver}return e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.removeAllEventFilters=function(){this._eventFilterFuncs&&this._eventFilterFuncs.removeFilter()},e.prototype.changeSceneMode=function(t){this._local=t.local,this._tickGenerationMode=t.tickGenerationMode,this.changeSceneModeTrigger.fire(t)},e.prototype.getCurrentTime=function(){return null==this._getCurrentTimeFunc?0:Math.floor(this._getCurrentTimeFunc())},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){t&&this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs&&this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs&&this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.getInstanceType=function(){return this.shouldSaveSnapshot()?"active":"passive"},e.prototype.suspendLocalTick=function(){},e.prototype.resumeLocalTick=function(){},e.prototype.saveSnapshot=function(t,e,r,n){this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:t,timestamp:n,data:{randGenSer:r,gameSnapshot:e}})},e}();return ss.GameHandlerSet=e,ss}(),i=Rh(),o=null;return window.g=e,r}();return t(Ih)});
